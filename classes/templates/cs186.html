<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"  
  "http://www.w3.org/TR/html4/loose.dtd">  
<html > 
<head><title>CS186 Notes</title> 
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"> 
<meta name="generator" content="TeX4ht (http://www.tug.org/tex4ht/)"> 
<meta name="originator" content="TeX4ht (http://www.tug.org/tex4ht/)"> 
<!-- html --> 
<meta name="src" content="CS186Main.tex"> 
<link rel="stylesheet" type="text/css" href="CS186Main.css"> 
</head><body 
>
                                                                                         
                                                                                         
    <div class="maketitle">
                                                                                         
                                                                                         
                                                                                         
                                                                                         

<h2 class="titleHead">CS186 Notes</h2>
<div class="author" ><span 
class="ecrm-1440">Dylan Hwang</span></div><br />
<div class="date" ><span 
class="ecrm-1440">March 4, 2019</span></div>
                                                                                         
                                                                                         
    </div>
                                                                                         
                                                                                         
<a 
 id="x1-1000"></a>
    <h2 class="likechapterHead"><a 
 id="x1-2000"></a>Contents</h2>
    <div class="tableofcontents">
    <span class="chapterToc" >1 <a 
href="#x1-30001" id="QQ2-1-3">Lecture 1</a></span>
<br />    &#x00A0;<span class="sectionToc" >1.1 <a 
href="#x1-40001" id="QQ2-1-4">SQL Roots</a></span>
<br />    &#x00A0;<span class="sectionToc" >1.2 <a 
href="#x1-50002" id="QQ2-1-5">SQL Pros and Cons</a></span>
<br />    &#x00A0;<span class="sectionToc" >1.3 <a 
href="#x1-60003" id="QQ2-1-6">Relational Terminology</a></span>
<br />    &#x00A0;<span class="sectionToc" >1.4 <a 
href="#x1-70004" id="QQ2-1-9">Relational Tables</a></span>
<br />    &#x00A0;&#x00A0;<span class="subsectionToc" >1.4.1 <a 
href="#x1-80001" id="QQ2-1-10">quick check</a></span>
<br />    &#x00A0;<span class="sectionToc" >1.5 <a 
href="#x1-90005" id="QQ2-1-11">SQL Language</a></span>
<br />    &#x00A0;<span class="sectionToc" >1.6 <a 
href="#x1-100006" id="QQ2-1-12">Examples:</a></span>
<br />    &#x00A0;<span class="sectionToc" >1.7 <a 
href="#x1-120007" id="QQ2-1-15">The SQL DDL: Foreign Keys</a></span>
<br />    &#x00A0;<span class="sectionToc" >1.8 <a 
href="#x1-130008" id="QQ2-1-17">The SQL DML</a></span>
<br />    &#x00A0;<span class="sectionToc" >1.9 <a 
href="#x1-140009" id="QQ2-1-18">Basic Single-Table Queries</a></span>
<br />    &#x00A0;<span class="sectionToc" >1.10 <a 
href="#x1-1600010" id="QQ2-1-21">ORDER BY</a></span>
<br />    &#x00A0;<span class="sectionToc" >1.11 <a 
href="#x1-1700011" id="QQ2-1-22">LIMIT</a></span>
<br />    &#x00A0;<span class="sectionToc" >1.12 <a 
href="#x1-1800012" id="QQ2-1-23">Aggregates</a></span>
<br />    &#x00A0;<span class="sectionToc" >1.13 <a 
href="#x1-1900013" id="QQ2-1-24">GROUP BY</a></span>
<br />    &#x00A0;<span class="sectionToc" >1.14 <a 
href="#x1-2000014" id="QQ2-1-25">HAVING</a></span>
<br />    &#x00A0;<span class="sectionToc" >1.15 <a 
href="#x1-2100015" id="QQ2-1-26">Putting it all together</a></span>
<br />    &#x00A0;<span class="sectionToc" >1.16 <a 
href="#x1-2200016" id="QQ2-1-27">DISTINCT Aggregates</a></span>
<br />    &#x00A0;<span class="sectionToc" >1.17 <a 
href="#x1-2300017" id="QQ2-1-28">Summary</a></span>
<br />    <span class="chapterToc" >2 <a 
href="#x1-240002" id="QQ2-1-29">Lecture 2: SQL II</a></span>
<br />    &#x00A0;<span class="sectionToc" >2.1 <a 
href="#x1-260001" id="QQ2-1-33">Join Queries</a></span>
<br />    &#x00A0;&#x00A0;<span class="subsectionToc" >2.1.1 <a 
href="#x1-270001" id="QQ2-1-34">Cross (Cartesian) Product</a></span>
<br />    &#x00A0;&#x00A0;<span class="subsectionToc" >2.1.2 <a 
href="#x1-280002" id="QQ2-1-35">Sailors who have reserved a boat</a></span>
<br />    &#x00A0;<span class="sectionToc" >2.2 <a 
href="#x1-290002" id="QQ2-1-36">Column names and table aliases</a></span>
<br />    &#x00A0;<span class="sectionToc" >2.3 <a 
href="#x1-300003" id="QQ2-1-38">Arithmetic Expressions</a></span>
<br />    &#x00A0;<span class="sectionToc" >2.4 <a 
href="#x1-310004" id="QQ2-1-39">SQL Calculator</a></span>
<br />    &#x00A0;<span class="sectionToc" >2.5 <a 
href="#x1-320005" id="QQ2-1-40">String Comparisons</a></span>
<br />    &#x00A0;<span class="sectionToc" >2.6 <a 
href="#x1-330006" id="QQ2-1-41">Combining Predicates</a></span>
<br />    &#x00A0;&#x00A0;<span class="subsectionToc" >2.6.1 <a 
href="#x1-340001" id="QQ2-1-42">Sid&#8217;s of sailors who reserved a red or green boat</a></span>
<br />    &#x00A0;&#x00A0;<span class="subsectionToc" >2.6.2 <a 
href="#x1-350002" id="QQ2-1-43">SID&#8217;s of sailors who reserved a red and green boat </a></span>
<br />    &#x00A0;<span class="sectionToc" >2.7 <a 
href="#x1-360007" id="QQ2-1-44">Set Semantics</a></span>
<br />    &#x00A0;<span class="sectionToc" >2.8 <a 
href="#x1-370008" id="QQ2-1-45">"ALL": Multiset Semantics</a></span>
<br />    &#x00A0;<span class="sectionToc" >2.9 <a 
href="#x1-380009" id="QQ2-1-46">Nested Queries: IN</a></span>
<br />    &#x00A0;<span class="sectionToc" >2.10 <a 
href="#x1-3900010" id="QQ2-1-47">Nested Queries: NOT IN</a></span>
<br />    &#x00A0;<span class="sectionToc" >2.11 <a 
href="#x1-4000011" id="QQ2-1-48">Nested Queries: EXISTS</a></span>
                                                                                         
                                                                                         
<br />    &#x00A0;<span class="sectionToc" >2.12 <a 
href="#x1-4100012" id="QQ2-1-49">Nested Queries with Correlation</a></span>
<br />    &#x00A0;<span class="sectionToc" >2.13 <a 
href="#x1-4200013" id="QQ2-1-50">A tough one: "division"</a></span>
<br />    &#x00A0;<span class="sectionToc" >2.14 <a 
href="#x1-4300014" id="QQ2-1-51">ARGMAX?</a></span>
<br />    &#x00A0;<span class="sectionToc" >2.15 <a 
href="#x1-4400015" id="QQ2-1-53">"Inner Joins: Another Syntax</a></span>
<br />    &#x00A0;<span class="sectionToc" >2.16 <a 
href="#x1-4500016" id="QQ2-1-54">Join Variants</a></span>
<br />    &#x00A0;&#x00A0;<span class="subsectionToc" >2.16.1 <a 
href="#x1-460001" id="QQ2-1-55">INNER/NATURAL Joins</a></span>
<br />    &#x00A0;&#x00A0;<span class="subsectionToc" >2.16.2 <a 
href="#x1-470002" id="QQ2-1-56">Left Outer Join</a></span>
<br />    &#x00A0;&#x00A0;<span class="subsectionToc" >2.16.3 <a 
href="#x1-480003" id="QQ2-1-57">Right Outer Join</a></span>
<br />    &#x00A0;&#x00A0;<span class="subsectionToc" >2.16.4 <a 
href="#x1-490004" id="QQ2-1-58">Full Outer Join</a></span>
<br />    &#x00A0;<span class="sectionToc" >2.17 <a 
href="#x1-5000017" id="QQ2-1-59">Views: Named Queries</a></span>
<br />    &#x00A0;<span class="sectionToc" >2.18 <a 
href="#x1-5100018" id="QQ2-1-60">Sub queries in FROM</a></span>
<br />    &#x00A0;<span class="sectionToc" >2.19 <a 
href="#x1-5200019" id="QQ2-1-61">WITH a.k.a common table expression CTE</a></span>
<br />    &#x00A0;&#x00A0;<span class="subsectionToc" >2.19.1 <a 
href="#x1-530001" id="QQ2-1-62">Can have many queries in WITH</a></span>
<br />    &#x00A0;<span class="sectionToc" >2.20 <a 
href="#x1-5400020" id="QQ2-1-63">ARGMAX GROUP BY</a></span>
<br />    &#x00A0;<span class="sectionToc" >2.21 <a 
href="#x1-5500021" id="QQ2-1-64">Brief Detour: Null Values</a></span>
<br />    &#x00A0;<span class="sectionToc" >2.22 <a 
href="#x1-5600022" id="QQ2-1-65">NULL at top of WHERE</a></span>
<br />    <span class="chapterToc" >3 <a 
href="#x1-570003" id="QQ2-1-66">Disks, Files, and Buffers</a></span>
<br />    &#x00A0;<span class="sectionToc" >3.1 <a 
href="#x1-580001" id="QQ2-1-67">Architecture of BDMS: SQL Client</a></span>
<br />    &#x00A0;<span class="sectionToc" >3.2 <a 
href="#x1-590002" id="QQ2-1-68">Architecture of DBMS</a></span>
<br />    &#x00A0;&#x00A0;<span class="subsectionToc" >3.2.1 <a 
href="#x1-600001" id="QQ2-1-69">Concurrency and Recovery</a></span>
<br />    &#x00A0;<span class="sectionToc" >3.3 <a 
href="#x1-610003" id="QQ2-1-71">Storage Media:</a></span>
<br />    &#x00A0;&#x00A0;<span class="subsectionToc" >3.3.1 <a 
href="#x1-640001" id="QQ2-1-74">Storage Hierarchy</a></span>
<br />    &#x00A0;&#x00A0;<span class="subsectionToc" >3.3.2 <a 
href="#x1-650002" id="QQ2-1-75">Components of a Disk</a></span>
<br />    &#x00A0;&#x00A0;<span class="subsectionToc" >3.3.3 <a 
href="#x1-660003" id="QQ2-1-77">Accessing a disk page</a></span>
<br />    &#x00A0;<span class="sectionToc" >3.4 <a 
href="#x1-670004" id="QQ2-1-78">Flash (SSD - Solid State Disks) </a></span>
<br />    &#x00A0;<span class="sectionToc" >3.5 <a 
href="#x1-690005" id="QQ2-1-80">Storage Pragmatics &amp; Trends</a></span>
<br />    &#x00A0;&#x00A0;<span class="subsectionToc" >3.5.1 <a 
href="#x1-700001" id="QQ2-1-81">Disk Space Management</a></span>
<br />    &#x00A0;<span class="sectionToc" >3.6 <a 
href="#x1-710006" id="QQ2-1-82">Block Level Storage</a></span>
<br />    &#x00A0;&#x00A0;<span class="subsectionToc" >3.6.1 <a 
href="#x1-720001" id="QQ2-1-83">A Note on Terminology</a></span>
<br />    &#x00A0;&#x00A0;<span class="subsectionToc" >3.6.2 <a 
href="#x1-730002" id="QQ2-1-84">Arranging Blocks on Disk</a></span>
<br />    &#x00A0;<span class="sectionToc" >3.7 <a 
href="#x1-740007" id="QQ2-1-85">Disk Space Management</a></span>
<br />    &#x00A0;&#x00A0;<span class="subsectionToc" >3.7.1 <a 
href="#x1-760001" id="QQ2-1-88">Implementation</a></span>
<br />    &#x00A0;&#x00A0;<span class="subsectionToc" >3.7.2 <a 
href="#x1-770002" id="QQ2-1-90">Summary</a></span>
<br />    &#x00A0;<span class="sectionToc" >3.8 <a 
href="#x1-780008" id="QQ2-1-91">File Representation</a></span>
<br />    &#x00A0;&#x00A0;<span class="subsectionToc" >3.8.1 <a 
href="#x1-790001" id="QQ2-1-92">Overview: representation</a></span>
<br />    &#x00A0;<span class="sectionToc" >3.9 <a 
href="#x1-800009" id="QQ2-1-93">Many DB File Structures</a></span>
<br />    &#x00A0;&#x00A0;<span class="subsectionToc" >3.9.1 <a 
href="#x1-810001" id="QQ2-1-94">Heap File implemented as List</a></span>
<br />    &#x00A0;&#x00A0;<span class="subsectionToc" >3.9.2 <a 
href="#x1-820002" id="QQ2-1-95">Better: Use a page directory</a></span>
<br />    &#x00A0;<span class="sectionToc" >3.10 <a 
href="#x1-8300010" id="QQ2-1-96">Page Layout</a></span>
<br />    &#x00A0;&#x00A0;<span class="subsectionToc" >3.10.1 <a 
href="#x1-840001" id="QQ2-1-97">Things to address</a></span>
<br />    &#x00A0;&#x00A0;<span class="subsectionToc" >3.10.2 <a 
href="#x1-890002" id="QQ2-1-105">First: relocate metadata to footer</a></span>
<br />    &#x00A0;<span class="sectionToc" >3.11 <a 
href="#x1-9000011" id="QQ2-1-106">Record Layout</a></span>
<br />    &#x00A0;&#x00A0;<span class="subsectionToc" >3.11.1 <a 
href="#x1-910001" id="QQ2-1-107">Record Format</a></span>
<br />    &#x00A0;&#x00A0;<span class="subsectionToc" >3.11.2 <a 
href="#x1-920002" id="QQ2-1-108">Record Formats: Fixed Length</a></span>
<br />    &#x00A0;&#x00A0;<span class="subsectionToc" >3.11.3 <a 
href="#x1-930003" id="QQ2-1-109">Record Formats: Variable Length</a></span>
                                                                                         
                                                                                         
<br />    &#x00A0;<span class="sectionToc" >3.12 <a 
href="#x1-9500012" id="QQ2-1-113">Summary</a></span>
<br />    <span class="chapterToc" >4 <a 
href="#x1-960004" id="QQ2-1-114">Files and Index Management</a></span>
<br />    &#x00A0;<span class="sectionToc" >4.1 <a 
href="#x1-970001" id="QQ2-1-115">Cost Model for analysis</a></span>
<br />    &#x00A0;<span class="sectionToc" >4.2 <a 
href="#x1-980002" id="QQ2-1-116">Heap Files vs. Sorted Files</a></span>
<br />    &#x00A0;<span class="sectionToc" >4.3 <a 
href="#x1-1120003" id="QQ2-1-143">Conclusion</a></span>
<br />    <span class="chapterToc" >5 <a 
href="#x1-1130005" id="QQ2-1-144">Module 3</a></span>
<br />    &#x00A0;<span class="sectionToc" >5.1 <a 
href="#x1-1140001" id="QQ2-1-145">Index</a></span>
<br />    &#x00A0;<span class="sectionToc" >5.2 <a 
href="#x1-1150002" id="QQ2-1-146">Simple idea</a></span>
<br />    &#x00A0;<span class="sectionToc" >5.3 <a 
href="#x1-1160003" id="QQ2-1-147">Build a high fan-out search tree</a></span>
<br />    &#x00A0;&#x00A0;<span class="subsectionToc" >5.3.1 <a 
href="#x1-1220001" id="QQ2-1-161">recap: ISAM</a></span>
<br />    &#x00A0;<span class="sectionToc" >5.4 <a 
href="#x1-1230004" id="QQ2-1-162">B+ Trees</a></span>
<br />    &#x00A0;&#x00A0;<span class="subsectionToc" >5.4.1 <a 
href="#x1-1260001" id="QQ2-1-168">Searching the B+ Tree</a></span>
<br />    &#x00A0;<span class="sectionToc" >5.5 <a 
href="#x1-1270005" id="QQ2-1-169">Inserting into B+ tree</a></span>
<br />    &#x00A0;&#x00A0;<span class="subsectionToc" >5.5.1 <a 
href="#x1-1300001" id="QQ2-1-176">B+ Tree insert: Algorithm Sketch</a></span>
<br />    &#x00A0;<span class="sectionToc" >5.6 <a 
href="#x1-1310006" id="QQ2-1-177">Deletion</a></span>
<br />    &#x00A0;<span class="sectionToc" >5.7 <a 
href="#x1-1320007" id="QQ2-1-178">Bulk Loading in B+ Tree</a></span>
<br />    &#x00A0;&#x00A0;<span class="subsectionToc" >5.7.1 <a 
href="#x1-1330001" id="QQ2-1-179">Smarter Bulk Loading</a></span>
<br />    &#x00A0;&#x00A0;<span class="subsectionToc" >5.7.2 <a 
href="#x1-1340002" id="QQ2-1-181">Summary of bulk loadings</a></span>
<br />    &#x00A0;<span class="sectionToc" >5.8 <a 
href="#x1-1350008" id="QQ2-1-182">Summary</a></span>
<br />    <span class="chapterToc" >6 <a 
href="#x1-1360006" id="QQ2-1-183">Refinements on Indexes and B+ Trees</a></span>
<br />    &#x00A0;<span class="sectionToc" >6.1 <a 
href="#x1-1370001" id="QQ2-1-184">Query Support</a></span>
<br />    &#x00A0;<span class="sectionToc" >6.2 <a 
href="#x1-1400002" id="QQ2-1-189">Search Key and Ordering</a></span>
<br />    &#x00A0;<span class="sectionToc" >6.3 <a 
href="#x1-1410003" id="QQ2-1-190">Data Entry Staorge</a></span>
<br />    &#x00A0;&#x00A0;<span class="subsectionToc" >6.3.1 <a 
href="#x1-1420001" id="QQ2-1-191">Three basic alternatives for data entries in any index</a></span>
<br />    &#x00A0;&#x00A0;<span class="subsectionToc" >6.3.2 <a 
href="#x1-1430002" id="QQ2-1-192">Alternative 1 Index (B+ Tree)</a></span>
<br />    &#x00A0;&#x00A0;<span class="subsectionToc" >6.3.3 <a 
href="#x1-1440003" id="QQ2-1-193">Alternative 2 Index</a></span>
<br />    &#x00A0;&#x00A0;<span class="subsectionToc" >6.3.4 <a 
href="#x1-1450004" id="QQ2-1-194">Alternative 3 Index</a></span>
<br />    &#x00A0;&#x00A0;<span class="subsectionToc" >6.3.5 <a 
href="#x1-1460005" id="QQ2-1-195">Indexing By reference</a></span>
<br />    &#x00A0;<span class="sectionToc" >6.4 <a 
href="#x1-1470004" id="QQ2-1-196">Clustered vs. Unclustered Index</a></span>
<br />    &#x00A0;<span class="sectionToc" >6.5 <a 
href="#x1-1480005" id="QQ2-1-197">Clustered vs Unclustered index Visualization</a></span>
<br />    &#x00A0;&#x00A0;<span class="subsectionToc" >6.5.1 <a 
href="#x1-1490001" id="QQ2-1-199">Insertion into Clustered</a></span>
<br />    &#x00A0;&#x00A0;<span class="subsectionToc" >6.5.2 <a 
href="#x1-1500002" id="QQ2-1-200">Summary</a></span>
<br />    &#x00A0;<span class="sectionToc" >6.6 <a 
href="#x1-1510006" id="QQ2-1-201">B+ tree refinement: variable-length keys</a></span>
<br />    &#x00A0;&#x00A0;<span class="subsectionToc" >6.6.1 <a 
href="#x1-1520001" id="QQ2-1-204">Redefine Occupancy Invariant</a></span>
<br />    &#x00A0;&#x00A0;<span class="subsectionToc" >6.6.2 <a 
href="#x1-1540002" id="QQ2-1-209">Prefix Key compression</a></span>
<br />    &#x00A0;&#x00A0;<span class="subsectionToc" >6.6.3 <a 
href="#x1-1550003" id="QQ2-1-212">Suffice Key Compression</a></span>
<br />    <span class="chapterToc" >7 <a 
href="#x1-1560007" id="QQ2-1-213">Module 4</a></span>
<br />    &#x00A0;<span class="sectionToc" >7.1 <a 
href="#x1-1570001" id="QQ2-1-214">Dirty Pages</a></span>
<br />    &#x00A0;&#x00A0;<span class="subsectionToc" >7.1.1 <a 
href="#x1-1580001" id="QQ2-1-215">Handling Dirty Pages</a></span>
<br />    &#x00A0;&#x00A0;<span class="subsectionToc" >7.1.2 <a 
href="#x1-1590002" id="QQ2-1-216">Buffer manager States</a></span>
<br />    &#x00A0;<span class="sectionToc" >7.2 <a 
href="#x1-1600002" id="QQ2-1-219">Page Replacement Terminology</a></span>
<br />    &#x00A0;<span class="sectionToc" >7.3 <a 
href="#x1-1610003" id="QQ2-1-220">Life cycle of page</a></span>
<br />    &#x00A0;<span class="sectionToc" >7.4 <a 
href="#x1-1630004" id="QQ2-1-223">Page Replacement Policy</a></span>
<br />    &#x00A0;&#x00A0;<span class="subsectionToc" >7.4.1 <a 
href="#x1-1640001" id="QQ2-1-224">LRU Replacement Policy</a></span>
<br />    &#x00A0;&#x00A0;<span class="subsectionToc" >7.4.2 <a 
href="#x1-1650002" id="QQ2-1-225">CLOCK algorithm</a></span>
                                                                                         
                                                                                         
<br />    &#x00A0;&#x00A0;<span class="subsectionToc" >7.4.3 <a 
href="#x1-1660003" id="QQ2-1-228">Is LRU/Clock always best?</a></span>
<br />    &#x00A0;&#x00A0;<span class="subsectionToc" >7.4.4 <a 
href="#x1-1680004" id="QQ2-1-231">Repeated Scans (LRU)</a></span>
<br />    &#x00A0;&#x00A0;<span class="subsectionToc" >7.4.5 <a 
href="#x1-1690005" id="QQ2-1-233">Repeated Scans (MRU)</a></span>
<br />    &#x00A0;<span class="sectionToc" >7.5 <a 
href="#x1-1700005" id="QQ2-1-234">Improvement for sequential scan: prefetching</a></span>
<br />    &#x00A0;<span class="sectionToc" >7.6 <a 
href="#x1-1710006" id="QQ2-1-235">We need hybrid between LRU and MRU</a></span>
<br />    &#x00A0;<span class="sectionToc" >7.7 <a 
href="#x1-1720007" id="QQ2-1-236">DBMS vs OS Buffer Cache</a></span>
<br />    &#x00A0;<span class="sectionToc" >7.8 <a 
href="#x1-1730008" id="QQ2-1-237">Summary</a></span>
<br />    <span class="chapterToc" >8 <a 
href="#x1-1740008" id="QQ2-1-238">Relational Algebra</a></span>
<br />    &#x00A0;<span class="sectionToc" >8.1 <a 
href="#x1-1750001" id="QQ2-1-240">History: Formal Relational QL&#8217;s </a></span>
<br />    &#x00A0;<span class="sectionToc" >8.2 <a 
href="#x1-1760002" id="QQ2-1-241">Set Operators</a></span>
<br />    &#x00A0;&#x00A0;<span class="subsectionToc" >8.2.1 <a 
href="#x1-1770001" id="QQ2-1-242">Union(<span 
class="cmsy-10x-x-120">&#x222A;</span>)</a></span>
<br />    &#x00A0;&#x00A0;<span class="subsectionToc" >8.2.2 <a 
href="#x1-1780002" id="QQ2-1-243">Set Difference (-)</a></span>
<br />    &#x00A0;&#x00A0;<span class="subsectionToc" >8.2.3 <a 
href="#x1-1790003" id="QQ2-1-244">Cross-Product (x)</a></span>
<br />    &#x00A0;&#x00A0;<span class="subsectionToc" >8.2.4 <a 
href="#x1-1800004" id="QQ2-1-245">Renaming (<span 
class="cmmi-12">&#x03C1; </span>= "rho")</a></span>
<br />    &#x00A0;<span class="sectionToc" >8.3 <a 
href="#x1-1810003" id="QQ2-1-247">Compound Operators</a></span>
<br />    &#x00A0;&#x00A0;<span class="subsectionToc" >8.3.1 <a 
href="#x1-1820001" id="QQ2-1-248">Compound Operator: intersection</a></span>
<br />    &#x00A0;&#x00A0;<span class="subsectionToc" >8.3.2 <a 
href="#x1-1830002" id="QQ2-1-249">Compound Operator: Join</a></span>
<br />    &#x00A0;&#x00A0;<span class="subsectionToc" >8.3.3 <a 
href="#x1-1840003" id="QQ2-1-250">Theta Join Example</a></span>
<br />    &#x00A0;&#x00A0;<span class="subsectionToc" >8.3.4 <a 
href="#x1-1850004" id="QQ2-1-253">Natural Join</a></span>
<br />    &#x00A0;<span class="sectionToc" >8.4 <a 
href="#x1-1860004" id="QQ2-1-254">Extended Relational Algebra</a></span>
<br />    &#x00A0;<span class="sectionToc" >8.5 <a 
href="#x1-1870005" id="QQ2-1-255">Summary</a></span>
<br />    <span class="chapterToc" >9 <a 
href="#x1-1880009" id="QQ2-1-256">February 21, 2019</a></span>
<br />    &#x00A0;<span class="sectionToc" >9.1 <a 
href="#x1-1890001" id="QQ2-1-257">Out-of-core Algorithms</a></span>
<br />    &#x00A0;&#x00A0;<span class="subsectionToc" >9.1.1 <a 
href="#x1-1900001" id="QQ2-1-258">Single-pass Streaming</a></span>
<br />    &#x00A0;&#x00A0;<span class="subsectionToc" >9.1.2 <a 
href="#x1-1910002" id="QQ2-1-261">Better: Double Buffering</a></span>
<br />    &#x00A0;<span class="sectionToc" >9.2 <a 
href="#x1-1920002" id="QQ2-1-262">Sorting &amp; hashing: Formal Specs</a></span>
<br />    &#x00A0;&#x00A0;<span class="subsectionToc" >9.2.1 <a 
href="#x1-1930001" id="QQ2-1-263">Sorting: 2-Way (a strawman)</a></span>
<br />    &#x00A0;<span class="sectionToc" >9.3 <a 
href="#x1-1940003" id="QQ2-1-265">General External Merge Sort</a></span>
<br />    &#x00A0;&#x00A0;<span class="subsectionToc" >9.3.1 <a 
href="#x1-1950001" id="QQ2-1-267">cost of external merge sort</a></span>
<br />    &#x00A0;&#x00A0;<span class="subsectionToc" >9.3.2 <a 
href="#x1-1960002" id="QQ2-1-269">Memory requirement for external sorting</a></span>
<br />    &#x00A0;<span class="sectionToc" >9.4 <a 
href="#x1-1970004" id="QQ2-1-270">Alternative: Hashing</a></span>
<br />    &#x00A0;&#x00A0;<span class="subsectionToc" >9.4.1 <a 
href="#x1-1980001" id="QQ2-1-271">Main Idea</a></span>
<br />    &#x00A0;<span class="sectionToc" >9.5 <a 
href="#x1-2010005" id="QQ2-1-276">Schematic of Divide and Conquer</a></span>
<br />    &#x00A0;<span class="sectionToc" >9.6 <a 
href="#x1-2020006" id="QQ2-1-279">Cost of External Hashing</a></span>
<br />    &#x00A0;&#x00A0;<span class="subsectionToc" >9.6.1 <a 
href="#x1-2030001" id="QQ2-1-281">Memory requirement</a></span>
<br />    &#x00A0;<span class="sectionToc" >9.7 <a 
href="#x1-2040007" id="QQ2-1-282">Recursive Partitioning</a></span>
<br />    &#x00A0;<span class="sectionToc" >9.8 <a 
href="#x1-2050008" id="QQ2-1-284">Deal with duplicates</a></span>
<br />    &#x00A0;<span class="sectionToc" >9.9 <a 
href="#x1-2060009" id="QQ2-1-285">Performance of external hashing and external sorting</a></span>
<br />    &#x00A0;&#x00A0;<span class="subsectionToc" >9.9.1 <a 
href="#x1-2070001" id="QQ2-1-286">Cost of External Hashing</a></span>
<br />    &#x00A0;&#x00A0;<span class="subsectionToc" >9.9.2 <a 
href="#x1-2080002" id="QQ2-1-288">Cost of External Sorting</a></span>
<br />    &#x00A0;&#x00A0;<span class="subsectionToc" >9.9.3 <a 
href="#x1-2090003" id="QQ2-1-290">Compare</a></span>
<br />    &#x00A0;<span class="sectionToc" >9.10 <a 
href="#x1-21000010" id="QQ2-1-291">Parallelize me! Hashing Phase 1</a></span>
<br />    &#x00A0;<span class="sectionToc" >9.11 <a 
href="#x1-21100011" id="QQ2-1-294">Parallelize me! Sorting</a></span>
<br />    &#x00A0;<span class="sectionToc" >9.12 <a 
href="#x1-21200012" id="QQ2-1-295">So which is better?</a></span>
<br />    &#x00A0;<span class="sectionToc" >9.13 <a 
href="#x1-21300013" id="QQ2-1-296">Summary</a></span>
                                                                                         
                                                                                         
<br />    <span class="chapterToc" >10 <a 
href="#x1-21400010" id="QQ2-1-297">Module 6</a></span>
<br />    &#x00A0;<span class="sectionToc" >10.1 <a 
href="#x1-2150001" id="QQ2-1-298">Query Executor instantiates Operators</a></span>
<br />    &#x00A0;<span class="sectionToc" >10.2 <a 
href="#x1-2160002" id="QQ2-1-299">Iterator interface</a></span>
<br />    &#x00A0;<span class="sectionToc" >10.3 <a 
href="#x1-2170003" id="QQ2-1-300">Full Query Plan</a></span>
<br />    &#x00A0;<span class="sectionToc" >10.4 <a 
href="#x1-2180004" id="QQ2-1-302">Join Operators</a></span>
<br />    &#x00A0;&#x00A0;<span class="subsectionToc" >10.4.1 <a 
href="#x1-2190001" id="QQ2-1-303">Simple Nested Loops Join</a></span>
<br />    &#x00A0;&#x00A0;<span class="subsectionToc" >10.4.2 <a 
href="#x1-2200002" id="QQ2-1-304">Page nested loop join</a></span>
<br />    &#x00A0;&#x00A0;<span class="subsectionToc" >10.4.3 <a 
href="#x1-2210003" id="QQ2-1-305">Chunk nested loop join</a></span>
<br />    &#x00A0;&#x00A0;<span class="subsectionToc" >10.4.4 <a 
href="#x1-2220004" id="QQ2-1-306">Index Nested Loops Join</a></span>
<br />    &#x00A0;&#x00A0;<span class="subsectionToc" >10.4.5 <a 
href="#x1-2240005" id="QQ2-1-308">Sort-merge join</a></span>
<br />    &#x00A0;<span class="sectionToc" >10.5 <a 
href="#x1-2270005" id="QQ2-1-313">Cost of sort-merge join</a></span>
<br />    &#x00A0;<span class="sectionToc" >10.6 <a 
href="#x1-2280006" id="QQ2-1-314">Sort-merge refinement</a></span>
<br />    &#x00A0;<span class="sectionToc" >10.7 <a 
href="#x1-2290007" id="QQ2-1-315">Naive in memory hash join</a></span>
<br />    &#x00A0;<span class="sectionToc" >10.8 <a 
href="#x1-2300008" id="QQ2-1-316">Grace Hash Join</a></span>
    </div>
                                                                                         
                                                                                         
                                                                                         
                                                                                         
                                                                                         
                                                                                         
                                                                                         
                                                                                         
    <h2 class="chapterHead"><span class="titlemark">Chapter&#x00A0;1</span><br /><a 
 id="x1-30001"></a>Lecture 1</h2>
<a 
 id="x1-3001r1"></a>
<h3 class="sectionHead"><span class="titlemark">1.1   </span> <a 
 id="x1-40001"></a>SQL Roots</h3>
      <ul class="itemize1">
      <li class="itemize">It was developed @IBM Research in the 1970s
           <ul class="itemize2">
           <li class="itemize">System R project
           </li>
           <li class="itemize">Vs. Berkeley&#8217;s Quel language (Ingres project0</li></ul>
      </li>
      <li class="itemize">Commercialized/Popularized in the 198s
           <ul class="itemize2">
           <li class="itemize">"intergalactic Dataspeak
           </li>
           <li class="itemize">IBM beaten to market by a startup called Oracle</li></ul>
      </li></ul>
<a 
 id="x1-4001r4"></a>
<h3 class="sectionHead"><span class="titlemark">1.2   </span> <a 
 id="x1-50002"></a>SQL Pros and Cons</h3>
      <ul class="itemize1">
      <li class="itemize">Declarative: Say what you want, not how to get it
      </li>
      <li class="itemize">Implemented widely: With varying levels of efficiency, completeness
      </li>
      <li class="itemize">Constrained: not targeted at Turing-complete tasks
      </li>
      <li class="itemize">General-purpose and feature-rich: it is extensible with fallouts to other languages and
      there are many years of added features.</li></ul>
<a 
 id="x1-5001r5"></a>
<h3 class="sectionHead"><span class="titlemark">1.3   </span> <a 
 id="x1-60003"></a>Relational Terminology</h3>
<!--l. 24--><p class="noindent" ><hr class="figure"><div class="figure" 
>
                                                                                         
                                                                                         
<a 
 id="x1-60011"></a>
                                                                                         
                                                                                         
<!--l. 26--><p class="noindent" >
<br /> <div class="caption" 
><span class="id">Figure&#x00A0;1.1: </span><span  
class="content">Shows terminology in table</span></div><!--tex4ht:label?: x1-60011 -->
                                                                                         
                                                                                         
<!--l. 28--><p class="noindent" ></div><hr class="endfigure">
    <div class="newtheorem">
<!--l. 29--><p class="noindent" ><span class="head">
<span 
class="ecbx-1200">Definition</span><span 
class="ecbx-1200">&#x00A0;1.1</span> </span><span 
class="ecti-1200">Database: set of named relations. We pictorially draw cans for databases</span>
    </div>
<!--l. 32--><p class="noindent" ><hr class="figure"><div class="figure" 
><a 
 id="x1-60032"></a>
<br /> <div class="caption" 
><span class="id">Figure&#x00A0;1.2: </span><span  
class="content">Relation Table</span></div><!--tex4ht:label?: x1-60032 -->
<!--l. 37--><p class="indent" >    </div><hr class="endfigure">
<!--l. 38--><p class="indent" >    par relations are sometimes called tables so they are replaceable <div class="newtheorem">
<!--l. 39--><p class="noindent" ><span class="head">
<span 
class="ecbx-1200">Definition</span><span 
class="ecbx-1200">&#x00A0;1.2</span> </span><span 
class="ecti-1200">Relation (also known as Table): refer to figure </span><a 
href="#x1-60032"><span 
class="ecti-1200">1.2</span><!--tex4ht:ref: relateTable --></a><span 
class="ecti-1200">. It has the attributes:</span>
    </div>
      <ul class="itemize1">
      <li class="itemize">schema: description ("metadata")
      </li>
      <li class="itemize">Instance: set of data satisfying the schema</li></ul>
    <div class="newtheorem">
<!--l. 48--><p class="noindent" ><span class="head">
<span 
class="ecbx-1200">Definition</span><span 
class="ecbx-1200">&#x00A0;1.3</span> </span><span 
class="ecti-1200">Attribute (Column,Field)</span>
    </div>
<!--l. 51--><p class="noindent" >Example: <div class="table">
<!--l. 52--><p class="indent" >    <hr class="float"><div class="float" 
>
                                                                                         
                                                                                         
<div class="tabular"> <table id="TBL-2" class="tabular" 
cellspacing="0" cellpadding="0"  
><colgroup id="TBL-2-1g"><col 
id="TBL-2-1"></colgroup><tr 
class="hline"><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-2-1-"><td  style="white-space:nowrap; text-align:center;" id="TBL-2-1-1"  
class="td11">first text</td></tr><tr  
 style="vertical-align:baseline;" id="TBL-2-2-"><td  style="white-space:nowrap; text-align:center;" id="TBL-2-2-1"  
class="td11"> wei</td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-2-3-"><td  style="white-space:nowrap; text-align:center;" id="TBL-2-3-1"  
class="td11"> apurva  </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-2-4-"><td  style="white-space:nowrap; text-align:center;" id="TBL-2-4-1"  
class="td11">  sara    </td>
</tr><tr 
class="hline"><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-2-5-"><td  style="white-space:nowrap; text-align:center;" id="TBL-2-5-1"  
class="td11">        </td></tr></table></div>
                                                                                         
                                                                                         
    </div><hr class="endfloat" />
    </div>
    <div class="newtheorem">
<!--l. 64--><p class="noindent" ><span class="head">
<span 
class="ecbx-1200">Definition</span><span 
class="ecbx-1200">&#x00A0;1.4</span> </span><span 
class="ecti-1200">Tuple (Record, Row): an individual row in the table</span>
    </div>
<a 
 id="x1-6007r6"></a>
<h3 class="sectionHead"><span class="titlemark">1.4   </span> <a 
 id="x1-70004"></a>Relational Tables</h3>
<!--l. 69--><p class="noindent" ><span 
class="ecti-1200">Schema </span>is fixed: It can be changed but isn&#8217;t typically changed.
      <ul class="itemize1">
      <li class="itemize">unique attribute names, <span 
class="ecti-1200">atomic </span>types meaning that the types cannot be further broken
      down. They are not list types or collection types.
      </li>
      <li class="itemize">folks (ssn integer, first text, last text) is an example from previous slide.</li></ul>
<!--l. 75--><p class="noindent" ><span 
class="ecti-1200">Instance </span>can change often
      <ul class="itemize1">
      <li class="itemize">a  multiset  of  "rows"  ("tuples").  This  means  you  can  have  duplicates.  So  multiset
      preserves duplicates.</li></ul>
<a 
 id="x1-7001r1"></a>
<h4 class="subsectionHead"><span class="titlemark">1.4.1   </span> <a 
 id="x1-80001"></a>quick check</h4>
<!--l. 81--><p class="noindent" >Schemas must be enforced for it to be a relation. <a 
 id="likesection.1"></a><a 
 id="x1-8001"></a><object data="CS186Main-1.svg" width="1.0 " height="2.33333 " type="image/svg+xml"><p>SVG-Viewer needed.</p></object>
<span class="marginpar"><object data="CS186Main-2.svg" width="76.20702 " height="46.14928 " type="image/svg+xml"><p>SVG-Viewer needed.</p></object>
<object data="CS186Main-3.svg" width="1.0 " height="2.33333 " type="image/svg+xml"><p>SVG-Viewer needed.</p></object>
</span>
<!--l. 83--><p class="indent" >    Each column in a schema has to have different names.
<!--l. 84--><p class="indent" >    In SQL, you cannot next composite types inside tuples. Each column has an automic type
that cannot be further broken down.
<a 
 id="x1-8002r9"></a>
<h3 class="sectionHead"><span class="titlemark">1.5   </span> <a 
 id="x1-90005"></a>SQL Language</h3>
      <ul class="itemize1">
      <li class="itemize">Two sublanguages:
           <ul class="itemize2">
           <li class="itemize">DDL - Data Definition Language: Define and modify schema. Used to manipulate
           the schema. If you want to add or remove columns.
           </li>
           <li class="itemize">DML - Data Manipulation Language: Queries can be written intuitively. Used to
           manipulate actual data in the database.</li></ul>
                                                                                         
                                                                                         
      </li>
      <li class="itemize">RDBMS responsible for efficient evaluation of the SQL Language: It chooses and runs
      algorithms for declarative queries. Choice of algorithm must not affect any query
      answer.</li></ul>
<a 
 id="x1-9001r11"></a>
<h3 class="sectionHead"><span class="titlemark">1.6   </span> <a 
 id="x1-100006"></a>Examples:</h3>
<!--l. 100--><p class="noindent" >Database Example:
<!--l. 101--><p class="indent" >    There are a Boating club with reserves, sailors, and boats. Each relations there
is an instance. You can see that sailors have ids, and from the id, you can see Fred,
has boat 102, from the Boat table you can see that the 102 boat is Pinta and is blue.
<a 
 id="Q1-1-13"></a>
<h4 class="likesubsectionHead"><a 
 id="x1-110006"></a>How to create table</h4>
<!--l. 105--><p class="noindent" >First create the Sailors table with the column name and types. You should consult SQL manual to
see the types. Additionally, after all column list and types, you specify a <tspan font-family="ecbx" font-size="1200">PRIMARY KEY (_)</tspan>.
It is a list of columns. The primary key column provides unique "lookup key" for the relation. As a
result, you cant have duplicate values. Can be made up of &#x003E; 1 column. Such as (firstname,
lastname) If you use pairs, then there is a duplicate constraint on the pair of columns
that you use. If a column is declared a PRIMARY KEY, then the records can not have
duplicates.
    <!--l. 115-->
<div class="lstlisting" id="listing-1"><span class="label"><a 
 id="x1-11001r1"></a><tspan font-family="ecrm" font-size="0600">1</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">CREATE</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">TABLE</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">Sailors</tspan><tspan font-family="ecrm" font-size="1000">(</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-11002r2"></a><tspan font-family="ecrm" font-size="0600">2</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">sid</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">INTEGER</tspan><tspan font-family="ecrm" font-size="1000">,</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-11003r3"></a><tspan font-family="ecrm" font-size="0600">3</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">sname</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">CHAR</tspan><tspan font-family="ecrm" font-size="1000">(20)</tspan><tspan font-family="ecrm" font-size="1000">,</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-11004r4"></a><tspan font-family="ecrm" font-size="0600">4</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">rating</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">INTEGER</tspan><tspan font-family="ecrm" font-size="1000">,</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-11005r5"></a><tspan font-family="ecrm" font-size="0600">5</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">age</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">FLOAT</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-11006r6"></a><tspan font-family="ecrm" font-size="0600">6</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">PRIMARY</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">KEY</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">(</tspan><tspan font-family="ecrm" font-size="1000">sid</tspan><tspan font-family="ecrm" font-size="1000">)</tspan><tspan font-family="ecrm" font-size="1000">)</tspan><tspan font-family="ecrm" font-size="1000">;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-11007r7"></a><tspan font-family="ecrm" font-size="0600">7</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan>
    </div>
    <div class="table">
                                                                                         
                                                                                         
<!--l. 123--><p class="indent" >    <hr class="float"><div class="float" 
>
                                                                                         
                                                                                         
<div class="tabular"> <table id="TBL-3" class="tabular" 
cellspacing="0" cellpadding="0"  
><colgroup id="TBL-3-1g"><col 
id="TBL-3-1"></colgroup><colgroup id="TBL-3-2g"><col 
id="TBL-3-2"></colgroup><colgroup id="TBL-3-3g"><col 
id="TBL-3-3"></colgroup><colgroup id="TBL-3-4g"><col 
id="TBL-3-4"></colgroup><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-3-1-"><td  style="white-space:nowrap; text-align:center;" id="TBL-3-1-1"  
class="td11"><span class="underline"><tspan font-family="ecbx" font-size="1200">sid</tspan></span></td><td  style="white-space:nowrap; text-align:center;" id="TBL-3-1-2"  
class="td11">sname</td><td  style="white-space:nowrap; text-align:center;" id="TBL-3-1-3"  
class="td11">rating</td><td  style="white-space:nowrap; text-align:center;" id="TBL-3-1-4"  
class="td11">age</td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-3-2-"><td  style="white-space:nowrap; text-align:center;" id="TBL-3-2-1"  
class="td11"> 1  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-3-2-2"  
class="td11"> Fred </td><td  style="white-space:nowrap; text-align:center;" id="TBL-3-2-3"  
class="td11">  7   </td><td  style="white-space:nowrap; text-align:center;" id="TBL-3-2-4"  
class="td11"> 22 </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-3-3-"><td  style="white-space:nowrap; text-align:center;" id="TBL-3-3-1"  
class="td11"> 2  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-3-3-2"  
class="td11"> Jim  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-3-3-3"  
class="td11">  2   </td><td  style="white-space:nowrap; text-align:center;" id="TBL-3-3-4"  
class="td11"> 39 </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-3-4-"><td  style="white-space:nowrap; text-align:center;" id="TBL-3-4-1"  
class="td11"> 3  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-3-4-2"  
class="td11">Nancy</td><td  style="white-space:nowrap; text-align:center;" id="TBL-3-4-3"  
class="td11">  8   </td><td  style="white-space:nowrap; text-align:center;" id="TBL-3-4-4"  
class="td11"> 27 </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-3-5-"><td  style="white-space:nowrap; text-align:center;" id="TBL-3-5-1"  
class="td11">   </td></tr></table></div>
                                                                                         
                                                                                         
    </div><hr class="endfloat" />
    </div>
<a 
 id="x1-11008r12"></a>
<h3 class="sectionHead"><span class="titlemark">1.7   </span> <a 
 id="x1-120007"></a>The SQL DDL: Foreign Keys</h3>
<!--l. 138--><p class="noindent" >Foreign key references a table via the primary key of that table.
<!--l. 139--><p class="indent" >    You do not need to share the name of the referenced primary key.
<!--l. 140--><p class="indent" >    Foreign keys are pointers in schemas. Reserves has a foreign key sid that references to the
sailors table. By definition a foreign key references the primary key columns of the table that it
references. <hr class="figure"><div class="figure" 
>
                                                                                         
                                                                                         
<a 
 id="x1-120013"></a>
                                                                                         
                                                                                         
<!--l. 145--><p class="noindent" >
<br /> <div class="caption" 
><span class="id">Figure&#x00A0;1.3: </span><span  
class="content">Foreign Keys Example</span></div><!--tex4ht:label?: x1-120013 -->
                                                                                         
                                                                                         
<!--l. 148--><p class="indent" >    </div><hr class="endfigure">
<!--l. 149--><p class="indent" >    Look at <a 
href="#x1-120013">1.3<!--tex4ht:ref: foreignkey --></a> We can also have a foreign key that references boats using bid.
<a 
 id="x1-12002r15"></a>
<h3 class="sectionHead"><span class="titlemark">1.8   </span> <a 
 id="x1-130008"></a>The SQL DML</h3>
<!--l. 153--><p class="noindent" >Fing all 27-year old sailors: <!--l. 154-->
<div class="lstlisting" id="listing-2"><span class="label"><a 
 id="x1-13001r1"></a><tspan font-family="ecrm" font-size="0600">1</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">SELECT</tspan><tspan font-family="cmsy" font-size="10">*</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-13002r2"></a><tspan font-family="ecrm" font-size="0600">2</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">FROM</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">Sailors</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">AS</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">S</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-13003r3"></a><tspan font-family="ecrm" font-size="0600">3</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">WHERE</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">S</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">age</tspan><tspan font-family="ecrm" font-size="1000">=27;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-13004r4"></a><tspan font-family="ecrm" font-size="0600">4</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan>
    </div>
    <div class="table">
                                                                                         
                                                                                         
<!--l. 159--><p class="indent" >    <hr class="float"><div class="float" 
>
                                                                                         
                                                                                         
<div class="tabular"> <table id="TBL-4" class="tabular" 
cellspacing="0" cellpadding="0"  
><colgroup id="TBL-4-1g"><col 
id="TBL-4-1"></colgroup><colgroup id="TBL-4-2g"><col 
id="TBL-4-2"></colgroup><colgroup id="TBL-4-3g"><col 
id="TBL-4-3"></colgroup><colgroup id="TBL-4-4g"><col 
id="TBL-4-4"></colgroup><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-4-1-"><td  style="white-space:nowrap; text-align:center;" id="TBL-4-1-1"  
class="td11">sid</td><td  style="white-space:nowrap; text-align:center;" id="TBL-4-1-2"  
class="td11">sname</td><td  style="white-space:nowrap; text-align:center;" id="TBL-4-1-3"  
class="td11">rating</td><td  style="white-space:nowrap; text-align:center;" id="TBL-4-1-4"  
class="td11">age</td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-4-2-"><td  style="white-space:nowrap; text-align:center;" id="TBL-4-2-1"  
class="td11"> 1  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-4-2-2"  
class="td11"> Fred </td><td  style="white-space:nowrap; text-align:center;" id="TBL-4-2-3"  
class="td11">  7   </td><td  style="white-space:nowrap; text-align:center;" id="TBL-4-2-4"  
class="td11"> 22 </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-4-3-"><td  style="white-space:nowrap; text-align:center;" id="TBL-4-3-1"  
class="td11"> 3  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-4-3-2"  
class="td11">Nancy</td><td  style="white-space:nowrap; text-align:center;" id="TBL-4-3-3"  
class="td11">  8   </td><td  style="white-space:nowrap; text-align:center;" id="TBL-4-3-4"  
class="td11"> 27 </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-4-4-"><td  style="white-space:nowrap; text-align:center;" id="TBL-4-4-1"  
class="td11">   </td></tr></table></div>
                                                                                         
                                                                                         
    </div><hr class="endfloat" />
    </div>
<!--l. 171--><p class="indent" >    To find just names and ratings, replace the first line to: <!--l. 172-->
<div class="lstlisting" id="listing-3"><span class="label"><a 
 id="x1-13005r1"></a><tspan font-family="ecrm" font-size="0600">1</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">SELECT</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">S</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">sname</tspan><tspan font-family="ecrm" font-size="1000">,</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-13006r2"></a><tspan font-family="ecrm" font-size="0600">2</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">S</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">rating</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-13007r3"></a><tspan font-family="ecrm" font-size="0600">3</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan>
    </div>
<!--l. 176--><p class="indent" >    Which will give us: <!--l. 177-->
<div class="lstlisting" id="listing-4"><span class="label"><a 
 id="x1-13008r1"></a><tspan font-family="ecrm" font-size="0600">1</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">SELECT</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">S</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">sname</tspan><tspan font-family="ecrm" font-size="1000">,</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">S</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">rating</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-13009r2"></a><tspan font-family="ecrm" font-size="0600">2</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">FROM</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">Sailors</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">AS</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">S</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-13010r3"></a><tspan font-family="ecrm" font-size="0600">3</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">WHERE</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">S</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">age</tspan><tspan font-family="ecrm" font-size="1000">=27;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-13011r4"></a><tspan font-family="ecrm" font-size="0600">4</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan>
    </div>
<a 
 id="x1-13012r17"></a>
<h3 class="sectionHead"><span class="titlemark">1.9   </span> <a 
 id="x1-140009"></a>Basic Single-Table Queries</h3>
    <!--l. 183-->
<div class="lstlisting" id="listing-5"><span class="label"><a 
 id="x1-14001r1"></a><tspan font-family="ecrm" font-size="0600">1</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">SELECT</tspan><tspan font-family="ecrm" font-size="1000">[</tspan><tspan font-family="ecrm" font-size="1000">DISTINCT</tspan><tspan font-family="ecrm" font-size="1000">]&#x003C;</tspan><tspan font-family="ecrm" font-size="1000">column</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">expression</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">list</tspan><tspan font-family="ecrm" font-size="1000">&#x003E;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-14002r2"></a><tspan font-family="ecrm" font-size="0600">2</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">FROM</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x003C;</tspan><tspan font-family="ecrm" font-size="1000">single</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">table</tspan><tspan font-family="ecrm" font-size="1000">&#x003E;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-14003r3"></a><tspan font-family="ecrm" font-size="0600">3</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">[</tspan><tspan font-family="ecrm" font-size="1000">WHERE</tspan><tspan font-family="ecrm" font-size="1000">&#x003C;</tspan><tspan font-family="ecrm" font-size="1000">predicate</tspan><tspan font-family="ecrm" font-size="1000">&#x003E;]</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-14004r4"></a><tspan font-family="ecrm" font-size="0600">4</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan>
    </div>
<!--l. 188--><p class="indent" >    Simplest version is straightforward
      <ul class="itemize1">
      <li class="itemize">produce all tuples in the table that satisfy the predicate
      </li>
      <li class="itemize">output the expressions in the SELECT list
      </li>
      <li class="itemize">Expression can be a column reference in the table, or an arithmetic expression over
      column refs
      </li>
      <li class="itemize">If you want to filter out the rows, you can use the <tspan font-family="ectt" font-size="1200">WHERE &#x003C;predicate&#x003E;</tspan>. Predicate is
      a truth function which evaluates to true or false. The simplest version is that they
      produce all the tuples that satisfy the predicate. It outputs the expressions each of the
      tuples that are in the select list.</li></ul>
<a 
 id="Q1-1-19"></a>
<h4 class="likesubsectionHead"><a 
 id="x1-150009"></a>SELECT Distinct</h4>
    <!--l. 200-->
<div class="lstlisting" id="listing-6"><span class="label"><a 
 id="x1-15001r1"></a><tspan font-family="ecrm" font-size="0600">1</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">SELECT</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">DISTINCT</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">S</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">name</tspan><tspan font-family="ecrm" font-size="1000">,</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">S</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">gpa</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-15002r2"></a><tspan font-family="ecrm" font-size="0600">2</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">FROM</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">students</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">S</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-15003r3"></a><tspan font-family="ecrm" font-size="0600">3</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">WHERE</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">S</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">dept</tspan><tspan font-family="ecrm" font-size="1000">=</tspan><tspan font-family="ecrm" font-size="1000">&#8217;</tspan><tspan font-family="ecrm" font-size="1000">CS</tspan><tspan font-family="ecrm" font-size="1000">&#8217;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-15004r4"></a><tspan font-family="ecrm" font-size="0600">4</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan>
    </div>
      <ul class="itemize1">
      <li class="itemize">DISTINCT specifies before the output is sent to client, we should removal of duplicate
      rows before output
                                                                                         
                                                                                         
      </li>
      <li class="itemize">can refer to the students table as &#8220;S", this is called an alias</li></ul>
<a 
 id="x1-15005r18"></a>
<h3 class="sectionHead"><span class="titlemark">1.10   </span> <a 
 id="x1-1600010"></a>ORDER BY</h3>
<!--l. 211--><p class="noindent" >You can order the output before you actually output <!--l. 212-->
<div class="lstlisting" id="listing-7"><span class="label"><a 
 id="x1-16001r1"></a><tspan font-family="ecrm" font-size="0600">1</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">SELECT</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">S</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">name</tspan><tspan font-family="ecrm" font-size="1000">,</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">S</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">gpa</tspan><tspan font-family="ecrm" font-size="1000">,</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">S</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">age</tspan><tspan font-family="cmsy" font-size="10">*</tspan><tspan font-family="ecrm" font-size="1000">2</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">AS</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">a2</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-16002r2"></a><tspan font-family="ecrm" font-size="0600">2</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">FROM</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">Students</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">S</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-16003r3"></a><tspan font-family="ecrm" font-size="0600">3</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">WHERE</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">S</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">dept</tspan><tspan font-family="ecrm" font-size="1000">=</tspan><tspan font-family="ecrm" font-size="1000">&#8217;</tspan><tspan font-family="ecrm" font-size="1000">CS</tspan><tspan font-family="ecrm" font-size="1000">&#8217;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-16004r4"></a><tspan font-family="ecrm" font-size="0600">4</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">ORDER</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">BY</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">S</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">gpa</tspan><tspan font-family="ecrm" font-size="1000">,</tspan><tspan font-family="ecrm" font-size="1000">S</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">name</tspan><tspan font-family="ecrm" font-size="1000">,</tspan><tspan font-family="ecrm" font-size="1000">a2</tspan><tspan font-family="ecrm" font-size="1000">;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-16005r5"></a><tspan font-family="ecrm" font-size="0600">5</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan>
    </div>
<!--l. 218--><p class="indent" >    We want the name, gpa, and we want the age*2 and we rename that column as a2. We order
by the gpa, name, and a2.
      <ul class="itemize1">
      <li class="itemize">ORDER BY clause specifies output to be sorted. It sorts in <tspan font-family="ecbx" font-size="1200">Lexicographic </tspan>ordering.
      It means we order by gpa, if there is tie on gpa, we order by name, and then if there
      is tie on both name and gpa, then we order by a2.
      </li>
      <li class="itemize">Obviously must refer to columns in the output. That is what we are sorting.
           <ul class="itemize2">
           <li class="itemize">Note the AS clause for naming output columns
           </li>
           <li class="itemize">AS clause allows us to order by arithmetic arithmetic expressions.</li></ul>
      </li></ul>
      <ul class="itemize1">
      <li class="itemize">You can order by ascending or descending. Default is ascending. <!--l. 232-->
      <div class="lstlisting" id="listing-8"><span class="label"><a 
 id="x1-16006r1"></a><tspan font-family="ecrm" font-size="0600">1</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">ORDER</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">BY</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">S</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">gpa</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">DESC</tspan><tspan font-family="ecrm" font-size="1000">,</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">S</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">name</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">ASC</tspan><tspan font-family="ecrm" font-size="1000">,</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">a2</tspan><tspan font-family="ecrm" font-size="1000">;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-16007r2"></a><tspan font-family="ecrm" font-size="0600">2</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan>
      
      </div>
      </li>
      <li class="itemize">Can mix and match lexicographically. So for each one, you can choose how you would want
      to order them.</li></ul>
<a 
 id="x1-16008r21"></a>
<h3 class="sectionHead"><span class="titlemark">1.11   </span> <a 
 id="x1-1700011"></a>LIMIT</h3>
    <!--l. 239-->
<div class="lstlisting" id="listing-9"><span class="label"><a 
 id="x1-17001r1"></a><tspan font-family="ecrm" font-size="0600">1</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">SELECT</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">S</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">name</tspan><tspan font-family="ecrm" font-size="1000">,</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">S</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">gpa</tspan><tspan font-family="ecrm" font-size="1000">,</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">S</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">age</tspan><tspan font-family="cmsy" font-size="10">*</tspan><tspan font-family="ecrm" font-size="1000">2</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">AS</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">a2</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-17002r2"></a><tspan font-family="ecrm" font-size="0600">2</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">FROM</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">Students</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">S</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-17003r3"></a><tspan font-family="ecrm" font-size="0600">3</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">WHERE</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">S</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">dept</tspan><tspan font-family="ecrm" font-size="1000">=</tspan><tspan font-family="ecrm" font-size="1000">&#8217;</tspan><tspan font-family="ecrm" font-size="1000">CS</tspan><tspan font-family="ecrm" font-size="1000">&#8217;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-17004r4"></a><tspan font-family="ecrm" font-size="0600">4</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">ORDER</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">BY</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">S</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">gpa</tspan><tspan font-family="ecrm" font-size="1000">,</tspan><tspan font-family="ecrm" font-size="1000">S</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">name</tspan><tspan font-family="ecrm" font-size="1000">,</tspan><tspan font-family="ecrm" font-size="1000">a2</tspan><tspan font-family="ecrm" font-size="1000">;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-17005r5"></a><tspan font-family="ecrm" font-size="0600">5</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">LIMIT</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">3;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-17006r6"></a><tspan font-family="ecrm" font-size="0600">6</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan>
    </div>
<!--l. 246--><p class="indent" >    You can limit the output to a number of rows. Although you order by gpa, name and a2, we&#8217;re
only going to see the first 3 rows in that order. The argument is the number of rows you want to
see.
                                                                                         
                                                                                         
<!--l. 249--><p class="indent" >    We typically use with ORDER BY
      <ul class="itemize1">
      <li class="itemize">otherwise the output is non-deterministic. You don&#8217;t know which rows you&#8217;ll get. It
      would not be in any particular order.
      </li>
      <li class="itemize">So LIMIT without ORDER BY is not a &#8220;pure" declarative construct in that case
      -output since it doesn&#8217;t specify which rows you want.
      </li>
      <li class="itemize">You usually use order by just so you can see a few items in the table and you don&#8217;t
      need to see everything.</li></ul>
<a 
 id="x1-17007r22"></a>
<h3 class="sectionHead"><span class="titlemark">1.12   </span> <a 
 id="x1-1800012"></a>Aggregates</h3>
    <!--l. 259-->
<div class="lstlisting" id="listing-10"><span class="label"><a 
 id="x1-18001r1"></a><tspan font-family="ecrm" font-size="0600">1</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">SELECT</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">[</tspan><tspan font-family="ecrm" font-size="1000">DISTINCT</tspan><tspan font-family="ecrm" font-size="1000">]</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">AVG</tspan><tspan font-family="ecrm" font-size="1000">(</tspan><tspan font-family="ecrm" font-size="1000">S</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">gpa</tspan><tspan font-family="ecrm" font-size="1000">)</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-18002r2"></a><tspan font-family="ecrm" font-size="0600">2</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">FROM</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">Students</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">S</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-18003r3"></a><tspan font-family="ecrm" font-size="0600">3</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">WHERE</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">S</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">dept</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">=</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#8217;</tspan><tspan font-family="ecrm" font-size="1000">CS</tspan><tspan font-family="ecrm" font-size="1000">&#8217;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-18004r4"></a><tspan font-family="ecrm" font-size="0600">4</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan>
    </div>
<!--l. 264--><p class="indent" >    A powerful thing you can do in sql is that you can create an aggregate function over that
table. They take a batch of tuples(a batch of values in a column) and compute an aggregate
function of that column.
<!--l. 267--><p class="indent" >    In this, we are selecting the average gpa of the students.
      <ul class="itemize1">
      <li class="itemize">Before producing output, we get all the relevant rows in the table from the WHERE
      clause  and  then  for  the  GPA  column,  we  compute  avereage  over  all  the  rows.  So
      before computing the output, we are creating a summary (aggregate) of the arithmetic
      expression AVG(S.gpa)
      </li>
      <li class="itemize">produces 1 row of output with one column in this case
      </li>
      <li class="itemize">There are other aggregates: SUM, COUNT, MAX, MIN. Some even allow you to create
      your own aggregate.</li></ul>
<a 
 id="x1-18005r23"></a>
<h3 class="sectionHead"><span class="titlemark">1.13   </span> <a 
 id="x1-1900013"></a>GROUP BY</h3>
    <!--l. 278-->
<div class="lstlisting" id="listing-11"><span class="label"><a 
 id="x1-19001r1"></a><tspan font-family="ecrm" font-size="0600">1</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">SELECT</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">[</tspan><tspan font-family="ecrm" font-size="1000">DISTINCT</tspan><tspan font-family="ecrm" font-size="1000">]</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">AVG</tspan><tspan font-family="ecrm" font-size="1000">(</tspan><tspan font-family="ecrm" font-size="1000">S</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">gpa</tspan><tspan font-family="ecrm" font-size="1000">)</tspan><tspan font-family="ecrm" font-size="1000">,</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">S</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">dept</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-19002r2"></a><tspan font-family="ecrm" font-size="0600">2</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">FROM</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">Students</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">S</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-19003r3"></a><tspan font-family="ecrm" font-size="0600">3</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">GROUP</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">BY</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">S</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">dept</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-19004r4"></a><tspan font-family="ecrm" font-size="0600">4</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan>
    </div>
<!--l. 283--><p class="indent" >    Sometimes you want to compute aggregate for each group where you break table into groups.
For this, you use GROUP BY. You get the average gpa and dept, grouped by dept. This partition
the table into gruops with the same GROUP BY values. So all the CS students will be in the same
                                                                                         
                                                                                         
groups. The GROUP BY can also be a list of columns. You can add dept and the year
of graduation and then there would be a different group for cs students in different
years.
      <ul class="itemize1">
      <li class="itemize">Partition table into groups with same GROUP BY column values. You can group by
      a list of columns.
      </li>
      <li class="itemize">The number of rows in the output (also called <tspan font-family="ecbx" font-size="1200">Cardinality </tspan>of output) = number of
      distinct group values.
      </li>
      <li class="itemize">GROUP BY values can also be in the SELECT list. So you can use dept to tag each
      group with the department so then you can see the department and then the average
      of each department.</li></ul>
<a 
 id="x1-19005r24"></a>
<h3 class="sectionHead"><span class="titlemark">1.14   </span> <a 
 id="x1-2000014"></a>HAVING</h3>
    <!--l. 299-->
<div class="lstlisting" id="listing-12"><span class="label"><a 
 id="x1-20001r1"></a><tspan font-family="ecrm" font-size="0600">1</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">SELECT</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">[</tspan><tspan font-family="ecrm" font-size="1000">DISTINCT</tspan><tspan font-family="ecrm" font-size="1000">]</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">AVG</tspan><tspan font-family="ecrm" font-size="1000">(</tspan><tspan font-family="ecrm" font-size="1000">S</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">gpa</tspan><tspan font-family="ecrm" font-size="1000">)</tspan><tspan font-family="ecrm" font-size="1000">,</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">S</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">dept</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-20002r2"></a><tspan font-family="ecrm" font-size="0600">2</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">FROM</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">Students</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">S</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-20003r3"></a><tspan font-family="ecrm" font-size="0600">3</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">GROUP</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">BY</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">S</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">dept</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-20004r4"></a><tspan font-family="ecrm" font-size="0600">4</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">HAVING</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">COUNT</tspan><tspan font-family="ecrm" font-size="1000">(</tspan><tspan font-family="cmsy" font-size="10">*</tspan><tspan font-family="ecrm" font-size="1000">)</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x003E;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">2</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-20005r5"></a><tspan font-family="ecrm" font-size="0600">5</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan>
    </div>
<!--l. 305--><p class="indent" >    The <tspan font-family="ecbx" font-size="1200">COUNT(*) </tspan>gets the number of records in the group. COUNT(*) is an aggregate.
HAVING filters out groups where the COUNT(*) &#x003E; 2 is false. HAVING is applied <tspan font-family="ecti" font-size="1200">after </tspan>grouping
and aggregation and so can contain anything that could go in the SELECT list. We first group by
department, then compute counts for each group, then eval the HAVING clause on those groups,
keeping only the ones that satisfy the condition.
<!--l. 311--><p class="indent" >    HAVING can <tspan font-family="ecbx" font-size="1200">only </tspan>be used in aggregate queries and is <tspan font-family="ecbx" font-size="1200">optional</tspan>
<a 
 id="x1-20006r25"></a>
<h3 class="sectionHead"><span class="titlemark">1.15   </span> <a 
 id="x1-2100015"></a>Putting it all together</h3>
    <!--l. 313-->
<div class="lstlisting" id="listing-13"><span class="label"><a 
 id="x1-21001r1"></a><tspan font-family="ecrm" font-size="0600">1</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">SELECT</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">S</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">dept</tspan><tspan font-family="ecrm" font-size="1000">,</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">AVG</tspan><tspan font-family="ecrm" font-size="1000">(</tspan><tspan font-family="ecrm" font-size="1000">S</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">gpa</tspan><tspan font-family="ecrm" font-size="1000">)</tspan><tspan font-family="ecrm" font-size="1000">,</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">COUNT</tspan><tspan font-family="ecrm" font-size="1000">(</tspan><tspan font-family="cmsy" font-size="10">*</tspan><tspan font-family="ecrm" font-size="1000">)</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-21002r2"></a><tspan font-family="ecrm" font-size="0600">2</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">FROM</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">Students</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">S</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-21003r3"></a><tspan font-family="ecrm" font-size="0600">3</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">WHERE</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">S</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">gender</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">=</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#8217;</tspan><tspan font-family="ecrm" font-size="1000">F</tspan><tspan font-family="ecrm" font-size="1000">&#8217;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-21004r4"></a><tspan font-family="ecrm" font-size="0600">4</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">GROUP</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">BY</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">S</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">dept</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-21005r5"></a><tspan font-family="ecrm" font-size="0600">5</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">HAVING</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">COUNT</tspan><tspan font-family="ecrm" font-size="1000">(</tspan><tspan font-family="cmsy" font-size="10">*</tspan><tspan font-family="ecrm" font-size="1000">)</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x003E;=</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">2</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-21006r6"></a><tspan font-family="ecrm" font-size="0600">6</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">ORDER</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">BY</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">S</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">dept</tspan><tspan font-family="ecrm" font-size="1000">;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-21007r7"></a><tspan font-family="ecrm" font-size="0600">7</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan>
    </div>
      <dl class="enumerate"><dt class="enumerate">
   1. </dt><dd 
class="enumerate">Start from the FROM clause. It says we are querying the students table
      </dd><dt class="enumerate">
   2. </dt><dd 
class="enumerate">From the students table, we look at the WHERE clause. It shows that we only look at
      students with S.gender = &#8217;F&#8217;
      </dd><dt class="enumerate">
   3. </dt><dd 
class="enumerate">We take the students. In the GROUP BY it says we want to group by department.
                                                                                         
                                                                                         
      </dd><dt class="enumerate">
   4. </dt><dd 
class="enumerate">We only want to look at those groups in HAVING clause with 2 or more <tspan font-family="ecbx" font-size="1200">tuples </tspan>that
      aren&#8217;t for female gender
      </dd><dt class="enumerate">
   5. </dt><dd 
class="enumerate">We want to compute the average gpa, the count of students that are female, and the
      name of the department.
      </dd><dt class="enumerate">
   6. </dt><dd 
class="enumerate">We then order the by the department name</dd></dl>
<a 
 id="x1-21014r26"></a>
<h3 class="sectionHead"><span class="titlemark">1.16   </span> <a 
 id="x1-2200016"></a>DISTINCT Aggregates</h3>
<!--l. 333--><p class="noindent" >DISTINCT keyword is used in two <tspan font-family="ecbx" font-size="1200">different </tspan>places. One in aggregate functions and the other we
use after SELECT to remove duplicates from the output. <!--l. 335-->
<div class="lstlisting" id="listing-14"><span class="label"><a 
 id="x1-22001r1"></a><tspan font-family="ecrm" font-size="0600">1</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">SELECT</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">COUNT</tspan><tspan font-family="ecrm" font-size="1000">(</tspan><tspan font-family="ecrm" font-size="1000">DISTINCT</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">S</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">name</tspan><tspan font-family="ecrm" font-size="1000">)</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">/</tspan><tspan font-family="cmsy" font-size="10">*</tspan><tspan font-family="ecrm" font-size="1000">used</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">inside</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">aggregate</tspan><tspan font-family="cmsy" font-size="10">*</tspan><tspan font-family="ecrm" font-size="1000">/</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-22002r2"></a><tspan font-family="ecrm" font-size="0600">2</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">SELECT</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">DISTINCT</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">COUNT</tspan><tspan font-family="ecrm" font-size="1000">(</tspan><tspan font-family="ecrm" font-size="1000">S</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">name</tspan><tspan font-family="ecrm" font-size="1000">)</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">/</tspan><tspan font-family="cmsy" font-size="10">*</tspan><tspan font-family="ecrm" font-size="1000">used</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">to</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">remove</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">duplicate</tspan><tspan font-family="cmsy" font-size="10">*</tspan><tspan font-family="ecrm" font-size="1000">/</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-22003r3"></a><tspan font-family="ecrm" font-size="0600">3</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan>
    </div>
<!--l. 339--><p class="indent" >    For the first one, we remove all duplicates for names before doing counting. If we have 2 bobs
and 4 Marrys, we would have only 2 distinct names.
<!--l. 341--><p class="indent" >    In the second case, we would count and get 6, and before sending to client, we would remove
duplicate rows. However, there would only be one row out of the count query, it would have value
of 6 so we would return 6. So in this case, the DISTINCT keyword doesn&#8217;t have an effect.
<br 
class="newline" />What is this asking for? <!--l. 346-->
<div class="lstlisting" id="listing-15"><span class="label"><a 
 id="x1-22004r1"></a><tspan font-family="ecrm" font-size="0600">1</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">SELECT</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">S</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">name</tspan><tspan font-family="ecrm" font-size="1000">,</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">AVG</tspan><tspan font-family="ecrm" font-size="1000">(</tspan><tspan font-family="ecrm" font-size="1000">S</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">gpa</tspan><tspan font-family="ecrm" font-size="1000">)</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-22005r2"></a><tspan font-family="ecrm" font-size="0600">2</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">FROM</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">Students</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">S</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-22006r3"></a><tspan font-family="ecrm" font-size="0600">3</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">GROUP</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">BY</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">S</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">dept</tspan><tspan font-family="ecrm" font-size="1000">;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-22007r4"></a><tspan font-family="ecrm" font-size="0600">4</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan>
    </div>
<!--l. 351--><p class="indent" >    We are grouping things by department, and then for each department we are getting the
average gpa which makes sense. But how are we going to get <tspan font-family="ectt" font-size="1200">S.name</tspan>? Each department may have
multiple S.names. This is therefore illegal. We are using a column in the SELECT list which is not
in the GROUP BY clause and is not nested inside a AGGREGATE clause so there is no way to
boil down to one value.
<a 
 id="x1-22008r27"></a>
<h3 class="sectionHead"><span class="titlemark">1.17   </span> <a 
 id="x1-2300017"></a>Summary</h3>
      <ul class="itemize1">
      <li class="itemize">Relational model has <tspan font-family="ecbx" font-size="1200">well-defined query semantics</tspan>. This means all queries you
      type have single meaning. So regardless of how they are implemented, the answers are
      well-defined.
      </li>
      <li class="itemize">Modern SQL extends &#8220;pure" relational model. This enables duplicate rows, aggregates,
      ordering of output which the original model did not have.
                                                                                         
                                                                                         
      </li>
      <li class="itemize">There are many ways to write query. DBMS figures out a fast way to execute a query
      regardless of how it is written. There are typically many ways to write the query and
      regardless of how you wrote it, SQL will figure out how to write it.</li></ul>
                                                                                         
                                                                                         
                                                                                         
                                                                                         
                                                                                         
                                                                                         
    <h2 class="chapterHead"><span class="titlemark">Chapter&#x00A0;2</span><br /><a 
 id="x1-240002"></a>Lecture 2: SQL II</h2>
<a 
 id="Q1-1-30"></a>
<h3 class="likesectionHead"><a 
 id="x1-250002"></a>Order of Evaluation</h3>
<!--l. 3--><p class="noindent" >We have been looking at SQL Queries that are defined over a single table. <hr class="figure"><div class="figure" 
>
                                                                                         
                                                                                         
<a 
 id="x1-250011"></a>
                                                                                         
                                                                                         
<!--l. 6--><p class="noindent" >
<br /> <div class="caption" 
><span class="id">Figure&#x00A0;2.1: </span><span  
class="content">Conceptual SQL Evaluation</span></div><!--tex4ht:label?: x1-250011 -->
                                                                                         
                                                                                         
<!--l. 8--><p class="indent" >    </div><hr class="endfigure">
      <dl class="enumerate"><dt class="enumerate">
   1. </dt><dd 
class="enumerate">We start at the FORM clause
      </dd><dt class="enumerate">
   2. </dt><dd 
class="enumerate">Then we look at the WHERE clause to see what things satisfy predicate and what
      rows don&#8217;t so we can eliminate
      </dd><dt class="enumerate">
   3. </dt><dd 
class="enumerate">SELECT clause tells us what columns we keep and what we can project away. We keep
      columns that are referenced in SELECT and anywhere else in query.
      </dd><dt class="enumerate">
   4. </dt><dd 
class="enumerate">GROUP BY: tells us if tuples are going to be grouped up
      </dd><dt class="enumerate">
   5. </dt><dd 
class="enumerate">HAVING: has predicates about the groups, telling us if it should be eliminated in
      output
      </dd><dt class="enumerate">
   6. </dt><dd 
class="enumerate">DISTINCT: tells us to eliminate duplicated in output
      </dd><dt class="enumerate">
   7. </dt><dd 
class="enumerate">Optional ORDER BY and LIMIT: applied at end to &#8220;format" output.</dd></dl>
<a 
 id="x1-25009r28"></a>
<h3 class="sectionHead"><span class="titlemark">2.1   </span> <a 
 id="x1-260001"></a>Join Queries</h3>
<!--l. 22--><p class="noindent" >We look at queries on multiple tables. The difference is that now the FROM clause has multiple
tables. It&#8217;s like a query over a single table that was generated over the cross product of the
relations in the from clause.
<a 
 id="x1-26001r10"></a>
<h4 class="subsectionHead"><span class="titlemark">2.1.1   </span> <a 
 id="x1-270001"></a>Cross (Cartesian) Product</h4>
<!--l. 26--><p class="noindent" >We take all pairs of tuples and concatenate them <br 
class="newline" /><!--tex4ht:inline--><div class="tabular"> <table id="TBL-5" class="tabular" 
cellspacing="0" cellpadding="0"  
><colgroup id="TBL-5-1g"><col 
id="TBL-5-1"></colgroup><colgroup id="TBL-5-2g"><col 
id="TBL-5-2"></colgroup><colgroup id="TBL-5-3g"><col 
id="TBL-5-3"></colgroup><colgroup id="TBL-5-4g"><col 
id="TBL-5-4"></colgroup><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-5-1-"><td colspan="3" style="white-space:nowrap; text-align:center;" id="TBL-5-1-1"  
class="td11"></td>         <div class="multicolumn"  style="white-space:nowrap; text-align:center;">Sailors</div></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-5-2-"><td  style="white-space:nowrap; text-align:center;" id="TBL-5-2-1"  
class="td11">sid</td><td  style="white-space:nowrap; text-align:center;" id="TBL-5-2-2"  
class="td11"> sname </td><td  style="white-space:nowrap; text-align:center;" id="TBL-5-2-3"  
class="td11">rating</td><td  style="white-space:nowrap; text-align:center;" id="TBL-5-2-4"  
class="td11">age</td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-5-3-"><td  style="white-space:nowrap; text-align:center;" id="TBL-5-3-1"  
class="td11"> 1 </td><td  style="white-space:nowrap; text-align:center;" id="TBL-5-3-2"  
class="td11"> Popeye </td><td  style="white-space:nowrap; text-align:center;" id="TBL-5-3-3"  
class="td11">  10  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-5-3-4"  
class="td11"> 22 </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-5-4-"><td  style="white-space:nowrap; text-align:center;" id="TBL-5-4-1"  
class="td11"> 2 </td><td  style="white-space:nowrap; text-align:center;" id="TBL-5-4-2"  
class="td11">OliveOyl</td><td  style="white-space:nowrap; text-align:center;" id="TBL-5-4-3"  
class="td11">  11  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-5-4-4"  
class="td11"> 39 </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-5-5-"><td  style="white-space:nowrap; text-align:center;" id="TBL-5-5-1"  
class="td11"> 3 </td><td  style="white-space:nowrap; text-align:center;" id="TBL-5-5-2"  
class="td11"> Garfield </td><td  style="white-space:nowrap; text-align:center;" id="TBL-5-5-3"  
class="td11">  1   </td><td  style="white-space:nowrap; text-align:center;" id="TBL-5-5-4"  
class="td11"> 27 </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-5-6-"><td  style="white-space:nowrap; text-align:center;" id="TBL-5-6-1"  
class="td11"> 4 </td><td  style="white-space:nowrap; text-align:center;" id="TBL-5-6-2"  
class="td11">  Bob   </td><td  style="white-space:nowrap; text-align:center;" id="TBL-5-6-3"  
class="td11">  5   </td><td  style="white-space:nowrap; text-align:center;" id="TBL-5-6-4"  
class="td11"> 19 </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-5-7-"><td  style="white-space:nowrap; text-align:center;" id="TBL-5-7-1"  
class="td11">  </td></tr></table>
</div> <!--tex4ht:inline--><div class="tabular"> <table id="TBL-6" class="tabular" 
cellspacing="0" cellpadding="0"  
><colgroup id="TBL-6-1g"><col 
id="TBL-6-1"></colgroup><colgroup id="TBL-6-2g"><col 
id="TBL-6-2"></colgroup><colgroup id="TBL-6-3g"><col 
id="TBL-6-3"></colgroup><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-6-1-"><td colspan="3" style="white-space:nowrap; text-align:center;" id="TBL-6-1-1"  
class="td11">   <div class="multicolumn"  style="white-space:nowrap; text-align:center;">Reserve</div></td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-6-2-"><td  style="white-space:nowrap; text-align:center;" id="TBL-6-2-1"  
class="td11">sid</td> <td  style="white-space:nowrap; text-align:center;" id="TBL-6-2-2"  
class="td11">bid</td> <td  style="white-space:nowrap; text-align:center;" id="TBL-6-2-3"  
class="td11"> day </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-6-3-"><td  style="white-space:nowrap; text-align:center;" id="TBL-6-3-1"  
class="td11"> 1 </td><td  style="white-space:nowrap; text-align:center;" id="TBL-6-3-2"  
class="td11">102</td><td  style="white-space:nowrap; text-align:center;" id="TBL-6-3-3"  
class="td11"> 9/12 </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-6-4-"><td  style="white-space:nowrap; text-align:center;" id="TBL-6-4-1"  
class="td11"> 2 </td><td  style="white-space:nowrap; text-align:center;" id="TBL-6-4-2"  
class="td11">102</td><td  style="white-space:nowrap; text-align:center;" id="TBL-6-4-3"  
class="td11"> 9/13 </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-6-5-"><td  style="white-space:nowrap; text-align:center;" id="TBL-6-5-1"  
class="td11"> 1 </td><td  style="white-space:nowrap; text-align:center;" id="TBL-6-5-2"  
class="td11">101</td><td  style="white-space:nowrap; text-align:center;" id="TBL-6-5-3"  
class="td11">10/01</td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-6-6-"><td  style="white-space:nowrap; text-align:center;" id="TBL-6-6-1"  
class="td11">  </td> </tr></table>
                                                                                         
                                                                                         
</div> <!--tex4ht:inline--><div class="tabular"> <table id="TBL-7" class="tabular" 
cellspacing="0" cellpadding="0"  
><colgroup id="TBL-7-1g"><col 
id="TBL-7-1"></colgroup><colgroup id="TBL-7-2g"><col 
id="TBL-7-2"></colgroup><colgroup id="TBL-7-3g"><col 
id="TBL-7-3"></colgroup><colgroup id="TBL-7-4g"><col 
id="TBL-7-4"></colgroup><colgroup id="TBL-7-5g"><col 
id="TBL-7-5"></colgroup><colgroup id="TBL-7-6g"><col 
id="TBL-7-6"></colgroup><colgroup id="TBL-7-7g"><col 
id="TBL-7-7"></colgroup><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-7-1-"><td colspan="3" style="white-space:nowrap; text-align:center;" id="TBL-7-1-1"  
class="td11"></td>              <div class="multicolumn"  style="white-space:nowrap; text-align:center;">Joined Query</div>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-7-2-"><td  style="white-space:nowrap; text-align:center;" id="TBL-7-2-1"  
class="td11">sid</td><td  style="white-space:nowrap; text-align:center;" id="TBL-7-2-2"  
class="td11"> sname  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-7-2-3"  
class="td11">rating</td><td  style="white-space:nowrap; text-align:center;" id="TBL-7-2-4"  
class="td11">age</td><td  style="white-space:nowrap; text-align:center;" id="TBL-7-2-5"  
class="td11">sid</td><td  style="white-space:nowrap; text-align:center;" id="TBL-7-2-6"  
class="td11">bid</td><td  style="white-space:nowrap; text-align:center;" id="TBL-7-2-7"  
class="td11"> day </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-7-3-"><td  style="white-space:nowrap; text-align:center;" id="TBL-7-3-1"  
class="td11"> 1 </td><td  style="white-space:nowrap; text-align:center;" id="TBL-7-3-2"  
class="td11"> Popeye </td><td  style="white-space:nowrap; text-align:center;" id="TBL-7-3-3"  
class="td11">  10  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-7-3-4"  
class="td11"> 22 </td><td  style="white-space:nowrap; text-align:center;" id="TBL-7-3-5"  
class="td11"> 1 </td><td  style="white-space:nowrap; text-align:center;" id="TBL-7-3-6"  
class="td11">102</td><td  style="white-space:nowrap; text-align:center;" id="TBL-7-3-7"  
class="td11"> 9/12 </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-7-4-"><td  style="white-space:nowrap; text-align:center;" id="TBL-7-4-1"  
class="td11"> 1 </td><td  style="white-space:nowrap; text-align:center;" id="TBL-7-4-2"  
class="td11"> Popeye </td><td  style="white-space:nowrap; text-align:center;" id="TBL-7-4-3"  
class="td11">  10  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-7-4-4"  
class="td11"> 22 </td><td  style="white-space:nowrap; text-align:center;" id="TBL-7-4-5"  
class="td11"> 2 </td><td  style="white-space:nowrap; text-align:center;" id="TBL-7-4-6"  
class="td11">102</td><td  style="white-space:nowrap; text-align:center;" id="TBL-7-4-7"  
class="td11"> 9/13 </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-7-5-"><td  style="white-space:nowrap; text-align:center;" id="TBL-7-5-1"  
class="td11"> 1 </td><td  style="white-space:nowrap; text-align:center;" id="TBL-7-5-2"  
class="td11"> Popeye </td><td  style="white-space:nowrap; text-align:center;" id="TBL-7-5-3"  
class="td11">  10  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-7-5-4"  
class="td11"> 22 </td><td  style="white-space:nowrap; text-align:center;" id="TBL-7-5-5"  
class="td11"> 1 </td><td  style="white-space:nowrap; text-align:center;" id="TBL-7-5-6"  
class="td11">101</td><td  style="white-space:nowrap; text-align:center;" id="TBL-7-5-7"  
class="td11">10/01</td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-7-6-"><td  style="white-space:nowrap; text-align:center;" id="TBL-7-6-1"  
class="td11"> 2 </td><td  style="white-space:nowrap; text-align:center;" id="TBL-7-6-2"  
class="td11">OliveOyl</td><td  style="white-space:nowrap; text-align:center;" id="TBL-7-6-3"  
class="td11">  11  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-7-6-4"  
class="td11"> 39 </td><td  style="white-space:nowrap; text-align:center;" id="TBL-7-6-5"  
class="td11"> 1 </td><td  style="white-space:nowrap; text-align:center;" id="TBL-7-6-6"  
class="td11">102</td><td  style="white-space:nowrap; text-align:center;" id="TBL-7-6-7"  
class="td11"> 9/12 </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-7-7-"><td  style="white-space:nowrap; text-align:center;" id="TBL-7-7-1"  
class="td11"><img 
src="CS186Main0x.png" alt=".
..  "  class="vdots" ></td><td  style="white-space:nowrap; text-align:center;" id="TBL-7-7-2"  
class="td11">   <img 
src="CS186Main1x.png" alt=".
..  "  class="vdots" >    </td><td  style="white-space:nowrap; text-align:center;" id="TBL-7-7-3"  
class="td11">  <img 
src="CS186Main2x.png" alt=".
..  "  class="vdots" >   </td><td  style="white-space:nowrap; text-align:center;" id="TBL-7-7-4"  
class="td11"><img 
src="CS186Main3x.png" alt=".
..  "  class="vdots" > </td><td  style="white-space:nowrap; text-align:center;" id="TBL-7-7-5"  
class="td11"><img 
src="CS186Main4x.png" alt=".
..  "  class="vdots" ></td><td  style="white-space:nowrap; text-align:center;" id="TBL-7-7-6"  
class="td11"> <img 
src="CS186Main5x.png" alt=".
..  "  class="vdots" > </td><td  style="white-space:nowrap; text-align:center;" id="TBL-7-7-7"  
class="td11"> <img 
src="CS186Main6x.png" alt=".
..  "  class="vdots" >  </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-7-8-"><td  style="white-space:nowrap; text-align:center;" id="TBL-7-8-1"  
class="td11">  </td> </tr></table></div>
<a 
 id="x1-27001r34"></a>
<h4 class="subsectionHead"><span class="titlemark">2.1.2   </span> <a 
 id="x1-280002"></a>Sailors who have reserved a boat</h4>
    <!--l. 73-->
<div class="lstlisting" id="listing-16"><span class="label"><a 
 id="x1-28001r1"></a><tspan font-family="ecrm" font-size="0600">1</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">SELECT</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">Sailors</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">sid</tspan><tspan font-family="ecrm" font-size="1000">,</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">Sailors</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">sname</tspan><tspan font-family="ecrm" font-size="1000">,</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">Reserve</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">bid</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-28002r2"></a><tspan font-family="ecrm" font-size="0600">2</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">FROM</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">Sailors</tspan><tspan font-family="ecrm" font-size="1000">,</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">Reserve</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-28003r3"></a><tspan font-family="ecrm" font-size="0600">3</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">WHERE</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">Sailors</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">sid</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">=</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">Reserve</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">sid</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-28004r4"></a><tspan font-family="ecrm" font-size="0600">4</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan>
    </div>
<!--l. 78--><p class="indent" >    We see we want to use the <tspan font-family="ectt" font-size="1200">Sailors </tspan>and <tspan font-family="ectt" font-size="1200">Reserve </tspan>to generate our cross product. And
then we we want the values WHERE the <tspan font-family="ectt" font-size="1200">Sailors.sid = Reserve.sid</tspan>. We can then
cross out the ones where these are not the case. We are left with sailor id&#8217;s that match
reservations as if we were looking up reservation for each sailor. In the SELECT, we only
ask for: Sailors.sid, Sailors.sname, and Reserve.bid, so we can cross out all the other
columns.
<a 
 id="x1-28005r33"></a>
<h3 class="sectionHead"><span class="titlemark">2.2   </span> <a 
 id="x1-290002"></a>Column names and table aliases</h3>
    <!--l. 85-->
<div class="lstlisting" id="listing-17"><span class="label"><a 
 id="x1-29001r1"></a><tspan font-family="ecrm" font-size="0600">1</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">SELECT</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">Sailors</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">sid</tspan><tspan font-family="ecrm" font-size="1000">,</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">sname</tspan><tspan font-family="ecrm" font-size="1000">,</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">bid</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-29002r2"></a><tspan font-family="ecrm" font-size="0600">2</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">FROM</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">Sailors</tspan><tspan font-family="ecrm" font-size="1000">,</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">Reserve</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-29003r3"></a><tspan font-family="ecrm" font-size="0600">3</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">WHERE</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">Sailors</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">sid</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">=</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">Reserves</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">sid</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-29004r4"></a><tspan font-family="ecrm" font-size="0600">4</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-29005r5"></a><tspan font-family="ecrm" font-size="0600">5</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">SELECT</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">S</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">sid</tspan><tspan font-family="ecrm" font-size="1000">,</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">sname</tspan><tspan font-family="ecrm" font-size="1000">,</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">bid</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-29006r6"></a><tspan font-family="ecrm" font-size="0600">6</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">FROM</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">Sailors</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">AS</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">S</tspan><tspan font-family="ecrm" font-size="1000">,</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">Reserves</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">AS</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">R</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-29007r7"></a><tspan font-family="ecrm" font-size="0600">7</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">WHERE</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">S</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">sid</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">=</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">R</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">sid</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-29008r8"></a><tspan font-family="ecrm" font-size="0600">8</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan>
    </div>
<!--l. 94--><p class="indent" >    We are in the select clause and we get Sailors.sid so we need to distinguish which sid column
since both Sailors and Reserves had sid as a column. In this case, the <tspan font-family="ectt" font-size="1200">Sailors</tspan>.sid is the <tspan font-family="ecbx" font-size="1200">range</tspan>
<tspan font-family="ecbx" font-size="1200">variable</tspan>. It tells us we are ranging over the tuples of the Sailors table. sname and bid are both
non ambiguous because they are only in one table.
<!--l. 99--><p class="indent" >    The second query is the same query with it written slightly differently using <tspan font-family="ectt" font-size="1200">aliases</tspan>.
Whether or not they are capital does not matter in SQL <!--l. 101-->
<div class="lstlisting" id="listing-18"><span class="label"><a 
 id="x1-29009r1"></a><tspan font-family="ecrm" font-size="0600">1</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">SELECT</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">x</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">sname</tspan><tspan font-family="ecrm" font-size="1000">,</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">x</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">age</tspan><tspan font-family="ecrm" font-size="1000">,</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-29010r2"></a><tspan font-family="ecrm" font-size="0600">2</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">y</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">sname</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">AS</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">sname2</tspan><tspan font-family="ecrm" font-size="1000">,</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-29011r3"></a><tspan font-family="ecrm" font-size="0600">3</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">y</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">age</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">AS</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">age2</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-29012r4"></a><tspan font-family="ecrm" font-size="0600">4</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">FROM</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">Sailors</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">AS</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">x</tspan><tspan font-family="ecrm" font-size="1000">,</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">Sailors</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">AS</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">y</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-29013r5"></a><tspan font-family="ecrm" font-size="0600">5</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">WHERE</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">x</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">age</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x003E;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">y</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">age</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-29014r6"></a><tspan font-family="ecrm" font-size="0600">6</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan>
    </div>
      <ul class="itemize1">
      <li class="itemize">Table aliases in the FROM clause
           <ul class="itemize2">
           <li class="itemize">Needed when the same table used multiple times "self-join"
           </li>
           <li class="itemize">When you are using self-join, you must always alias so it knows which instance of
           Sailor you were talking about.</li></ul>
      </li>
                                                                                         
                                                                                         
      <li class="itemize">Column aliases in the SELECT clause</li></ul>
<!--l. 117--><p class="indent" >    In this case we are joining two of the same table together. We set one Sailor table as x and the
other Sailor table as y. We want it where the age of the x sailor is bigger than the age of the y
sailor. In the SELECT list we have specified Aliases so that the output column name will be
different.
<!--l. 121--><p class="indent" >    Now the final output of the list will be one where we look through all the possibilities and
include a list where the sname is older than sname2. <hr class="figure"><div class="figure" 
>
                                                                                         
                                                                                         
<a 
 id="x1-290152"></a>
                                                                                         
                                                                                         
<!--l. 125--><p class="noindent" >
<br /> <div class="caption" 
><span class="id">Figure&#x00A0;2.2: </span><span  
class="content">Using self-join and changing column name in output table</span></div><!--tex4ht:label?: x1-290152 -->
                                                                                         
                                                                                         
<!--l. 127--><p class="indent" >    </div><hr class="endfigure">
<a 
 id="x1-29016r36"></a>
<h3 class="sectionHead"><span class="titlemark">2.3   </span> <a 
 id="x1-300003"></a>Arithmetic Expressions</h3>
    <!--l. 129-->
<div class="lstlisting" id="listing-19"><span class="label"><a 
 id="x1-30001r1"></a><tspan font-family="ecrm" font-size="0600">1</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">SELECT</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">S</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">age</tspan><tspan font-family="ecrm" font-size="1000">,</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">S</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">age</tspan><tspan font-family="cmsy" font-size="10">-</tspan><tspan font-family="ecrm" font-size="1000">5</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">AS</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">age1</tspan><tspan font-family="ecrm" font-size="1000">,</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">2</tspan><tspan font-family="cmsy" font-size="10">*</tspan><tspan font-family="ecrm" font-size="1000">S</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">age</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">AS</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">age2</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-30002r2"></a><tspan font-family="ecrm" font-size="0600">2</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">FROM</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">Sailors</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">AS</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">S</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-30003r3"></a><tspan font-family="ecrm" font-size="0600">3</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">WHERE</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">S</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">sname</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">=</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#8217;</tspan><tspan font-family="ecrm" font-size="1000">Popeye</tspan><tspan font-family="ecrm" font-size="1000">&#8217;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-30004r4"></a><tspan font-family="ecrm" font-size="0600">4</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-30005r5"></a><tspan font-family="ecrm" font-size="0600">5</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">SELECT</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">S1</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">sname</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">AS</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">name1</tspan><tspan font-family="ecrm" font-size="1000">,</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">S2</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">sname</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">AS</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">name2</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-30006r6"></a><tspan font-family="ecrm" font-size="0600">6</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">FROM</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">Sailors</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">AS</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">S1</tspan><tspan font-family="ecrm" font-size="1000">,</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">Sailors</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">AS</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">S2</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-30007r7"></a><tspan font-family="ecrm" font-size="0600">7</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">WHERE</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">2</tspan><tspan font-family="cmsy" font-size="10">*</tspan><tspan font-family="ecrm" font-size="1000">S1</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">rating</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">=</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">S2</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">rating</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="cmsy" font-size="10">-</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">1</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-30008r8"></a><tspan font-family="ecrm" font-size="0600">8</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan>
    </div>
<!--l. 138--><p class="indent" >    Another thing you can do in SELECT list is specify arithmetic expressions. You can add
arithmetic expressions in the SELECT clause or the WHERE clause. You can do arithmetic
wherever you&#8217;d like with integer type columns.
<a 
 id="x1-30009r38"></a>
<h3 class="sectionHead"><span class="titlemark">2.4   </span> <a 
 id="x1-310004"></a>SQL Calculator</h3>
    <!--l. 142-->
<div class="lstlisting" id="listing-20"><span class="label"><a 
 id="x1-31001r1"></a><tspan font-family="ecrm" font-size="0600">1</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">SELECT</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-31002r2"></a><tspan font-family="ecrm" font-size="0600">2</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">log</tspan><tspan font-family="ecrm" font-size="1000">(1000)</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">as</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">three</tspan><tspan font-family="ecrm" font-size="1000">,</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-31003r3"></a><tspan font-family="ecrm" font-size="0600">3</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">exp</tspan><tspan font-family="ecrm" font-size="1000">(</tspan><tspan font-family="ecrm" font-size="1000">ln</tspan><tspan font-family="ecrm" font-size="1000">(2)</tspan><tspan font-family="ecrm" font-size="1000">)</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">as</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">two</tspan><tspan font-family="ecrm" font-size="1000">,</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-31004r4"></a><tspan font-family="ecrm" font-size="0600">4</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">cos</tspan><tspan font-family="ecrm" font-size="1000">(0)</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">as</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">one</tspan><tspan font-family="ecrm" font-size="1000">,</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-31005r5"></a><tspan font-family="ecrm" font-size="0600">5</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">ln</tspan><tspan font-family="ecrm" font-size="1000">(2</tspan><tspan font-family="cmsy" font-size="10">*</tspan><tspan font-family="ecrm" font-size="1000">3)</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">=</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">ln</tspan><tspan font-family="ecrm" font-size="1000">(2)</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">+</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">ln</tspan><tspan font-family="ecrm" font-size="1000">(3)</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">as</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">sanity</tspan><tspan font-family="ecrm" font-size="1000">;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-31006r6"></a><tspan font-family="ecrm" font-size="0600">6</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan>
    </div>
<!--l. 149--><p class="indent" >    When there is no FROM clause, it returns a single row, with all of the expressions in the
select list. So this returns 4 columns.
<a 
 id="x1-31007r39"></a>
<h3 class="sectionHead"><span class="titlemark">2.5   </span> <a 
 id="x1-320005"></a>String Comparisons</h3>
<!--l. 152--><p class="noindent" >There are string comparisons in the WHERE clause.
      <ul class="itemize1">
      <li class="itemize">Old School SQL.
           <ul class="itemize2">
           <li class="itemize">You use the <tspan font-family="ecbx" font-size="1200">LIKE &#8217;B_%&#8217;</tspan>. underscore is a single character wild card so you can
           have anything after the B and % is the repeat pattern. So &#8217;B_%&#8217; Means we want
           a string that starts with B and any number of characters after</li></ul>
      </li>
      <li class="itemize">Standard Regular Expressions: preferred
           <ul class="itemize2">
           <li class="itemize">use <tspan font-family="ecbx" font-size="1200">&#x00A0; &#8217;B.*&#8217; </tspan>where "." represents a single character and "*" represents any number
           of those characters after.</li></ul>
      </li></ul>
<a 
 id="x1-32001r40"></a>
<h3 class="sectionHead"><span class="titlemark">2.6   </span> <a 
 id="x1-330006"></a>Combining Predicates</h3>
<!--l. 168--><p class="noindent" >Using boolean logic in WHERE clause to combine multiple predicates. There is alos using
traditional Set operations such as INTERSECT and UNION
<a 
 id="x1-33001r35"></a>
<h4 class="subsectionHead"><span class="titlemark">2.6.1   </span> <a 
 id="x1-340001"></a>Sid&#8217;s of sailors who reserved a red or green boat</h4>
    <!--l. 171-->
                                                                                         
                                                                                         
<div class="lstlisting" id="listing-21"><span class="label"><a 
 id="x1-34001r1"></a><tspan font-family="ecrm" font-size="0600">1</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">SELECT</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">R</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">sid</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-34002r2"></a><tspan font-family="ecrm" font-size="0600">2</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">FROM</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">Boats</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">B</tspan><tspan font-family="ecrm" font-size="1000">,</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">Reserves</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">R</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-34003r3"></a><tspan font-family="ecrm" font-size="0600">3</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">WHERE</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">R</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">bid</tspan><tspan font-family="ecrm" font-size="1000">=</tspan><tspan font-family="ecrm" font-size="1000">B</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">bid</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">AND</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-34004r4"></a><tspan font-family="ecrm" font-size="0600">4</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">(</tspan><tspan font-family="ecrm" font-size="1000">B</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">color</tspan><tspan font-family="ecrm" font-size="1000">=</tspan><tspan font-family="ecrm" font-size="1000">&#8217;</tspan><tspan font-family="ecrm" font-size="1000">red</tspan><tspan font-family="ecrm" font-size="1000">&#8217;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">OR</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">B</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">color</tspan><tspan font-family="ecrm" font-size="1000">=</tspan><tspan font-family="ecrm" font-size="1000">&#8217;</tspan><tspan font-family="ecrm" font-size="1000">green</tspan><tspan font-family="ecrm" font-size="1000">&#8217;</tspan><tspan font-family="ecrm" font-size="1000">)</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-34005r5"></a><tspan font-family="ecrm" font-size="0600">5</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan>
    </div>
<!--l. 177--><p class="indent" >    We restrict in where clause so that we are looking for particular boats identified by bid and
the color has to be red or the color has to be green. <br 
class="newline" />This is the same as if you said: <!--l. 180-->
<div class="lstlisting" id="listing-22"><span class="label"><a 
 id="x1-34006r1"></a><tspan font-family="ecrm" font-size="0600">1</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">SELECT</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">R</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">sid</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-34007r2"></a><tspan font-family="ecrm" font-size="0600">2</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">FROM</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">Boats</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">B</tspan><tspan font-family="ecrm" font-size="1000">,</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">Reserves</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">R</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-34008r3"></a><tspan font-family="ecrm" font-size="0600">3</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">WHERE</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">R</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">bid</tspan><tspan font-family="ecrm" font-size="1000">=</tspan><tspan font-family="ecrm" font-size="1000">B</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">bid</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">AND</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">B</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">color</tspan><tspan font-family="ecrm" font-size="1000">=</tspan><tspan font-family="ecrm" font-size="1000">&#8217;</tspan><tspan font-family="ecrm" font-size="1000">red</tspan><tspan font-family="ecrm" font-size="1000">&#8217;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-34009r4"></a><tspan font-family="ecrm" font-size="0600">4</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-34010r5"></a><tspan font-family="ecrm" font-size="0600">5</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">UNION</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">ALL</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-34011r6"></a><tspan font-family="ecrm" font-size="0600">6</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-34012r7"></a><tspan font-family="ecrm" font-size="0600">7</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">SELECT</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">R</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">sid</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-34013r8"></a><tspan font-family="ecrm" font-size="0600">8</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">FROM</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">Boats</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">B</tspan><tspan font-family="ecrm" font-size="1000">,</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">Reserves</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">R</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-34014r9"></a><tspan font-family="ecrm" font-size="0600">9</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">WHERE</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">R</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">bid</tspan><tspan font-family="ecrm" font-size="1000">=</tspan><tspan font-family="ecrm" font-size="1000">B</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">bid</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">AND</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">B</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">color</tspan><tspan font-family="ecrm" font-size="1000">=</tspan><tspan font-family="ecrm" font-size="1000">&#8217;</tspan><tspan font-family="ecrm" font-size="1000">green</tspan><tspan font-family="ecrm" font-size="1000">&#8217;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-34015r10"></a><tspan font-family="ecrm" font-size="0600">10</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan>
    </div>
<a 
 id="x1-34016r42"></a>
<h4 class="subsectionHead"><span class="titlemark">2.6.2   </span> <a 
 id="x1-350002"></a>SID&#8217;s of sailors who reserved a red and green boat </h4>
    <!--l. 192-->
<div class="lstlisting" id="listing-23"><span class="label"><a 
 id="x1-35001r1"></a><tspan font-family="ecrm" font-size="0600">1</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">SELECT</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">R</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">sid</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-35002r2"></a><tspan font-family="ecrm" font-size="0600">2</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">FROM</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">Boats</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">B</tspan><tspan font-family="ecrm" font-size="1000">,</tspan><tspan font-family="ecrm" font-size="1000">Reserves</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">R</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-35003r3"></a><tspan font-family="ecrm" font-size="0600">3</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">WHERE</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">R</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">bid</tspan><tspan font-family="ecrm" font-size="1000">=</tspan><tspan font-family="ecrm" font-size="1000">B</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">bid</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">AND</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-35004r4"></a><tspan font-family="ecrm" font-size="0600">4</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">(</tspan><tspan font-family="ecrm" font-size="1000">B</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">color</tspan><tspan font-family="ecrm" font-size="1000">=</tspan><tspan font-family="ecrm" font-size="1000">&#8217;</tspan><tspan font-family="ecrm" font-size="1000">red</tspan><tspan font-family="ecrm" font-size="1000">&#8217;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">AND</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">B</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">color</tspan><tspan font-family="ecrm" font-size="1000">=</tspan><tspan font-family="ecrm" font-size="1000">&#8217;</tspan><tspan font-family="ecrm" font-size="1000">green</tspan><tspan font-family="ecrm" font-size="1000">&#8217;</tspan><tspan font-family="ecrm" font-size="1000">)</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-35005r5"></a><tspan font-family="ecrm" font-size="0600">5</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan>
    </div>
<!--l. 198--><p class="indent" >    vs: <!--l. 199-->
<div class="lstlisting" id="listing-24"><span class="label"><a 
 id="x1-35006r1"></a><tspan font-family="ecrm" font-size="0600">1</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">SELECT</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">R</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">sid</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-35007r2"></a><tspan font-family="ecrm" font-size="0600">2</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">FROM</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">Boats</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">B</tspan><tspan font-family="ecrm" font-size="1000">,</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">Reserves</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">R</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-35008r3"></a><tspan font-family="ecrm" font-size="0600">3</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">WHERE</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">R</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">bid</tspan><tspan font-family="ecrm" font-size="1000">=</tspan><tspan font-family="ecrm" font-size="1000">B</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">bid</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">AND</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">B</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">color</tspan><tspan font-family="ecrm" font-size="1000">=</tspan><tspan font-family="ecrm" font-size="1000">&#8217;</tspan><tspan font-family="ecrm" font-size="1000">red</tspan><tspan font-family="ecrm" font-size="1000">&#8217;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-35009r4"></a><tspan font-family="ecrm" font-size="0600">4</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-35010r5"></a><tspan font-family="ecrm" font-size="0600">5</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">INTERSECT</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-35011r6"></a><tspan font-family="ecrm" font-size="0600">6</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-35012r7"></a><tspan font-family="ecrm" font-size="0600">7</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">SELECT</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">R</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">sid</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-35013r8"></a><tspan font-family="ecrm" font-size="0600">8</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">FROM</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">Boats</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">B</tspan><tspan font-family="ecrm" font-size="1000">,</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">Reserves</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">R</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-35014r9"></a><tspan font-family="ecrm" font-size="0600">9</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">WHERE</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">R</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">bid</tspan><tspan font-family="ecrm" font-size="1000">=</tspan><tspan font-family="ecrm" font-size="1000">B</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">bid</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">AND</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">B</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">color</tspan><tspan font-family="ecrm" font-size="1000">=</tspan><tspan font-family="ecrm" font-size="1000">&#8217;</tspan><tspan font-family="ecrm" font-size="1000">green</tspan><tspan font-family="ecrm" font-size="1000">&#8217;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-35015r10"></a><tspan font-family="ecrm" font-size="0600">10</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan>
    </div>
<!--l. 210--><p class="indent" >    In the second one, we are taking a list of the red boat reservations and intersect that set of sid
with the green boat reservation sids. It essentially will create the list for the first query where we
create the list of the sid that has reservation for red boats and then create the list of sid of people
who have green boat and then it will intersect the two lists, creating a list of the sid&#8217;s where
they appear in both lists, meaning they both reserved a red boat and reserved a green
boat.
<!--l. 216--><p class="indent" >    These are two different things. The first one says that We a list of the ones where the boat is
both red and green; this is not possible because you can&#8217;t have a tuple with two values in the same
field. Second representation means that we want a list where the sailor id appears in
the reservations for the green boats and the sailor id appears in the list for the red
boats.
<!--l. 221--><p class="indent" >    It&#8217;s not always easy to convert from boolean to a set
<a 
 id="x1-35016r41"></a>
<h3 class="sectionHead"><span class="titlemark">2.7   </span> <a 
 id="x1-360007"></a>Set Semantics</h3>
      <ul class="itemize1">
      <li class="itemize">Set: a collection of distinct elements
      </li>
      <li class="itemize">Standard ways of manipulating/combining sets
           <ul class="itemize2">
           <li class="itemize">union
           </li>
           <li class="itemize">intersect
                                                                                         
                                                                                         
           </li>
           <li class="itemize">except</li></ul>
      </li>
      <li class="itemize">Because we are in SQL context, the elements are tuples within a relation. A relation
      is a set and each tuple of that relation is the element of that set. Because we
      are in set semantics, we say there are no duplicates. <tspan font-family="ecbx" font-size="1200">Set semantics ignores</tspan>
      <tspan font-family="ecbx" font-size="1200">duplicates</tspan></li></ul>
<!--l. 236-->
<div class="lstlisting" id="listing-25"><span class="label"><a 
 id="x1-36001r1"></a><tspan font-family="ecrm" font-size="0600">1</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">R</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">=</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">{</tspan><tspan font-family="ecrm" font-size="1000">A</tspan><tspan font-family="ecrm" font-size="1000">,</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">A</tspan><tspan font-family="ecrm" font-size="1000">,</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">A</tspan><tspan font-family="ecrm" font-size="1000">,</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">A</tspan><tspan font-family="ecrm" font-size="1000">,</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">B</tspan><tspan font-family="ecrm" font-size="1000">,</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">B</tspan><tspan font-family="ecrm" font-size="1000">,</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">C</tspan><tspan font-family="ecrm" font-size="1000">,</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">D</tspan><tspan font-family="ecrm" font-size="1000">}</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-36002r2"></a><tspan font-family="ecrm" font-size="0600">2</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">S</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">=</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">{</tspan><tspan font-family="ecrm" font-size="1000">A</tspan><tspan font-family="ecrm" font-size="1000">,</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">A</tspan><tspan font-family="ecrm" font-size="1000">,</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">B</tspan><tspan font-family="ecrm" font-size="1000">,</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">B</tspan><tspan font-family="ecrm" font-size="1000">,</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">B</tspan><tspan font-family="ecrm" font-size="1000">,</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">C</tspan><tspan font-family="ecrm" font-size="1000">,</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">E</tspan><tspan font-family="ecrm" font-size="1000">}</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-36003r3"></a><tspan font-family="ecrm" font-size="0600">3</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan>
    </div>
<!--l. 240--><p class="indent" >    Think fo each letter as a <tspan font-family="ecbx" font-size="1200">tuple </tspan>in a <tspan font-family="ecbx" font-size="1200">relation </tspan><br 
class="newline" />ex: <br 
class="newline" /><tspan font-family="ecbx" font-size="1200">A</tspan>:(Jim, 18, English,4.0) <br 
class="newline" /><tspan font-family="ecbx" font-size="1200">B</tspan>:(Marcela, 20,CS, 3.8) <br 
class="newline" /><tspan font-family="ecbx" font-size="1200">C</tspan>:(Gail,19,Statistics, 3.74) <br 
class="newline" /><tspan font-family="ecbx" font-size="1200">D</tspan>:(Goddard,20,Math,3.8)
      <ul class="itemize1">
      <li class="itemize">UNION: creates: {A,B,C,D,E} <br 
class="newline" />It only gets one of each because there are no duplicates
      </li>
      <li class="itemize">INTERSECT creates: {A,B,C}
      </li>
      <li class="itemize">EXCEPT creates: {D}</li></ul>
<a 
 id="x1-36004r44"></a>
<h3 class="sectionHead"><span class="titlemark">2.8   </span> <a 
 id="x1-370008"></a>"ALL": Multiset Semantics</h3>
<!--l. 253--><p class="noindent" >ALL is our queue that we are working with mulitset semantics. <div class="newtheorem">
<!--l. 254--><p class="noindent" ><span class="head">
<tspan font-family="ecbx" font-size="1200">Definition</tspan><tspan font-family="ecbx" font-size="1200">&#x00A0;2.1</tspan> </span><tspan font-family="ecti" font-size="1200">Cardinality: the number of copies of each tuple</tspan>
    </div>
<!--l. 257--><p class="noindent" >We keep track of how many number of each tuples. Using these two sets:
                                                                                         
                                                                                         
<table 
class="align-star">
                 <tr><td 
class="align-odd"><tspan font-family="cmmi" font-size="12">R </tspan><tspan font-family="cmr" font-size="12">= </tspan><tspan font-family="cmsy" font-size="10">{</tspan><tspan font-family="cmmi" font-size="12">A,A,A,A,B,B,C,D</tspan><tspan font-family="cmsy" font-size="10">} </tspan><tspan font-family="cmr" font-size="12">= </tspan><tspan font-family="cmsy" font-size="10">{</tspan><tspan font-family="cmmi" font-size="12">A</tspan><tspan font-family="cmr" font-size="12">(4)</tspan><tspan font-family="cmmi" font-size="12">,B</tspan><tspan font-family="cmr" font-size="12">(2)</tspan><tspan font-family="cmmi" font-size="12">,C</tspan><tspan font-family="cmr" font-size="12">(1)</tspan><tspan font-family="cmmi" font-size="12">,D</tspan><tspan font-family="cmr" font-size="12">(1)</tspan><tspan font-family="cmsy" font-size="10">}</tspan></td>                 <td 
class="align-even"></td>                 <td 
class="align-label">
                 </td></tr><tr><td 
class="align-odd"><tspan font-family="cmmi" font-size="12">S </tspan><tspan font-family="cmr" font-size="12">= </tspan><tspan font-family="cmsy" font-size="10">{</tspan><tspan font-family="cmmi" font-size="12">A,A,B,B,B,C,E</tspan><tspan font-family="cmsy" font-size="10">} </tspan><tspan font-family="cmr" font-size="12">= </tspan><tspan font-family="cmsy" font-size="10">{</tspan><tspan font-family="cmmi" font-size="12">A</tspan><tspan font-family="cmr" font-size="12">(2)</tspan><tspan font-family="cmmi" font-size="12">,B</tspan><tspan font-family="cmr" font-size="12">(3)</tspan><tspan font-family="cmmi" font-size="12">,C</tspan><tspan font-family="cmr" font-size="12">(1)</tspan><tspan font-family="cmmi" font-size="12">,E</tspan><tspan font-family="cmr" font-size="12">(1)</tspan><tspan font-family="cmsy" font-size="10">}</tspan></td>                    <td 
class="align-even"></td>                 <td 
class="align-label"></td></tr></table>
      <ul class="itemize1">
      <li class="itemize">UNION ALL: sum of the cardinalities. {A(4+2), B(2+3), C(1+1), D(1+0), E(0+1)}
      = {A, A, A, A, A, A, B, B, B, B, B, C, C, D, E}. We are summing up the cardinalities
      per tuple of the two inputs.
      </li>
      <li class="itemize">INTERSECT ALL: min of cardinalities: <table 
class="multline-star"><tr><td><img 
src="CS186Main7x.png" alt="{A (min (4,2)),B (min (2,3)),C(min (1,1)),

                                         D(min (1,0 )),E (min (0,1))} = {A, A,B, B, C }
      " ></td></tr></table>
      </li>
      <li class="itemize">EXCEPT ALL: difference of cardinalities
      <table 
class="align-star">
                       <tr><td 
class="align-odd"><tspan font-family="cmsy" font-size="10">{</tspan><tspan font-family="cmmi" font-size="12">A</tspan><tspan font-family="cmr" font-size="12">(4 </tspan><tspan font-family="cmsy" font-size="10">- </tspan><tspan font-family="cmr" font-size="12">2)</tspan><tspan font-family="cmmi" font-size="12">,B</tspan><tspan font-family="cmr" font-size="12">(2 </tspan><tspan font-family="cmsy" font-size="10">- </tspan><tspan font-family="cmr" font-size="12">3)</tspan><tspan font-family="cmmi" font-size="12">,C</tspan><tspan font-family="cmr" font-size="12">(1 </tspan><tspan font-family="cmsy" font-size="10">- </tspan><tspan font-family="cmr" font-size="12">1)</tspan><tspan font-family="cmmi" font-size="12">,D</tspan><tspan font-family="cmr" font-size="12">(1 </tspan><tspan font-family="cmsy" font-size="10">- </tspan><tspan font-family="cmr" font-size="12">0)</tspan><tspan font-family="cmmi" font-size="12">,E</tspan><tspan font-family="cmr" font-size="12">(0 </tspan><tspan font-family="cmsy" font-size="10">- </tspan><tspan font-family="cmr" font-size="12">1)</tspan><tspan font-family="cmsy" font-size="10">}</tspan></td>          <td 
class="align-even"></td>          <td 
class="align-label">
          </td></tr><tr><td 
class="align-odd"> <tspan font-family="cmr" font-size="12">= </tspan><tspan font-family="cmsy" font-size="10">{</tspan><tspan font-family="cmmi" font-size="12">A,A,D</tspan><tspan font-family="cmsy" font-size="10">}</tspan></td>                               <td 
class="align-even"></td>          <td 
class="align-label"></td></tr></table>
                                                                                         
                                                                                         
      </li></ul>
<a 
 id="x1-37002r45"></a>
<h3 class="sectionHead"><span class="titlemark">2.9   </span> <a 
 id="x1-380009"></a>Nested Queries: IN</h3>
<!--l. 281--><p class="noindent" >We looked at multiple query blocks. And we combined with multiset operators.
<!--l. 282--><p class="indent" >    We can also use multiple query blocks using nested queries. <!--l. 283-->
<div class="lstlisting" id="listing-26"><span class="label"><a 
 id="x1-38001r1"></a><tspan font-family="ecrm" font-size="0600">1</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">SELECT</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">S</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">sname</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-38002r2"></a><tspan font-family="ecrm" font-size="0600">2</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">FROM</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">Sailors</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">S</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-38003r3"></a><tspan font-family="ecrm" font-size="0600">3</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">WHERE</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">S</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">sid</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">IN</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-38004r4"></a><tspan font-family="ecrm" font-size="0600">4</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">(</tspan><tspan font-family="ecrm" font-size="1000">SELECT</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">R</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">sid</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-38005r5"></a><tspan font-family="ecrm" font-size="0600">5</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">FROM</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">Reserves</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">R</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-38006r6"></a><tspan font-family="ecrm" font-size="0600">6</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">WHERE</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">R</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">bid</tspan><tspan font-family="ecrm" font-size="1000">=102)</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-38007r7"></a><tspan font-family="ecrm" font-size="0600">7</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan>
    </div>
<!--l. 291--><p class="indent" >    In the outer query, we say from the sailors table, I would like to find tuples where the sid in
the tuple is IN a set. That set is defined in the subquery. that subquery looks inside the
subquery and finds reservations for boat 102 and then returns reservations for boat
102.
<!--l. 295--><p class="indent" >    In short, we are asking to get a table with the names of the sailors who&#8217;s sid is in the set of
sailors who have reserved boat 102.
<a 
 id="x1-38008r46"></a>
<h3 class="sectionHead"><span class="titlemark">2.10   </span> <a 
 id="x1-3900010"></a>Nested Queries: NOT IN</h3>
<!--l. 298--><p class="noindent" >Names of sailors who&#8217;ve <tspan font-family="ecbx" font-size="1200">not </tspan>reserved boat 103: <!--l. 299-->
<div class="lstlisting" id="listing-27"><span class="label"><a 
 id="x1-39001r1"></a><tspan font-family="ecrm" font-size="0600">1</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">SELECT</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">S</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">sname</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-39002r2"></a><tspan font-family="ecrm" font-size="0600">2</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">FROM</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">Sailors</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">S</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-39003r3"></a><tspan font-family="ecrm" font-size="0600">3</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">WHERE</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">S</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">sid</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">NOT</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">IN</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-39004r4"></a><tspan font-family="ecrm" font-size="0600">4</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">(</tspan><tspan font-family="ecrm" font-size="1000">SELECT</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">R</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">sid</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-39005r5"></a><tspan font-family="ecrm" font-size="0600">5</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">FROM</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">Reserves</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">R</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-39006r6"></a><tspan font-family="ecrm" font-size="0600">6</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">WHERE</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">R</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">bid</tspan><tspan font-family="ecrm" font-size="1000">=103)</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-39007r7"></a><tspan font-family="ecrm" font-size="0600">7</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan>
    </div>
<a 
 id="x1-39008r47"></a>
<h3 class="sectionHead"><span class="titlemark">2.11   </span> <a 
 id="x1-4000011"></a>Nested Queries: EXISTS</h3>
    <!--l. 308-->
<div class="lstlisting" id="listing-28"><span class="label"><a 
 id="x1-40001r1"></a><tspan font-family="ecrm" font-size="0600">1</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">SELECT</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">S</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">sname</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-40002r2"></a><tspan font-family="ecrm" font-size="0600">2</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">FROM</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">Sailors</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">S</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-40003r3"></a><tspan font-family="ecrm" font-size="0600">3</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">WHERE</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">EXISTS</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-40004r4"></a><tspan font-family="ecrm" font-size="0600">4</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">(</tspan><tspan font-family="ecrm" font-size="1000">SELECT</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">R</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">sid</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-40005r5"></a><tspan font-family="ecrm" font-size="0600">5</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">FROM</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">Reserves</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">R</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-40006r6"></a><tspan font-family="ecrm" font-size="0600">6</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">WHERE</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">R</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">bid</tspan><tspan font-family="ecrm" font-size="1000">=103)</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-40007r7"></a><tspan font-family="ecrm" font-size="0600">7</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan>
    </div>
<!--l. 316--><p class="indent" >    This one is legal but it is a little weird: We find the reservations for boat 103, for every tuple
in sailors, if there is anything in the subquery, it will return the Sailors table. So this particular one
will either return all of Sailors if there is a reservation for boat 103 or it wont return any tuples if
there is no reservation for boat 103
<!--l. 320--><p class="indent" >    If subquery is empty, then it will <tspan font-family="ecbx" font-size="1200">not </tspan>go to output, if it is not empty, then it <tspan font-family="ecbx" font-size="1200">will</tspan>.
<a 
 id="x1-40008r48"></a>
<h3 class="sectionHead"><span class="titlemark">2.12   </span> <a 
 id="x1-4100012"></a>Nested Queries with Correlation</h3>
    <!--l. 323-->
<div class="lstlisting" id="listing-29"><span class="label"><a 
 id="x1-41001r1"></a><tspan font-family="ecrm" font-size="0600">1</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">SELECT</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">S</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">sname</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-41002r2"></a><tspan font-family="ecrm" font-size="0600">2</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">FROM</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">Sailors</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">S</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-41003r3"></a><tspan font-family="ecrm" font-size="0600">3</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">WHERE</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">EXISTS</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-41004r4"></a><tspan font-family="ecrm" font-size="0600">4</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">(</tspan><tspan font-family="ecrm" font-size="1000">SELECT</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="cmsy" font-size="10">*</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-41005r5"></a><tspan font-family="ecrm" font-size="0600">5</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">FROM</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">Reserves</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">R</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-41006r6"></a><tspan font-family="ecrm" font-size="0600">6</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">WHERE</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">R</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">bid</tspan><tspan font-family="ecrm" font-size="1000">=102</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">AND</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">S</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">sid</tspan><tspan font-family="ecrm" font-size="1000">=</tspan><tspan font-family="ecrm" font-size="1000">R</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">sid</tspan><tspan font-family="ecrm" font-size="1000">)</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-41007r7"></a><tspan font-family="ecrm" font-size="0600">7</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan>
    </div>
    <div class="newtheorem">
                                                                                         
                                                                                         
<!--l. 331--><p class="noindent" ><span class="head">
<tspan font-family="ecbx" font-size="1200">Definition</tspan><tspan font-family="ecbx" font-size="1200">&#x00A0;2.2</tspan> </span><tspan font-family="ecti" font-size="1200">Reference  to  S  in  outer  query  is  called  </tspan><tspan font-family="ecbi" font-size="1200">correlation</tspan><tspan font-family="ecti" font-size="1200">.  This  is  called  a</tspan>
<tspan font-family="ecbi" font-size="1200">correlated subquery</tspan>
    </div>
<!--l. 335--><p class="indent" >    It&#8217;s like there is a function call that which is being passed the current tuple of sailors, one
tuple at a time. So the subquery is recomputed for each tuple.
<!--l. 337--><p class="indent" >    If for a specific sailor&#8217;s tuple, the subquery EXISTS an is not empty, then that tuple will go
into the output table. If the subquery for the sailor&#8217;s tuple does not EXIST, then the tuple will not
go to the output table.
<!--l. 340--><p class="indent" >    In this example, S is the correlation variable that connects the inside and outside
query.
<a 
 id="x1-41009r49"></a>
<h3 class="sectionHead"><span class="titlemark">2.13   </span> <a 
 id="x1-4200013"></a>A tough one: "division"</h3>
<!--l. 343--><p class="noindent" >Relational Division: "Find sailors who&#8217;ve researched all boats."
<!--l. 344--><p class="indent" >    Said differently: "sailors with no counterexample missing boats"
<!--l. 345--><p class="indent" >    We want to make sure there is no counterexample boat reservation. We want to find the fact
that they did not reserve some particular boat.
<a 
 id="x1-42001r50"></a>
<h3 class="sectionHead"><span class="titlemark">2.14   </span> <a 
 id="x1-4300014"></a>ARGMAX?</h3>
<!--l. 348--><p class="noindent" >Queries that try to find the largest thing in a set of things.
<!--l. 349--><p class="indent" >    We want to find the sailor with the highest rating. Argmax is usually used for optimization
problems. <!--l. 351-->
<div class="lstlisting" id="listing-30"><span class="label"><a 
 id="x1-43001r1"></a><tspan font-family="ecrm" font-size="0600">1</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">SELECT</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">MAX</tspan><tspan font-family="ecrm" font-size="1000">(</tspan><tspan font-family="ecrm" font-size="1000">S</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">rating</tspan><tspan font-family="ecrm" font-size="1000">)</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-43002r2"></a><tspan font-family="ecrm" font-size="0600">2</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">FROM</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">Sailors</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">S</tspan><tspan font-family="ecrm" font-size="1000">;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-43003r3"></a><tspan font-family="ecrm" font-size="0600">3</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan>
    </div>
<!--l. 355--><p class="indent" >    This is not right since all it does is get the MAX of sailors and doesn&#8217;t tell you anything about
what the <!--l. 357-->
<div class="lstlisting" id="listing-31"><span class="label"><a 
 id="x1-43004r1"></a><tspan font-family="ecrm" font-size="0600">1</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">SELECT</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">S</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="cmsy" font-size="10">*</tspan><tspan font-family="ecrm" font-size="1000">,</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">MAX</tspan><tspan font-family="ecrm" font-size="1000">(</tspan><tspan font-family="ecrm" font-size="1000">S</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">rating</tspan><tspan font-family="ecrm" font-size="1000">)</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-43005r2"></a><tspan font-family="ecrm" font-size="0600">2</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">FROM</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">Sailors</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">S</tspan><tspan font-family="ecrm" font-size="1000">;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-43006r3"></a><tspan font-family="ecrm" font-size="0600">3</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan>
    </div>
<!--l. 361--><p class="indent" >    This is illegal because there is an aggregate for the S.rating but then there is none for the S.*
so then there would be no way to know which sailor name to output since there would only be one
tuple that would be outputted. <br 
class="newline" />New attempt: <!--l. 365-->
<div class="lstlisting" id="listing-32"><span class="label"><a 
 id="x1-43007r1"></a><tspan font-family="ecrm" font-size="0600">1</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">SELECT</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="cmsy" font-size="10">*</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-43008r2"></a><tspan font-family="ecrm" font-size="0600">2</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">FROM</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">Sailors</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">S</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-43009r3"></a><tspan font-family="ecrm" font-size="0600">3</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">WHERE</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">S</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">rating</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x003E;=</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">ALL</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-43010r4"></a><tspan font-family="ecrm" font-size="0600">4</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">(</tspan><tspan font-family="ecrm" font-size="1000">Select</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">S2</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">rating</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-43011r5"></a><tspan font-family="ecrm" font-size="0600">5</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">FROM</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">Sailors</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">S2</tspan><tspan font-family="ecrm" font-size="1000">)</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-43012r6"></a><tspan font-family="ecrm" font-size="0600">6</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan>
    </div>
<!--l. 372--><p class="indent" >    this one is indeed correct. It says: "We are going to take all the columns for each tuple where
that tuple&#8217;s rating is greater than ALL of the subquery that finds the ratings of the sailors.This is
correct. It actually does give the tuple that is the biggest. <!--l. 375-->
                                                                                         
                                                                                         
<a 
 id="x1-43013r1"></a>
<a 
 id="x1-43014"></a>
<div class="lstlisting" id="listing-33"><span class="label"><a 
 id="x1-43015r1"></a><tspan font-family="ecrm" font-size="0600">1</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">SELECT</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="cmsy" font-size="10">*</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-43016r2"></a><tspan font-family="ecrm" font-size="0600">2</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">FROM</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">Sailors</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">S</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-43017r3"></a><tspan font-family="ecrm" font-size="0600">3</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">WHERE</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">S</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">rating</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">=</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-43018r4"></a><tspan font-family="ecrm" font-size="0600">4</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">(</tspan><tspan font-family="ecrm" font-size="1000">SELECT</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">MAX</tspan><tspan font-family="ecrm" font-size="1000">(</tspan><tspan font-family="ecrm" font-size="1000">S2</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">rating</tspan><tspan font-family="ecrm" font-size="1000">)</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-43019r5"></a><tspan font-family="ecrm" font-size="0600">5</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">FROM</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">Sailors</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">S2</tspan><tspan font-family="ecrm" font-size="1000">)</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-43020r6"></a><tspan font-family="ecrm" font-size="0600">6</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan>
<br />
    <div class="caption" 
><span class="id">Listing&#x00A0;2.1:
    </span><span  
class="content">Figure
    1</span></div><!--tex4ht:label?: x1-43013r2 -->
    </div>
<!--l. 382--><p class="indent" >    This returns the tuple where the rating of that tuple is equal to the max rating of the sailors.
This is also correct as it returns the tuple of the highest rating. <!--l. 384-->
<div class="lstlisting" id="listing-34"><span class="label"><a 
 id="x1-43021r1"></a><tspan font-family="ecrm" font-size="0600">1</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">SELECT</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="cmsy" font-size="10">*</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-43022r2"></a><tspan font-family="ecrm" font-size="0600">2</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">FROM</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">Sailors</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">S</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-43023r3"></a><tspan font-family="ecrm" font-size="0600">3</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">ORDER</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">BY</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">rating</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">DESC</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-43024r4"></a><tspan font-family="ecrm" font-size="0600">4</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">LIMIT</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">1;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-43025r5"></a><tspan font-family="ecrm" font-size="0600">5</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan>
    </div>
<!--l. 390--><p class="indent" >    This is also correct. It will order the query from greatest to least based off of the rating and
then only return the first row.
<!--l. 392--><p class="indent" >    This is however not the same as from lst <a 
href="#x1-43013r1">2.1<!--tex4ht:ref: fig1 --></a>. Where in lst <a 
href="#x1-43013r1">2.1<!--tex4ht:ref: fig1 --></a>, there is the possibility that
there are ties in the highest rating and in that case there will be more than one value in
the table but from the last one where the limit is set to 1, there will only be 1 and
we have no guarantee as to which one it will be if there are multiple with the highest
rating.
<a 
 id="x1-43026r51"></a>
<h3 class="sectionHead"><span class="titlemark">2.15   </span> <a 
 id="x1-4400015"></a>"Inner Joins: Another Syntax</h3>
    <!--l. 398-->
<div class="lstlisting" id="listing-35"><span class="label"><a 
 id="x1-44001r1"></a><tspan font-family="ecrm" font-size="0600">1</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">SELECT</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">s</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="cmsy" font-size="10">*</tspan><tspan font-family="ecrm" font-size="1000">,</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">r</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">bid</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-44002r2"></a><tspan font-family="ecrm" font-size="0600">2</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">FROM</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">Sailors</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">s</tspan><tspan font-family="ecrm" font-size="1000">,</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">Reserves</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">r</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-44003r3"></a><tspan font-family="ecrm" font-size="0600">3</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">WHERE</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">s</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">sid</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">=</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">r</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">sid</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-44004r4"></a><tspan font-family="ecrm" font-size="0600">4</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">AND</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">...</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-44005r5"></a><tspan font-family="ecrm" font-size="0600">5</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-44006r6"></a><tspan font-family="ecrm" font-size="0600">6</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">SELECT</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">s</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="cmsy" font-size="10">*</tspan><tspan font-family="ecrm" font-size="1000">,</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">r</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">bid</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-44007r7"></a><tspan font-family="ecrm" font-size="0600">7</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">FROM</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">Sailors</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">s</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">INNER</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">JOIN</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">Reserves</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">r</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-44008r8"></a><tspan font-family="ecrm" font-size="0600">8</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">ON</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">s</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">sid</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">=</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">r</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">sid</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-44009r9"></a><tspan font-family="ecrm" font-size="0600">9</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">WHERE</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">...</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-44010r10"></a><tspan font-family="ecrm" font-size="0600">10</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan>
    </div>
<!--l. 409--><p class="indent" >    The two do the same thing but have different representations. Where the first one will
combine the Sailors and Reserves table together where the s.sid = r.sid, and then output the
columsn of S and the bid from the reserves table.
<!--l. 412--><p class="indent" >    The second does the same thing with different representation. The stuff you were going to put
in the AND from the first one you will now put into the WHERE. The INNER JOIN is a different
way of writing a join with a particular WHERE predicate. The where predicate in this moves to
the ON clause. The <tspan font-family="ecbx" font-size="1200">INNER JOIN is an infix notation </tspan>in which it is between the two names of
the tables that you want to join.
<a 
 id="x1-44011r53"></a>
<h3 class="sectionHead"><span class="titlemark">2.16   </span> <a 
 id="x1-4500016"></a>Join Variants</h3>
<!--l. 418--><p class="noindent" >There are <tspan font-family="ectt" font-size="1200">INNER, NATURAL, or (LEFT, RIGHT, or OUTER) JOIN</tspan>. If you just say JOIN, then the
default is INNER.
<a 
 id="x1-45001r43"></a>
<h4 class="subsectionHead"><span class="titlemark">2.16.1   </span> <a 
 id="x1-460001"></a>INNER/NATURAL Joins</h4>
    <!--l. 421-->
                                                                                         
                                                                                         
<div class="lstlisting" id="listing-36"><span class="label"><a 
 id="x1-46001r1"></a><tspan font-family="ecrm" font-size="0600">1</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">SELECT</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">s</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">sid</tspan><tspan font-family="ecrm" font-size="1000">,</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">s</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">sname</tspan><tspan font-family="ecrm" font-size="1000">,</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">r</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">bid</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-46002r2"></a><tspan font-family="ecrm" font-size="0600">2</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">FROM</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">Sailors</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">s</tspan><tspan font-family="ecrm" font-size="1000">,</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">Reserves</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">r</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-46003r3"></a><tspan font-family="ecrm" font-size="0600">3</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">WHERE</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">s</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">sid</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">=</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">r</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">sid</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-46004r4"></a><tspan font-family="ecrm" font-size="0600">4</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">AND</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">s</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">age</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x003E;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">20;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-46005r5"></a><tspan font-family="ecrm" font-size="0600">5</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-46006r6"></a><tspan font-family="ecrm" font-size="0600">6</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">SELECT</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">s</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">sid</tspan><tspan font-family="ecrm" font-size="1000">,</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">s</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">sname</tspan><tspan font-family="ecrm" font-size="1000">,</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">r</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">bid</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-46007r7"></a><tspan font-family="ecrm" font-size="0600">7</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">FROM</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">Sailors</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">s</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">INNER</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">JOIN</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">Reserves</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">r</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-46008r8"></a><tspan font-family="ecrm" font-size="0600">8</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">ON</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">s</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">sid</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">=</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">r</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">sid</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-46009r9"></a><tspan font-family="ecrm" font-size="0600">9</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">WHERE</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">s</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">age</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x003E;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">20;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-46010r10"></a><tspan font-family="ecrm" font-size="0600">10</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-46011r11"></a><tspan font-family="ecrm" font-size="0600">11</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">SELECT</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">s</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">sid</tspan><tspan font-family="ecrm" font-size="1000">,</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">s</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">sname</tspan><tspan font-family="ecrm" font-size="1000">,</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">r</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">bid</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-46012r12"></a><tspan font-family="ecrm" font-size="0600">12</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">FROM</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">Sailors</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">s</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">NATURAL</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">JOIN</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">Reserves</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">r</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-46013r13"></a><tspan font-family="ecrm" font-size="0600">13</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">WHERE</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">s</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">age</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x003E;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">20;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-46014r14"></a><tspan font-family="ecrm" font-size="0600">14</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan>
    </div>
<!--l. 436--><p class="indent" >    they have the same semantics as the regular joins.
<!--l. 437--><p class="indent" >    "NATURAL" means equi-join for pairs of attributes with the same name.
<!--l. 438--><p class="indent" >    In general NATURAL join is not a good thing to use. It can cause random breaks if you don&#8217;t
be careful.
<a 
 id="x1-46015r55"></a>
<h4 class="subsectionHead"><span class="titlemark">2.16.2   </span> <a 
 id="x1-470002"></a>Left Outer Join</h4>
    <!--l. 441-->
<div class="lstlisting" id="listing-37"><span class="label"><a 
 id="x1-47001r1"></a><tspan font-family="ecrm" font-size="0600">1</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">SELECT</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">s</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">sid</tspan><tspan font-family="ecrm" font-size="1000">,</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">s</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">sname</tspan><tspan font-family="ecrm" font-size="1000">,</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">r</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">bid</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-47002r2"></a><tspan font-family="ecrm" font-size="0600">2</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">FROM</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">Sailors2</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">s</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">LEFT</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">OUTER</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">JOIN</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">Reserves2</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">r</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-47003r3"></a><tspan font-family="ecrm" font-size="0600">3</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">ON</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">s</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">sid</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">=</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">r</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">sid</tspan><tspan font-family="ecrm" font-size="1000">;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-47004r4"></a><tspan font-family="ecrm" font-size="0600">4</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan>
    </div>
<!--l. 446--><p class="indent" >    Idea is returns all matched rows and <span class="underline">preserves all unmatched rows from the table on the left </span>
of the join clause. So if there is a tuple on the left table that has no match on the right table, then
we still want it to be in the output once. We will fill in the right-hand side column of the tuple
with null.
<!--l. 450--><p class="indent" >    We are going to return the sailors and bid for any boat in any of the reservations. In addition,
if there is sailor in sailors table that has no reservation that matches, then that person will still be
in output once with the bid as null.
<a 
 id="x1-47005r56"></a>
<h4 class="subsectionHead"><span class="titlemark">2.16.3   </span> <a 
 id="x1-480003"></a>Right Outer Join</h4>
    <!--l. 455-->
<div class="lstlisting" id="listing-38"><span class="label"><a 
 id="x1-48001r1"></a><tspan font-family="ecrm" font-size="0600">1</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">SELECT</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">r</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">sid</tspan><tspan font-family="ecrm" font-size="1000">,</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">b</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">bid</tspan><tspan font-family="ecrm" font-size="1000">,</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">b</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">bname</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-48002r2"></a><tspan font-family="ecrm" font-size="0600">2</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">FROM</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">Reserves2</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">r</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">RIGHT</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">OUTER</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">JOIN</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">Boats2</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">b</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-48003r3"></a><tspan font-family="ecrm" font-size="0600">3</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">ON</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">r</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">bid</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">=</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">b</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">bid</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-48004r4"></a><tspan font-family="ecrm" font-size="0600">4</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan>
    </div>
<!--l. 460--><p class="indent" >    Same idea except we will preserve tuples that don&#8217;t match on the right side. So we have
reserves right outer join boats on on the bid. This will return all boats and sid for any sailor
associated with the reservation for that boat. If there is a boat that has no reservations in the
reserves table then we will have r.sid as null but that boat will show up once with bid and bname
filled in and r.sid as null.
<!--l. 465--><p class="indent" >    Returns all matched rows and <span class="underline">preserves all unmatched rows from the table on the
right</span>
<a 
 id="x1-48005r57"></a>
<h4 class="subsectionHead"><span class="titlemark">2.16.4   </span> <a 
 id="x1-490004"></a>Full Outer Join</h4>
    <!--l. 467-->
<div class="lstlisting" id="listing-39"><span class="label"><a 
 id="x1-49001r1"></a><tspan font-family="ecrm" font-size="0600">1</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">SELECT</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">r</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">sid</tspan><tspan font-family="ecrm" font-size="1000">,</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">b</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">bid</tspan><tspan font-family="ecrm" font-size="1000">,</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">b</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">bname</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-49002r2"></a><tspan font-family="ecrm" font-size="0600">2</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">FROM</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">Reserves2</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">r</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">FULL</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">OUTER</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">JOIN</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">Boats2</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">b</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-49003r3"></a><tspan font-family="ecrm" font-size="0600">3</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">ON</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">r</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">bid</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">=</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">b</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">bid</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-49004r4"></a><tspan font-family="ecrm" font-size="0600">4</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan>
    </div>
<!--l. 472--><p class="indent" >    <span class="underline">Returns all (matched or unmatched) rows from the tables on both sides</span> of the join clause. It
returns any unmatched rows from either side with the null filled in appropriately.
                                                                                         
                                                                                         
      <ul class="itemize1">
      <li class="itemize">returns all boats &amp; all information on reservations
      </li>
      <li class="itemize">No match for r.bid
           <ul class="itemize2">
           <li class="itemize">b.id IS NULL AND b.bname is NULL</li></ul>
      </li>
      <li class="itemize">No match for b.bid?
           <ul class="itemize2">
           <li class="itemize">r.sid IS NULL</li></ul>
      </li></ul>
<a 
 id="x1-49005r54"></a>
<h3 class="sectionHead"><span class="titlemark">2.17   </span> <a 
 id="x1-5000017"></a>Views: Named Queries</h3>
<!--l. 487--><p class="noindent" >Veiws are queries that we give a name to.
      <ul class="itemize1">
      <li class="itemize">Makes developmetn simpler
      </li>
      <li class="itemize">Often used for security. Access control.
      </li>
      <li class="itemize">They  are  evaluated  on  the  fly  everytime  you  reference  them.  They  are  not
      "materialized". They are not stored results that you snapshot. The creating of the view
      specifies the syntax for evaluating the view when you use it in a query.</li></ul>
<!--l. 495-->
<div class="lstlisting" id="listing-40"><span class="label"><a 
 id="x1-50001r1"></a><tspan font-family="ecrm" font-size="0600">1</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">CREATE</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">VIEW</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">view_name</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-50002r2"></a><tspan font-family="ecrm" font-size="0600">2</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">AS</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">select_statement</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-50003r3"></a><tspan font-family="ecrm" font-size="0600">3</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan>
    </div>
<!--l. 499--><p class="indent" >    You can use views in queries just like you would use tables in queries.
<a 
 id="x1-50004r59"></a>
<h3 class="sectionHead"><span class="titlemark">2.18   </span> <a 
 id="x1-5100018"></a>Sub queries in FROM</h3>
<!--l. 501--><p class="noindent" >Sometimes you don&#8217;t want at define view because you don&#8217;t want at forget at drop it later on if
you want to only use it once. You can then just define a sub query in the FROM query when you
are defining the outer query.
<a 
 id="x1-51001r60"></a>
<h3 class="sectionHead"><span class="titlemark">2.19   </span> <a 
 id="x1-5200019"></a>WITH a.k.a common table expression CTE</h3>
<!--l. 505--><p class="noindent" >There is another way to achieve the same thing by defining the subquery ahead of the regular
query but in the same statement using a WITH clause. That way we define a table that can be
used again in the subsequent part of the query.
<a 
 id="x1-52001r58"></a>
                                                                                         
                                                                                         
<h4 class="subsectionHead"><span class="titlemark">2.19.1   </span> <a 
 id="x1-530001"></a>Can have many queries in WITH</h4>
<!--l. 509--><p class="noindent" >With clause can be defined in sequence and can be then referred back to each other so they can be
used later on.
<a 
 id="x1-53001r61"></a>
<h3 class="sectionHead"><span class="titlemark">2.20   </span> <a 
 id="x1-5400020"></a>ARGMAX GROUP BY</h3>
<!--l. 512--><p class="noindent" >Now if we want the sailor with the highest rating per age. <!--l. 513-->
<div class="lstlisting" id="listing-41"><span class="label"><a 
 id="x1-54001r1"></a><tspan font-family="ecrm" font-size="0600">1</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">WITH</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">maxratings</tspan><tspan font-family="ecrm" font-size="1000">(</tspan><tspan font-family="ecrm" font-size="1000">age</tspan><tspan font-family="ecrm" font-size="1000">,</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">maxrating</tspan><tspan font-family="ecrm" font-size="1000">)</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">AS</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-54002r2"></a><tspan font-family="ecrm" font-size="0600">2</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">(</tspan><tspan font-family="ecrm" font-size="1000">SELECT</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">age</tspan><tspan font-family="ecrm" font-size="1000">,</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">max</tspan><tspan font-family="ecrm" font-size="1000">(</tspan><tspan font-family="ecrm" font-size="1000">rating</tspan><tspan font-family="ecrm" font-size="1000">)</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-54003r3"></a><tspan font-family="ecrm" font-size="0600">3</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">FROM</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">Sailors</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-54004r4"></a><tspan font-family="ecrm" font-size="0600">4</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">GROUP</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">BY</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">age</tspan><tspan font-family="ecrm" font-size="1000">)</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-54005r5"></a><tspan font-family="ecrm" font-size="0600">5</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-54006r6"></a><tspan font-family="ecrm" font-size="0600">6</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">SELECT</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">S</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="cmsy" font-size="10">*</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-54007r7"></a><tspan font-family="ecrm" font-size="0600">7</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">FROM</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">Sailors</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">S</tspan><tspan font-family="ecrm" font-size="1000">,</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">maxratings</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">m</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-54008r8"></a><tspan font-family="ecrm" font-size="0600">8</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">WHERE</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">S</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">age</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">=</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">m</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">age</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-54009r9"></a><tspan font-family="ecrm" font-size="0600">9</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">AND</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">S</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">rating</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">=</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">m</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">maxrating</tspan><tspan font-family="ecrm" font-size="1000">;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-54010r10"></a><tspan font-family="ecrm" font-size="0600">10</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan>
    </div>
<!--l. 524--><p class="indent" >    We first fine the max rating for each group using WITH clause. WITH maxratings(age,
maxrating) AS, we will SELECT FROM Sailors and GROUP BY age, and for each age we will
group by max rating.
<!--l. 527--><p class="indent" >    Now in the outer query, we can join maxratings with sailors matching WHERE S.age = m.age
and where the rating for that person who is also that age has the highest rating. In essence
we are getting the maxrating for each age using the WITH clause to create another
subquery.
<a 
 id="x1-54011r63"></a>
<h3 class="sectionHead"><span class="titlemark">2.21   </span> <a 
 id="x1-5500021"></a>Brief Detour: Null Values</h3>
      <ul class="itemize1">
      <li class="itemize">Field values are sometimes unknown
           <ul class="itemize2">
           <li class="itemize">SQL provides a special value NULL for each situations
           </li>
           <li class="itemize">every data type can be NULL. Intergers, texts, can all be null.</li></ul>
      </li>
      <li class="itemize">The presence of null complicates many issues. We need to think about these things:
           <ul class="itemize2">
           <li class="itemize">Selection predicates (WHERE)
           </li>
           <li class="itemize">Aggregation</li></ul>
      </li>
      <li class="itemize">But NULLs comes naturally from Outer joins</li></ul>
<a 
 id="x1-55001r64"></a>
<h3 class="sectionHead"><span class="titlemark">2.22   </span> <a 
 id="x1-5600022"></a>NULL at top of WHERE</h3>
<!--l. 547--><p class="noindent" >Sometimes WHERE clause will evaluate to null. SQL has decided that if where clause evaluates to
NULL, then we treat it as false. <a 
 id="likesection.2"></a><a 
 id="x1-56001"></a><object data="CS186Main-4.svg" width="1.0 " height="2.33333 " type="image/svg+xml"><p>SVG-Viewer needed.</p></object>
<span class="marginpar"><object data="CS186Main-5.svg" width="76.20702 " height="65.48253 " type="image/svg+xml"><p>SVG-Viewer needed.</p></object>
<object data="CS186Main-6.svg" width="1.0 " height="2.33333 " type="image/svg+xml"><p>SVG-Viewer needed.</p></object>
</span>
                                                                                         
                                                                                         
                                                                                         
                                                                                         
                                                                                         
                                                                                         
                                                                                         
                                                                                         
    <h2 class="chapterHead"><span class="titlemark">Chapter&#x00A0;3</span><br /><a 
 id="x1-570003"></a>Disks, Files, and Buffers</h2>
<!--l. 2--><p class="noindent" >Talk about the big picture, the architecture of a BDMS
<a 
 id="x1-57001r65"></a>
<h3 class="sectionHead"><span class="titlemark">3.1   </span> <a 
 id="x1-580001"></a>Architecture of BDMS: SQL Client</h3>
<!--l. 5--><p class="noindent" >The architecture of database is broadly composed as a <tspan font-family="ecbx" font-size="1200">client </tspan>and a <tspan font-family="ecbx" font-size="1200">server </tspan>(web, application)
where SQL is typed in at some client. There is a database management system which is a server.
There are a number of modules inside the DBMS.
      <ul class="itemize1">
      <li class="itemize">Parsing &amp; Optimization
      <!--l. 9--><p class="noindent" >This is the first module the SQL query goes to. <br 
class="newline" />Purpose: Parse, check, and verify that the SQL is legal, then translate into an efficient
      relational query plan that the system can execute.
      </li>
      <li class="itemize">Relational Operators
      <!--l. 12--><p class="noindent" >Purpose: Execute a dataflow by operating on <tspan font-family="ecbx" font-size="1200">records </tspan>and <tspan font-family="ecbx" font-size="1200">files</tspan>
      <!--l. 13--><p class="noindent" >Relational operators are the actual operators that are used in relational query plan.
      They are individual algorithms that are put together to operate on data flow. The
      data flow operates on records and files. The data flow pumps data through operators
      to generate outputs to the query.
      </li>
      <li class="itemize">Files and index management
      <!--l. 16--><p class="noindent" >Purpose: organize tables and records as groups of pages in a logical file. The pages of
      the file hold tables full of records.
      </li>
      <li class="itemize">Buffer Management
      <!--l. 18--><p class="noindent" >Purpose: Provide the illusion of operating in memory/ram rather than dealing with
      disks. All the relational logic assumes we are in memory. The buffer management&#8217;s job
      is to map disk blocks from the disk drive into the memory of the system.
      </li>
      <li class="itemize">Disk Space Management
      <!--l. 20--><p class="noindent" >Purpose: translate page requests from buffer manager into physical bytes</li></ul>
<a 
 id="x1-58001r67"></a>
<h3 class="sectionHead"><span class="titlemark">3.2   </span> <a 
 id="x1-590002"></a>Architecture of DBMS</h3>
      <ul class="itemize1">
      <li class="itemize">On a high level, a DBMS is organized in layers
      </li>
      <li class="itemize">Each layer abstracts the layer below it (doesn&#8217;t worry about layers too below
      it)
                                                                                         
                                                                                         
           <ul class="itemize2">
           <li class="itemize">Keeps the complexity of the system at a minimum
           </li>
           <li class="itemize">Performance assumption - optimizer will make assumption about disk speed</li></ul>
      </li></ul>
<a 
 id="x1-59001r62"></a>
<h4 class="subsectionHead"><span class="titlemark">3.2.1   </span> <a 
 id="x1-600001"></a>Concurrency and Recovery</h4>
<!--l. 34--><p class="noindent" >So far, we have talked about only single-user architecture.<br 
class="newline" />There are two cross-cutting issues related to storage and memory management:
      <ul class="itemize1">
      <li class="itemize">Concurrency control: how we allow multiple users to use the system without messing
      up each other&#8217;s data
      </li>
      <li class="itemize">Recovery: module in charge of recovering data from the database</li></ul>
<!--l. 41--><p class="indent" >    These sort of exist on the side and interact with the layers that are in charge of memory and
storage management. <br 
class="newline" />    Context: We have completed our discussion on SQL and we are going to start from bottom of
the database system and work our way up until we have covered each module.
<!--l. 47--><p class="indent" >    <hr class="figure"><div class="figure" 
>
                                                                                         
                                                                                         
<a 
 id="x1-600011"></a>
                                                                                         
                                                                                         
<!--l. 49--><p class="noindent" >
<br /> <div class="caption" 
><span class="id">Figure&#x00A0;3.1: </span><span  
class="content">DBMS</span></div><!--tex4ht:label?: x1-600011 -->
                                                                                         
                                                                                         
<!--l. 51--><p class="indent" >    </div><hr class="endfigure">
<a 
 id="x1-60002r68"></a>
<h3 class="sectionHead"><span class="titlemark">3.3   </span> <a 
 id="x1-610003"></a>Storage Media:</h3>
<!--l. 55--><p class="noindent" >Before we talk about software design, we need to understand <tspan font-family="ecbx" font-size="1200">storage media</tspan>. We no longer have a
model with objects in memory that we can dereference pointers on. Instead, we have an API to get
things to and from the disks. <br 
class="newline" />
<!--l. 56--><p class="indent" >    We read "pages" (fixed amount of data) from disk to RAM and write "pages" from RAM to
disk. We can&#8217;t address a particular bit or byte on the disk. If we we want to address it, we have to
move its "page" to RAM and address locations on RAM to read/write values. These
API calls are <tspan font-family="ecti" font-size="1200">very very slow </tspan>so we need to plan our read/writes carefully to make it
efficient. This explicit API system minimizes "pointer errors" as commonly found in
C.
<h5 class="subsubsectionHead"><a 
 id="x1-620003"></a>Cost of Disks</h5>
<!--l. 60--><p class="noindent" >Hard drives are the cheapest and RAM is the most expensive. We usually use hard drive since it is
cheapest per gb.
<h5 class="subsubsectionHead"><a 
 id="x1-630003"></a>RAM vs. Disk (Hard Drive) Memory</h5>
<!--l. 63--><p class="noindent" >RAM - Random Access Memory, is a series of chips in your computer. When your computer is
turned on, it loads data onto RAM. Open files and programs that are currently running are stored
in RAM. As soon as power to the computer is cut, RAM forgets everything (unsaved
documents!). RAM is very fast, and things that are stored on it can be accessed nearly
instantly.
<!--l. 64--><p class="indent" >    Magnetic Disks do not require power to remember data, so this is where files you save are
stored. However, it is much slower than RAM. Things on the hard drive need to be located, read,
and sent to RAM before they can be processed.
<!--l. 65--><p class="indent" >    Disk = Pluto, RAM = Sacramento, Registers = your head
<a 
 id="x1-63001r69"></a>
<h4 class="subsectionHead"><span class="titlemark">3.3.1   </span> <a 
 id="x1-640001"></a>Storage Hierarchy</h4>
<!--l. 69--><p class="noindent" >Things at the top are small and fast, and things at the bottom are big and slow. From the smallest
to biggest, the order is <br 
class="newline" />    Registers -&#x003E; L1 Cache -&#x003E; L2 Cache -&#x003E; RAM -&#x003E; SSD (Solid State Disk) -&#x003E; Disk.
<!--l. 71--><p class="indent" >    We store the database and backup logs on the disk. For data that is being currently
used, we can store it in RAM for quicker access. It is many many magnitudes faster
to access data from the register than from the disk. If your height = register, disk =
Pluto.
<a 
 id="x1-64001r74"></a>
<h4 class="subsectionHead"><span class="titlemark">3.3.2   </span> <a 
 id="x1-650002"></a>Components of a Disk</h4>
<!--l. 76--><p class="noindent" >A magnetic disk drive is made of <tspan font-family="ecbx" font-size="1200">platters </tspan>that sit together on a spindle and spin at 15000 rpm.
There is an <tspan font-family="ecbx" font-size="1200">arm assembly </tspan>that moves in and out to position reading/writing heads on top of a
desired track on the disk. The tracks under the heads make a "cylinder" We want to fix a location
for the disk head. The arm assembly can be moved in or out to position the head on a particular
track.
                                                                                         
                                                                                         
<!--l. 78--><p class="indent" >    In general, only one head read/writes at any one time. They write block page size that are
multiples of (fixed) <tspan font-family="ecbx" font-size="1200">sector </tspan>sizes. <hr class="figure"><div class="figure" 
>
                                                                                         
                                                                                         
<a 
 id="x1-650012"></a>
                                                                                         
                                                                                         
<!--l. 81--><p class="noindent" >
<br /> <div class="caption" 
><span class="id">Figure&#x00A0;3.2: </span><span  
class="content">Disk Components</span></div><!--tex4ht:label?: x1-650012 -->
                                                                                         
                                                                                         
<!--l. 83--><p class="indent" >    </div><hr class="endfigure">
<a 
 id="x1-65002r75"></a>
<h4 class="subsectionHead"><span class="titlemark">3.3.3   </span> <a 
 id="x1-660003"></a>Accessing a disk page</h4>
      <ul class="itemize1">
      <li class="itemize">Time to access read/write a disk block:
           <ul class="itemize2">
           <li class="itemize"><tspan font-family="ecbx" font-size="1200">Seek time </tspan>(moving arms to position where disk head can read desired track)
           usually 2-3 ms on average
           </li>
           <li class="itemize"><tspan font-family="ecbx" font-size="1200">Rotational delay </tspan>(waiting for appropriate sector/block to rotate under head) -
           on average takes half rotation of a disk, so 0-4 ms for a 15000 rpm disk.
           </li>
           <li class="itemize"><tspan font-family="ecbx" font-size="1200">Transfer time </tspan>(actual moving data to/from disk surface) which is around .25
           ms per 64KB page</li></ul>
      </li>
      <li class="itemize">We want to minimize is the seek and rotational delays since those are the slowest.</li></ul>
<a 
 id="x1-66001r71"></a>
<h3 class="sectionHead"><span class="titlemark">3.4   </span> <a 
 id="x1-670004"></a>Flash (SSD - Solid State Disks) </h3>
<!--l. 99--><p class="noindent" >Flash memory is combined together into disk drives called solid state disks to be packaged and sold
for database use. <br 
class="newline" />Issues with current generation(NAND)
      <ul class="itemize1">
      <li class="itemize">Allows fine-grain reads (4-8k reads at a time), but coarse-grain writes (1-2 MB writes).
      This complicates it a little bit.
      </li>
      <li class="itemize">For a given cell, after 2-3k erasures, the cell will fail, so we want to keep moving hot write
      units around so that there is <tspan font-family="ecbx" font-size="1200">"wear leveling"</tspan>. <a 
 id="likesection.3"></a><a 
 id="x1-67001"></a><object data="CS186Main-7.svg" width="1.0 " height="2.33333 " type="image/svg+xml"><p>SVG-Viewer needed.</p></object>
      <span class="marginpar"><object data="CS186Main-8.svg" width="76.20702 " height="84.8158 " type="image/svg+xml"><p>SVG-Viewer needed.</p></object>
      <object data="CS186Main-9.svg" width="1.0 " height="2.33333 " type="image/svg+xml"><p>SVG-Viewer needed.</p></object>
      </span>
      </li>
      <li class="itemize">Write amplification: Writes are slower than reads. If we write anything, there is a possibility
      that we will write not only the data we are going to write, but also old data. We wanted to
      write small units, but ended up writing big units to reorganize for wear &amp; garbage
      collection.</li></ul>
<!--l. 108--><p class="indent" >    Reading is fast and predictable - single read access time is .03 ms. 4KB random reads take
                                                                                         
                                                                                         
around 500 MB/sec. Reading sequential reads is no faster - takes around 525MB/sec, unlike in
hard disk drives where they are faster. Reading 64k (block size for magnetic disk) is
.5ms.
<!--l. 109--><p class="indent" >    Writing is <tspan font-family="ecti" font-size="1200">slower </tspan>for random writes than sequential writes. Single write access time is .03 ms.
Random writes of small pages (4kb) is 120 MB/sec. However, if you do sequential writes, you get
480 MB/sec.
<h5 class="subsubsectionHead"><a 
 id="x1-680004"></a>Is flash faster than disk?</h5>
<!--l. 114--><p class="noindent" >Yes. Can be 1-10x the bandwidth (bytes/sec) of ideal HDD #s, which is very hard to achieve. We
can expect 10-100x bandwidth for non-sequential read. However, Disk offers 10x the capacity of
flash per dollar and is considerably more affordable.
<!--l. 115--><p class="indent" >    "Locality" (sequentiality) matters for both flash and disk. Reading/writing to "far away"
blocks on disk requires slow seek/rotation delay.
<a 
 id="x1-68001r78"></a>
<h3 class="sectionHead"><span class="titlemark">3.5   </span> <a 
 id="x1-690005"></a>Storage Pragmatics &amp; Trends</h3>
<!--l. 120--><p class="noindent" >Many significant DBs are not big. For example, the daily weather (100 years of data) is only
around 25GB, and the U.S. census is only 200GB. However, data sizes are growing
faster than Moore&#8217;s law. "Big Data" is very real, and the amount of data in our world is
enormous.
<!--l. 121--><p class="indent" >    Bottom Line: Very large DBs are relatively traditional and magnetic disks are still the best
cost/MB by a lot. However, SSDs improve performance and reduces performance variances is a lot
smaller than hard disks.
<!--l. 123--><p class="indent" >    Change is brewing on the hardware storage tech side. There is new technology on the
SW/usage side, especially ones for "persistent storage"(keeps your data without a power
source).
      <ul class="itemize1">
      <li class="itemize">Big Data: can generate and archive data cheaply and easily
      </li>
      <li class="itemize">Small Data: many rich data sets have (small) fixed size</li></ul>
<!--l. 128--><p class="indent" >    People will continue to worry about magnetic disks for some time yet, especially on the large
scale.
<a 
 id="x1-69001r77"></a>
<h4 class="subsectionHead"><span class="titlemark">3.5.1   </span> <a 
 id="x1-700001"></a>Disk Space Management</h4>
<!--l. 131--><p class="noindent" >Recall, most DBMS stores information on <tspan font-family="ecbx" font-size="1200">disks </tspan>and <tspan font-family="ecbx" font-size="1200">SSDs</tspan>. Disks are slow. SSDs are faster, but
they are still slow relative to RAM (memory), and have costly writes.
<a 
 id="x1-70001r80"></a>
<h3 class="sectionHead"><span class="titlemark">3.6   </span> <a 
 id="x1-710006"></a>Block Level Storage</h3>
      <ul class="itemize1">
      <li class="itemize">We read and write large chunks of sequential bytes called <tspan font-family="ecbx" font-size="1200">blocks</tspan>. There are some order
      of blocks on the disk, and it is usually cheaper to get the "next block" than a block
      that is far away.
      </li>
                                                                                         
                                                                                         
      <li class="itemize">We want to maximize usage of data per cost to read/write. We want to "amortize"
      seek and rotational delays for reads and costly writes. "If you&#8217;re going all the way to
      Pluto, pack the spaceship full!"
      </li>
      <li class="itemize">To do this, we will predict future behavior.
           <ul class="itemize2">
           <li class="itemize">Cache popular blocks (keep them in memory for easy access)
           </li>
           <li class="itemize">Pre-fetch likely to be accessed blocks
           </li>
           <li class="itemize">Buffer writes to sequential blocks so we can write runs of them all together later</li></ul>
      </li></ul>
<a 
 id="x1-71001r81"></a>
<h4 class="subsectionHead"><span class="titlemark">3.6.1   </span> <a 
 id="x1-720001"></a>A Note on Terminology</h4>
<!--l. 147--><p class="noindent" ><tspan font-family="ecbx" font-size="1200">Block: </tspan>A unit of transfer for disk read/write between a disk and RAM. It is usually 64-128 KB is
a good number today. Book says 4KB but it is out of date. <br 
class="newline" /><tspan font-family="ecbx" font-size="1200">Page:  </tspan>Same thing as "block". In some texts, "page" = a block-sized chunk of RAM meaning that
page means it is currently in memory, while a block is on disk.
<!--l. 150--><p class="indent" >    For us, we will treat "block" and "page" as synonyms.
<a 
 id="x1-72001r83"></a>
<h4 class="subsectionHead"><span class="titlemark">3.6.2   </span> <a 
 id="x1-730002"></a>Arranging Blocks on Disk</h4>
      <ul class="itemize1">
      <li class="itemize">"Next" block concept
           <ul class="itemize2">
           <li class="itemize">Sequential blocks on same track are considered very close. Next block is the one
           that will rotate under the head after "me".
           </li>
           <li class="itemize">Blocks on the same cylinder (but different platter) are the next closest.
           </li>
           <li class="itemize">Then, it is blocks on an adjacent cylinder.</li></ul>
      </li>
      <li class="itemize">Arrange file pages sequentially by "next" on disk to minimize seek and rotational
      delays.
      </li>
      <li class="itemize">For a <tspan font-family="ecbx" font-size="1200">sequential scan</tspan>, pre-fetch several blocks at a time to increase speed. Essentially, we
      read large consecutive blocks whenever we get the chance.</li></ul>
<a 
 id="x1-73001r82"></a>
                                                                                         
                                                                                         
<h3 class="sectionHead"><span class="titlemark">3.7   </span> <a 
 id="x1-740007"></a>Disk Space Management</h3>
<!--l. 168--><p class="noindent" ><tspan font-family="ecbx" font-size="1200">Lowest layer of DBMS that manages the space on disk </tspan><br 
class="newline" />Purpose:
      <ul class="itemize1">
      <li class="itemize">Map pages to locations on disk - keeps track that page x is at a particular location.
      </li>
      <li class="itemize">Load pages from disk to memory - transfer page x from disk drive to memory.
      </li>
      <li class="itemize">Save pages back to disk and ensuring correct writes.</li></ul>
<!--l. 175--><p class="noindent" >Higher levels (mostly buffer manager) call upon this layer to:
      <ul class="itemize1">
      <li class="itemize">Read/write a page
      </li>
      <li class="itemize">Allocate/de-allocate logical pages</li></ul>
<a 
 id="Q1-1-86"></a>
<h4 class="likesubsectionHead"><a 
 id="x1-750007"></a>Disk Space Management: Requesting Pages</h4>
<!--l. 184--><p class="noindent" >The disk space manager gets requests for sequence of pages, and has to make sure that these
requests are satisfied quickly (usually by getting sequential pages). The physical details are hidden
from the higher levels of the system. Higher levels may "safely" assume <tspan font-family="ecbx" font-size="1200">next page </tspan>is fast
so they will simply expect sequential runs of pages to be be quick to scan. They will
assume the disk manager has intelligently laid out those pages in order to be quickly
retrieved.
<a 
 id="x1-75001r84"></a>
<h4 class="subsectionHead"><span class="titlemark">3.7.1   </span> <a 
 id="x1-760001"></a>Implementation</h4>
<!--l. 186--><p class="noindent" >Proposal 1: DBSM talks to storage device directly
      <ul class="itemize1">
      <li class="itemize">Could be very fast if you knew the device well as it is going directly to the hardware
      itself
      </li>
      <li class="itemize">However, disk drives don&#8217;t last forever, and if you swap the devices, then there will be
      issues with compatibility, so it is not frequently used.</li></ul>
<!--l. 192--><p class="indent" >    Proposal 2: Implement disk space management over the file system (FS)
      <ul class="itemize1">
      <li class="itemize">Allocate  a  single  large  "contiguous"  file  on  a  nice  empty  disk  and  assumes  that
      sequential/nearby byte access is fast
      </li>
      <li class="itemize">Most FS optimize disk layout for sequential access so it gives us more or what we want
      if we start on empty disk
                                                                                         
                                                                                         
      </li>
      <li class="itemize">File systems often require a file to be on a single disk drive, but DBMS "File"s may span
      multiple file-system files on multiple disks/machines. We will have DBMS abstracting
      of file that is made up of many FS files (could be bigger than what a single drive holds).</li></ul>
<!--l. 198--><p class="noindent" ><hr class="figure"><div class="figure" 
><a 
 id="x1-760013"></a>
<br /> <div class="caption" 
><span class="id">Figure&#x00A0;3.3: </span><span  
class="content">Disk Management representation</span></div><!--tex4ht:label?: x1-760013 -->
<!--l. 203--><p class="indent" >    </div><hr class="endfigure">
<!--l. 204--><p class="indent" >    Referring to figure <a 
href="#x1-760013">3.3<!--tex4ht:ref: diskManag --></a>, over every disk there is a file system interface. There is one big file on
each file system that has "pages" in it. On top of that, the <tspan font-family="ectt" font-size="1200">Disk Space Management System </tspan>gives
the illusion of a giant file that spans all the FS files.
<a 
 id="x1-76002r88"></a>
<h4 class="subsectionHead"><span class="titlemark">3.7.2   </span> <a 
 id="x1-770002"></a>Summary</h4>
<!--l. 207--><p class="noindent" >DSM provides API to read and write pages to devices <br 
class="newline" />Pages: block level organization of bytes on disk <br 
class="newline" />provides "next" locality and abstracts details of whether or not we have a device or FS
underneath.
<a 
 id="x1-77001r85"></a>
<h3 class="sectionHead"><span class="titlemark">3.8   </span> <a 
 id="x1-780008"></a>File Representation</h3>
<a 
 id="x1-78001r90"></a>
<h4 class="subsectionHead"><span class="titlemark">3.8.1   </span> <a 
 id="x1-790001"></a>Overview: representation</h4>
<!--l. 219--><p class="noindent" >Files are represented with a table of rows and columns. We map that into files and pages (contain
a collection of records). The table is made up of files which are collections of pages. The records are
represented in memory as arrays of bytes. <br 
class="newline" /><br 
class="newline" />Pages are managed:
      <ul class="itemize1">
      <li class="itemize">In memory, stored in pages by the buffer manager where they can be accessed as bytes
      in RAM.
      </li>
      <li class="itemize">On disk, by the disk space manager: pages are read/written to physical disk/files.</li></ul>
    <div class="newtheorem">
<!--l. 228--><p class="noindent" ><span class="head">
<tspan font-family="ecbx" font-size="1200">Definition</tspan><tspan font-family="ecbx" font-size="1200">&#x00A0;3.1</tspan> </span><tspan font-family="ecbi" font-size="1200">DB FILE:  </tspan><tspan font-family="ecti" font-size="1200">A collection of pages, each containing a collection of records.</tspan>
    </div>
<!--l. 231--><p class="indent" >    API for higher layers of the DBMS can:
      <ul class="itemize1">
      <li class="itemize">Insert/delete/modify record
      </li>
      <li class="itemize">Fetch a particular record by <tspan font-family="ecbx" font-size="1200">record id </tspan>- a pointer encoding a pair of (<tspan font-family="ectt" font-size="1200">pageID</tspan>, <tspan font-family="ectt" font-size="1200">location</tspan>
      on the page)
                                                                                         
                                                                                         
      </li>
      <li class="itemize">Scan all records, possibly with some conditions on the records to be retrieved</li></ul>
<!--l. 237--><p class="noindent" >A file could span multiple OS files and even machines, or could even be implemented on &#8217;raw" disk
devices.
<a 
 id="x1-79002r91"></a>
<h3 class="sectionHead"><span class="titlemark">3.9   </span> <a 
 id="x1-800009"></a>Many DB File Structures</h3>
      <ul class="itemize1">
      <li class="itemize">Unordered Heap files - records placed arbitrarily across pages
           <ul class="itemize2">
           <li class="itemize">Collection of records (file on disk) in no particular order
           </li>
           <li class="itemize">As file shrinks/grows, pages are allocated/de-allocated
           </li>
           <li class="itemize">To support record level operations, we must be able to:
               <ul class="itemize3">
               <li class="itemize">keep track of the pages in a file
               </li>
               <li class="itemize">keep track of free space on pages
               </li>
               <li class="itemize">keep track of the records on a page</li></ul>
           </li></ul>
      </li>
      <li class="itemize">Clustered Heap files - records and pages are grouped
      </li>
      <li class="itemize">Sorted Files - pages and records are sorted in order
      </li>
      <li class="itemize">Index Files (B+ trees) - may contain records or point to records in other files</li></ul>
<a 
 id="x1-80001r92"></a>
<h4 class="subsectionHead"><span class="titlemark">3.9.1   </span> <a 
 id="x1-810001"></a>Heap File implemented as List</h4>
<!--l. 263--><p class="noindent" >The idea is that there is header page at some location on the disk, with an associated location ID
and name stored in a <tspan font-family="ecbx" font-size="1200">database catalog</tspan>.
<!--l. 265--><p class="indent" >    Each page contains 2 "pointers" plus <tspan font-family="ecbx" font-size="1200">free space </tspan>and <tspan font-family="ecbx" font-size="1200">data</tspan>. The header page itself has two
pointers - one to a list of full pages, and one to a list of pages with free space.
<!--l. 266--><p class="indent" >    What is wrong with this? Suppose you are looking for a page with enough space for 20 byte
records. The only way to know is to walk down the list of free space pages, looking through many
before finding one with 20 bytes. We want a faster way to find a page with enough
capacity.
<a 
 id="x1-81001r94"></a>
                                                                                         
                                                                                         
<h4 class="subsectionHead"><span class="titlemark">3.9.2   </span> <a 
 id="x1-820002"></a>Better: Use a page directory</h4>
<!--l. 270--><p class="noindent" >The header pages are in a linked list of header pages called a <tspan font-family="ecbx" font-size="1200">directory</tspan>. Thus, we have multiple
header pages, with the first one being stored in the catalog. Each directory entry includes a pair of
the # free bytes on the page and a pointer to that page. Header pages accessed often so they are
likely to be in cache in RAM (cheap access).
<!--l. 271--><p class="indent" >    Finding a page to fit a record required far fewer page loads than linked list. Why? Because one
header page keeps track of the free space of many pages. The header pages just stores a small pair
of # free bytes and ID of a page.
<a 
 id="x1-82001r93"></a>
<h3 class="sectionHead"><span class="titlemark">3.10   </span> <a 
 id="x1-8300010"></a>Page Layout</h3>
<!--l. 276--><p class="noindent" >The <tspan font-family="ecbx" font-size="1200">header </tspan>(holds metadata) contains information about:
      <ul class="itemize1">
      <li class="itemize">Number of records
      </li>
      <li class="itemize">Free space
      </li>
      <li class="itemize">Maybe a next/last pointer to page in linked list
      </li>
      <li class="itemize">Bitmaps, slot table to find free space on the page</li></ul>
<a 
 id="x1-83001r95"></a>
<h4 class="subsectionHead"><span class="titlemark">3.10.1   </span> <a 
 id="x1-840001"></a>Things to address</h4>
      <ul class="itemize1">
      <li class="itemize">Fixed length (all records are same length) vs. Variable length
      </li>
      <li class="itemize">How do we make sure the record id = (page, location in page) is stable and accurate
      over time?
      </li>
      <li class="itemize">How do we add and delete records?</li></ul>
<!--l. 290--><p class="noindent" >Options for page layouts depends on the record length (fixed or variable) and page packing (packed or
unpacked)
<h5 class="subsubsectionHead"><a 
 id="x1-850001"></a>A note on imagery</h5>
<!--l. 294--><p class="noindent" >Pages are nothing more than an array of bytes on disk. The data is stored in linear
order, with 1 byte per position on the disk. Memory and disk addresses are ordered.
The bytes don&#8217;t fix nicely on screen so we will "wrap around" the linear order into a
rectangle.
<a 
 id="Q1-1-99"></a>
<h4 class="likesubsectionHead"><a 
 id="x1-860001"></a>Fixed Length Records, Packed</h4>
<!--l. 297--><p class="noindent" >The records are packed densely on the page after a fixed length page header. We need to
                                                                                         
                                                                                         
know the location on the page for each record id (pageid, "location on page"). The
start of record #4 is at the byte offset = (# of bytes in page header) + 3 * (record
length). The location of the empty space can be similarly calculated with the offset and
the # of records in the page from the page header. Thus, appending records is very
easy.
<!--l. 302--><p class="indent" >    Deletion: we must repack and rearrange the page. The record id pointers must
also be updated after they are repacked. This could be expensive, so this is not good
way.
<a 
 id="Q1-1-101"></a>
<h4 class="likesubsectionHead"><a 
 id="x1-870001"></a>Fixed Length Record, Unpacked</h4>
<!--l. 307--><p class="noindent" >Keep a <tspan font-family="ecbx" font-size="1200">bitmap </tspan>in the page header that has a bit for each slot on the page. <br 
class="newline" />Record id = (page id, slot # in page)
      <ul class="itemize1">
      <li class="itemize">Insert - find the first empty slot (using the bitmap) and then mark the bitmap full.
      </li>
      <li class="itemize">Delete - clear bit by just marking the bitmap empty. We don&#8217;t have to change the
      inbound pointer for other records.</li></ul>
<!--l. 313--><p class="noindent" >By doing this we don&#8217;t have to repack and move record pointers. This is better choice! No space is
wasted since we can always put records in holes of previously deleted records.
<a 
 id="Q1-1-103"></a>
<h4 class="likesubsectionHead"><a 
 id="x1-880001"></a>Variable Length Records</h4>
<!--l. 317--><p class="noindent" >These have column types of variable length, like string type. Since length of records may differ
from row to row, it is difficult to know where each record starts an end. Deleting records is tricky,
because new records may not fit in previously emptied slots.
<a 
 id="x1-88001r97"></a>
<h4 class="subsectionHead"><span class="titlemark">3.10.2   </span> <a 
 id="x1-890002"></a>First: relocate metadata to footer</h4>
<!--l. 320--><p class="noindent" >We then use a <tspan font-family="ecbx" font-size="1200">slotted page </tspan>directory in footer and have the first (rightmost) element be a pointer
to the <tspan font-family="ecti" font-size="1200">free space</tspan>. Each succeeding element contains the length and a offset pointer to the beginning
of the record. They are in reverse order, right to left.
<!--l. 321--><p class="indent" >    To <tspan font-family="ecbx" font-size="1200">delete </tspan>we just set that record to be null, and this doesn&#8217;t affect pointers to other
records.
<!--l. 322--><p class="indent" >    To <tspan font-family="ecbx" font-size="1200">insert</tspan>:
      <ul class="itemize1">
      <li class="itemize">Place record in free space on page
      </li>
      <li class="itemize">Create a new pointer/length pair in the next open slot in slot directory
      </li>
      <li class="itemize">Update the free space pointer by adding the new length</li></ul>
<!--l. 329--><p class="indent" >    Problem? There is free space in the middle (<tspan font-family="ecbx" font-size="1200">fragmentation</tspan>). We want to reorganize data on
page by repacking and changing pointers. When should we reorganize? We organize only when we
run out of free space at the end.
                                                                                         
                                                                                         
<!--l. 330--><p class="indent" >    What if we run out of slots in the footer, but still have free space? We can track the number of
slots (free or not) in the slot directory on the far right. To extend slot directory, we
can just add another slot to the left. Since slots grow from end to page inward, and
records grow from beginning of page inward, the page is full when the two meet each
other.
<a 
 id="x1-89001r96"></a>
<h3 class="sectionHead"><span class="titlemark">3.11   </span> <a 
 id="x1-9000011"></a>Record Layout</h3>
<a 
 id="x1-90001r105"></a>
<h4 class="subsectionHead"><span class="titlemark">3.11.1   </span> <a 
 id="x1-910001"></a>Record Format</h4>
<!--l. 334--><p class="noindent" >In the relational model, each record has a fixed type. We assume that there is a scheme for our
table in the <tspan font-family="ecbx" font-size="1200">system catalog</tspan>, so the type does not need to be stored by the record itself.
<br 
class="newline" />Goal:
      <ul class="itemize1">
      <li class="itemize">Records should be compact in memory and disk format.
      </li>
      <li class="itemize">Fast access to fields.</li></ul>
<a 
 id="x1-91001r107"></a>
<h4 class="subsectionHead"><span class="titlemark">3.11.2   </span> <a 
 id="x1-920002"></a>Record Formats: Fixed Length</h4>
<!--l. 344--><p class="noindent" >Field types are the same for all records in a file, and this type info is stored separately in the
system catalog as discussed earlier. The on-disk byte representation is the same format as in
memory. To find the i&#8217;th field, find the length of the i-1 fields before t as the offset. One
disadvantage is that space is wasted even for null fields.
<a 
 id="x1-92001r108"></a>
<h4 class="subsectionHead"><span class="titlemark">3.11.3   </span> <a 
 id="x1-930003"></a>Record Formats: Variable Length</h4>
<!--l. 347--><p class="noindent" >We could try to pad records, but could be a value even bigger than what you allocated for. We
could also use delimiters and count commas, but this would be very slow. Furthermore, the
delimiter would not be allowed to be anywhere else in your data.
<a 
 id="Q1-1-110"></a>
<h4 class="likesubsectionHead"><a 
 id="x1-940003"></a>Solution</h4>
<!--l. 351--><p class="noindent" >Move all variable length fields to the end for fast access. Introduce a record header that
points to the end of variable length fields. The fixed length records will be at the very
beginning. We can use arithmetic to access fixed records and use pointers to access variable
ones. If there is null, you just make the pointer point to the same place as the next
pointer. Since, they are both pointing to the same place, the first pointer must be null. <a 
 id="likesection.4"></a><a 
 id="x1-94001"></a><object data="CS186Main-10.svg" width="1.0 " height="2.33333 " type="image/svg+xml"><p>SVG-Viewer needed.</p></object>
<span class="marginpar"><object data="CS186Main-11.svg" width="76.20702 " height="104.14905 " type="image/svg+xml"><p>SVG-Viewer needed.</p></object>
<object data="CS186Main-12.svg" width="1.0 " height="2.33333 " type="image/svg+xml"><p>SVG-Viewer needed.</p></object>
                                                                                         
                                                                                         
</span><hr class="figure"><div class="figure" 
>
                                                                                         
                                                                                         
<a 
 id="x1-940024"></a>
                                                                                         
                                                                                         
<!--l. 355--><p class="noindent" >
<br /> <div class="caption" 
><span class="id">Figure&#x00A0;3.4: </span><span  
class="content">Record format for variable length with header</span></div><!--tex4ht:label?: x1-940024 -->
                                                                                         
                                                                                         
<!--l. 357--><p class="indent" >    </div><hr class="endfigure">
<a 
 id="x1-94003r106"></a>
<h3 class="sectionHead"><span class="titlemark">3.12   </span> <a 
 id="x1-9500012"></a>Summary</h3>
<!--l. 359--><p class="noindent" >We map tables to file full of pages. We map records to a byte representation with multiple fields
inside. We then put the two together by putting records on pages with the slotted page
method.
                                                                                         
                                                                                         
    <h2 class="chapterHead"><span class="titlemark">Chapter&#x00A0;4</span><br /><a 
 id="x1-960004"></a>Files and Index Management</h2>
<!--l. 366--><p class="noindent" >There are many file organizations and some are good for certain things.
      <ul class="itemize1">
      <li class="itemize"><tspan font-family="ecbx" font-size="1200">Heap (unordered) files: </tspan>suitable when a typical access is a full scan of all records
      </li>
      <li class="itemize"><tspan font-family="ecbx" font-size="1200">Sorted files: </tspan>best for retrieval in some order, or when a range of records is needed
      </li>
      <li class="itemize"><tspan font-family="ecbx" font-size="1200">Clustered Files &amp; Indexes: </tspan>groups data into blocks to enable fast lookups and
      efficient modification</li></ul>
<!--l. 372--><p class="noindent" >We want to quantitatively measure how much one format is better than another.
<a 
 id="x1-96001r113"></a>
<h3 class="sectionHead"><span class="titlemark">4.1   </span> <a 
 id="x1-970001"></a>Cost Model for analysis</h3>
      <ul class="itemize1">
      <li class="itemize"><tspan font-family="ecbx" font-size="1200">B</tspan>: the number of data blocks in file
      </li>
      <li class="itemize"><tspan font-family="ecbx" font-size="1200">R</tspan>: the number of records per block. We assume every record block holds the same
      number of records.
      </li>
      <li class="itemize"><tspan font-family="ecbx" font-size="1200">D</tspan>: (average) time to read/write disk blocks</li></ul>
<!--l. 379--><p class="noindent" >We focus on the average case analysis for uniform, random workloads. We ignore sequential vs.
random/remote access, pre-fetching, and any in-memory cost (CPU costs, computing, is cost-free).
<br 
class="newline" />
<!--l. 380--><p class="indent" >    We also assume that:
      <ul class="itemize1">
      <li class="itemize">Every insert or delete is of a single record
      </li>
      <li class="itemize">For equality selections like <tspan font-family="ectt" font-size="1200">Where column = value</tspan>, we assume there is exactly one
      match
      </li>
      <li class="itemize">For heap files: insert always appends to end of file (last empty slot).
      </li>
      <li class="itemize">For sorted files: maintain them packed and sorted according to search key (a particular
      column we want to sort on)</li></ul>
<a 
 id="x1-97001r115"></a>
<h3 class="sectionHead"><span class="titlemark">4.2   </span> <a 
 id="x1-980002"></a>Heap Files vs. Sorted Files</h3>
<!--l. 390--><p class="noindent" >B = # of data blocks, R = # records / block, D = avg time to read/write disk block
<div class="table">
                                                                                         
                                                                                         
<!--l. 391--><p class="indent" >    <hr class="float"><div class="float" 
>
                                                                                         
                                                                                         
<div class="tabular"> <table id="TBL-8" class="tabular" 
cellspacing="0" cellpadding="0"  
><colgroup id="TBL-8-1g"><col 
id="TBL-8-1"></colgroup><colgroup id="TBL-8-2g"><col 
id="TBL-8-2"></colgroup><colgroup id="TBL-8-3g"><col 
id="TBL-8-3"></colgroup><colgroup id="TBL-8-4g"><col 
id="TBL-8-4"></colgroup><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-8-1-"><td  style="white-space:wrap; text-align:left;" id="TBL-8-1-1"  
class="td11"><!--l. 395--><p class="noindent" >                   </td><td  style="white-space:wrap; text-align:left;" id="TBL-8-1-2"  
class="td11"><!--l. 395--><p class="noindent" >Heap Files                </td><td  style="white-space:wrap; text-align:left;" id="TBL-8-1-3"  
class="td11"><!--l. 395--><p class="noindent" >Sorted Files              </td><td  style="white-space:nowrap; text-align:center;" id="TBL-8-1-4"  
class="td11">Which is faster</td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-8-2-"><td  style="white-space:wrap; text-align:left;" id="TBL-8-2-1"  
class="td11"><!--l. 398--><p class="noindent" >Scan all records          </td><td  style="white-space:wrap; text-align:left;" id="TBL-8-2-2"  
class="td11"><!--l. 398--><p class="noindent" >B * D                      </td><td  style="white-space:wrap; text-align:left;" id="TBL-8-2-3"  
class="td11"><!--l. 398--><p class="noindent" >B * D                      </td><td  style="white-space:nowrap; text-align:center;" id="TBL-8-2-4"  
class="td11">    same       </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-8-3-"><td  style="white-space:wrap; text-align:left;" id="TBL-8-3-1"  
class="td11"><!--l. 400--><p class="noindent" >Equality Search          </td><td  style="white-space:wrap; text-align:left;" id="TBL-8-3-2"  
class="td11"><!--l. 400--><p class="noindent" ><tspan font-family="cmr" font-size="12">0</tspan><tspan font-family="cmmi" font-size="12">.</tspan><tspan font-family="cmr" font-size="12">5 </tspan><tspan font-family="cmsy" font-size="10">* </tspan><tspan font-family="cmmi" font-size="12">B </tspan><tspan font-family="cmsy" font-size="10">* </tspan><tspan font-family="cmmi" font-size="12">D</tspan>             </td><td  style="white-space:wrap; text-align:left;" id="TBL-8-3-3"  
class="td11"><!--l. 400--><p class="noindent" ><tspan font-family="cmr" font-size="12">(</tspan><tspan font-family="cmmi" font-size="12">log</tspan><sub><tspan font-family="cmr" font-size="8">2</tspan></sub><tspan font-family="cmmi" font-size="12">B</tspan><tspan font-family="cmr" font-size="12">) </tspan><tspan font-family="cmsy" font-size="10">* </tspan><tspan font-family="cmmi" font-size="12">D</tspan>            </td><td  style="white-space:nowrap; text-align:center;" id="TBL-8-3-4"  
class="td11">    sorted      </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-8-4-"><td  style="white-space:wrap; text-align:left;" id="TBL-8-4-1"  
class="td11"><!--l. 402--><p class="noindent" >Range Search             </td><td  style="white-space:wrap; text-align:left;" id="TBL-8-4-2"  
class="td11"><!--l. 402--><p class="noindent" ><tspan font-family="cmmi" font-size="12">B </tspan><tspan font-family="cmsy" font-size="10">* </tspan><tspan font-family="cmmi" font-size="12">D</tspan>                   </td><td  style="white-space:wrap; text-align:left;" id="TBL-8-4-3"  
class="td11"><!--l. 402--><p class="noindent" ><tspan font-family="cmr" font-size="12">(</tspan><tspan font-family="cmmi" font-size="12">log</tspan><sub><tspan font-family="cmr" font-size="8">2</tspan></sub><tspan font-family="cmmi" font-size="12">B </tspan><tspan font-family="cmr" font-size="12">+ </tspan><tspan font-family="cmmi" font-size="12">pages</tspan><tspan font-family="cmr" font-size="12">) </tspan><tspan font-family="cmsy" font-size="10">* </tspan><tspan font-family="cmmi" font-size="12">D</tspan>   </td><td  style="white-space:nowrap; text-align:center;" id="TBL-8-4-4"  
class="td11">    sorted      </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-8-5-"><td  style="white-space:wrap; text-align:left;" id="TBL-8-5-1"  
class="td11"><!--l. 404--><p class="noindent" >Insert                       </td><td  style="white-space:wrap; text-align:left;" id="TBL-8-5-2"  
class="td11"><!--l. 404--><p class="noindent" >2 * D                       </td><td  style="white-space:wrap; text-align:left;" id="TBL-8-5-3"  
class="td11"><!--l. 404--><p class="noindent" >
<center class="math-display" >
<img 
src="CS186Main8x.png" alt="((log B ) + B ) * D
    2
" class="math-display" ></center>                         </td><td  style="white-space:nowrap; text-align:center;" id="TBL-8-5-4"  
class="td11">    heap       </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-8-6-"><td  style="white-space:wrap; text-align:left;" id="TBL-8-6-1"  
class="td11"><!--l. 406--><p class="noindent" >Delete                       </td><td  style="white-space:wrap; text-align:left;" id="TBL-8-6-2"  
class="td11"><!--l. 406--><p class="noindent" ><tspan font-family="cmr" font-size="12">(</tspan><img 
src="CS186Main9x.png" alt="B-
2"  class="frac" align="middle"> <tspan font-family="cmr" font-size="12">+ 1) </tspan><tspan font-family="cmsy" font-size="10">* </tspan><tspan font-family="cmmi" font-size="12">D</tspan>            </td><td  style="white-space:wrap; text-align:left;" id="TBL-8-6-3"  
class="td11"><!--l. 406--><p class="noindent" ><tspan font-family="cmr" font-size="12">(</tspan><tspan font-family="cmmi" font-size="12">log</tspan><sub><tspan font-family="cmr" font-size="8">2</tspan></sub><tspan font-family="cmmi" font-size="12">B</tspan><tspan font-family="cmr" font-size="12">) + </tspan><tspan font-family="cmmi" font-size="12">B</tspan><tspan font-family="cmr" font-size="12">) </tspan><tspan font-family="cmsy" font-size="10">* </tspan><tspan font-family="cmmi" font-size="12">D</tspan>      </td><td  style="white-space:nowrap; text-align:center;" id="TBL-8-6-4"  
class="td11">    heap       </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-8-7-"><td  style="white-space:wrap; text-align:left;" id="TBL-8-7-1"  
class="td11">                    </td></tr></table></div>
                                                                                         
                                                                                         
    </div><hr class="endfloat" />
    </div>
<a 
 id="Q1-1-117"></a>
<h4 class="likesubsectionHead"><a 
 id="x1-990002"></a>Scan all records </h4>
<!--l. 411--><p class="noindent" >To scan all records, we just go through everything once, so being sorted or not does not change
anything. <a 
 id="Q1-1-119"></a>
<h4 class="likesubsectionHead"><a 
 id="x1-1000002"></a>Equality Search</h4>
<!--l. 413--><p class="noindent" >We want to find the record where column = value, and there is exactly one match. This is
important. <a 
 id="Q1-1-121"></a>
<h5 class="likesubsubsectionHead"><a 
 id="x1-1010002"></a>Heap file</h5>
      <ul class="itemize1">
      <li class="itemize">P(i): probability that key is one page i is <img 
src="CS186Main10x.png" alt="1B-"  class="frac" align="middle">
      </li>
      <li class="itemize">T(i): number of pages touched if key is on page i is i
      </li>
      <li class="itemize">Pages touched on average:
      <center class="math-display" >
      <img 
src="CS186Main11x.png" alt=" B              B
&#x2211;              &#x2211;    1-   B-(B-+--1)   B-
    T (i)P (i) =     iB  =    2B     &#x2248;  2
 i=1             i=1
      " class="math-display" ></center></li></ul>
<a 
 id="Q1-1-123"></a>
<h5 class="likesubsubsectionHead"><a 
 id="x1-1020002"></a>Sorted File</h5>
<!--l. 423--><p class="noindent" >Start in the middle of the file and use binary search.
      <ul class="itemize1">
      <li class="itemize">Worst case = Average case = Worst case = <tspan font-family="cmmi" font-size="12">log</tspan><sub><tspan font-family="cmr" font-size="8">2</tspan></sub><tspan font-family="cmmi" font-size="12">B</tspan>
      <center class="math-display" >
      <img 
src="CS186Main12x.png" alt="lo&#x2211;g2B 2i-1    1 l&#x2211;og2                 B - 1
    i---- = --     i2i-1 = log2B -  ------
i=1   B     B  i=1                   B
      " class="math-display" ></center></li></ul>
<a 
 id="Q1-1-125"></a>
<h4 class="likesubsectionHead"><a 
 id="x1-1030002"></a>Range Search</h4>
<a 
 id="Q1-1-127"></a>
<h5 class="likesubsubsectionHead"><a 
 id="x1-1040002"></a>Heap File</h5>
<!--l. 431--><p class="noindent" >We always have to touch all blocks, since we don&#8217;t know how many records there will be in the
desired range. <a 
 id="Q1-1-129"></a>
<h5 class="likesubsubsectionHead"><a 
 id="x1-1050002"></a>Sorted File</h5>
<!--l. 433--><p class="noindent" >We can find the start of the range with and then search right until we get to the end of the range.
<a 
 id="Q1-1-131"></a>
<h4 class="likesubsectionHead"><a 
 id="x1-1060002"></a>Insert</h4>
<a 
 id="Q1-1-133"></a>
<h5 class="likesubsubsectionHead"><a 
 id="x1-1070002"></a>Heap File</h5>
<!--l. 436--><p class="noindent" >For heap files, we assume that we insert at the end of the file. The cost is <tspan font-family="cmr" font-size="12">2 </tspan><tspan font-family="cmsy" font-size="10">* </tspan><tspan font-family="cmmi" font-size="12">D</tspan>. We need to
bring the pages into memory by reading the page, then write some bytes onto page and
then write back to the disk. We can&#8217;t manipulate things on the disk directly. We read
them, manipulate them in memory, then write the memory buffer back to the disk.
<a 
 id="Q1-1-135"></a>
<h5 class="likesubsubsectionHead"><a 
 id="x1-1080002"></a>Sorted File</h5>
      <ul class="itemize1">
      <li class="itemize">Find location for element. Cost = <tspan font-family="cmmi" font-size="12">log</tspan><sub><tspan font-family="cmr" font-size="8">2</tspan></sub><tspan font-family="cmmi" font-size="12">B </tspan><tspan font-family="cmsy" font-size="10">* </tspan><tspan font-family="cmmi" font-size="12">D</tspan>
      </li>
      <li class="itemize">Insert and shift the rest of file right - we need to pass through the remaining file. On
      average the data is in the middle of file. Then, writing the file back is BD.</li></ul>
<!--l. 442--><p class="noindent" >
    <center class="math-display" >
<img 
src="CS186Main13x.png" alt="((log2B ) + B ) * D  " class="math-display" ></center>
<a 
 id="Q1-1-137"></a>
                                                                                         
                                                                                         
<h4 class="likesubsectionHead"><a 
 id="x1-1090002"></a>Delete</h4>
<a 
 id="Q1-1-139"></a>
<h5 class="likesubsubsectionHead"><a 
 id="x1-1100002"></a>Heap File</h5>
<!--l. 445--><p class="noindent" >Average case to find a record is <img 
src="CS186Main14x.png" alt="B-
2"  class="frac" align="middle">. Delete record from page, so the cost = <tspan font-family="cmr" font-size="12">(</tspan><img 
src="CS186Main15x.png" alt="B-
2"  class="frac" align="middle"> <tspan font-family="cmr" font-size="12">+ 1) </tspan><tspan font-family="cmsy" font-size="10">* </tspan><tspan font-family="cmmi" font-size="12">D</tspan>. We add 1
for the extra write for the modified page. <a 
 id="Q1-1-141"></a>
<h5 class="likesubsubsectionHead"><a 
 id="x1-1110002"></a>Sorted File</h5>
      <ul class="itemize1">
      <li class="itemize">Find location for record: <tspan font-family="cmmi" font-size="12">log</tspan><sub><tspan font-family="cmr" font-size="8">2</tspan></sub><tspan font-family="cmmi" font-size="12">B</tspan>
      </li>
      <li class="itemize">Deleting the record creates a gap, breaking our packed rule. We need to read and write
      every page to the right to pack it back.
      </li>
      <li class="itemize">Shifting the rest by 1 record = <tspan font-family="cmr" font-size="12">2 </tspan><tspan font-family="cmsy" font-size="10">* </tspan><tspan font-family="cmr" font-size="12">(</tspan><img 
src="CS186Main16x.png" alt="B-
2"  class="frac" align="middle"><tspan font-family="cmr" font-size="12">)</tspan></li></ul>
<a 
 id="x1-111001r116"></a>
<h3 class="sectionHead"><span class="titlemark">4.3   </span> <a 
 id="x1-1120003"></a>Conclusion</h3>
<!--l. 454--><p class="noindent" >With everything done, we can still do better with <tspan font-family="ecbx" font-size="1200">Indexes</tspan>
                                                                                         
                                                                                         
                                                                                         
                                                                                         
                                                                                         
                                                                                         
    <h2 class="chapterHead"><span class="titlemark">Chapter&#x00A0;5</span><br /><a 
 id="x1-1130005"></a>Module 3</h2>
<!--l. 2--><p class="noindent" >Reminder: We had two options to access data in heap file.
      <ul class="itemize1">
      <li class="itemize">use record id fetch, where the system gets pageid and slotid.
      </li>
      <li class="itemize">Scan through the record and look through all the values</li></ul>
<!--l. 7--><p class="noindent" >It would be nice if we could look things up by value. We will build an index. We need a
persistent disk based data structure that is "paginated" in which it is made up of disk
pages.
<a 
 id="x1-113001r143"></a>
<h3 class="sectionHead"><span class="titlemark">5.1   </span> <a 
 id="x1-1140001"></a>Index</h3>
<!--l. 11--><p class="noindent" ><tspan font-family="ecbx" font-size="1200">Index </tspan>is a data structure that enables fast <tspan font-family="ecbx" font-size="1200">lookup </tspan>and <tspan font-family="ecbx" font-size="1200">modification </tspan>of <tspan font-family="ecbx" font-size="1200">data entries </tspan>by <tspan font-family="ecbx" font-size="1200">search</tspan>
<tspan font-family="ecbx" font-size="1200">key</tspan>.
      <ul class="itemize1">
      <li class="itemize"><tspan font-family="ecbx" font-size="1200">Lookup </tspan>may vary. May support many different operations. Some indices are for 1-d
      region, some are for 2-d region.
      </li>
      <li class="itemize"><tspan font-family="ecbx" font-size="1200">Search Key</tspan>: any subset of columns in the relation. They do not need to be unique.
      EX: (firstname), or (firstname, lastname)
      </li>
      <li class="itemize"><tspan font-family="ecbx" font-size="1200">Data Entries: </tspan>Items stored in the index. Items we store in the index depends on how
      we build the index. Today we assume that we are storing pair (k=key, recordid). Where
      the recordid&#8217;s are pointers to records in heap files.
      </li>
      <li class="itemize"><tspan font-family="ecbx" font-size="1200">modification</tspan>: Want to support fast insert and delete.</li></ul>
<a 
 id="x1-114001r145"></a>
<h3 class="sectionHead"><span class="titlemark">5.2   </span> <a 
 id="x1-1150002"></a>Simple idea</h3>
      <dl class="enumerate"><dt class="enumerate">
   1. </dt><dd 
class="enumerate">Step 1 is to sort the file and leave some space. The pages will be physically stored
      in logical order. We will not need "next" pointers to link the pages because they are
      sorted in logical order.
      </dd><dt class="enumerate">
   2. </dt><dd 
class="enumerate">We then build the index data structure over this. We use this instead of a binary tree
      because then there will be <tspan font-family="cmmi" font-size="12">log</tspan><sub><tspan font-family="cmr" font-size="8">2</tspan></sub>  I/O Which will still be too tall. We want a tree that
      has a bigger fan and lower depth.</dd></dl>
<a 
 id="x1-115003r146"></a>
                                                                                         
                                                                                         
<h3 class="sectionHead"><span class="titlemark">5.3   </span> <a 
 id="x1-1160003"></a>Build a high fan-out search tree</h3>
<!--l. 33--><p class="noindent" >We need to build a search file for our file. Start with a simple file that is sorted by key. From
fig <a 
href="#x1-1160011">5.1<!--tex4ht:ref: startsimple --></a> we see that there is a 1 and then a pointer that points to the page that starts
with and 3 that points to page that starts with 3. This isn&#8217;t the actual layout however,
so it actually looked more like fig <a 
href="#x1-1160022">5.2<!--tex4ht:ref: actual --></a> because we need to break the files into pages.
<hr class="figure"><div class="figure" 
>
                                                                                         
                                                                                         
<a 
 id="x1-1160011"></a>
                                                                                         
                                                                                         
<!--l. 40--><p class="noindent" >
<br /> <div class="caption" 
><span class="id">Figure&#x00A0;5.1: </span><span  
class="content">start</span></div><!--tex4ht:label?: x1-1160011 -->
                                                                                         
                                                                                         
<!--l. 43--><p class="indent" >    </div><hr class="endfigure">
<!--l. 44--><p class="indent" >    <hr class="figure"><div class="figure" 
>
                                                                                         
                                                                                         
<a 
 id="x1-1160022"></a>
                                                                                         
                                                                                         
<!--l. 46--><p class="noindent" >
<br /> <div class="caption" 
><span class="id">Figure&#x00A0;5.2: </span><span  
class="content">With the pages separated</span></div><!--tex4ht:label?: x1-1160022 -->
                                                                                         
                                                                                         
<!--l. 49--><p class="indent" >    </div><hr class="endfigure">
<!--l. 50--><p class="indent" >    What is the complexity of this? It is still binary search, just a constant factor smaller input.
We are just skipping a constant number of values per page. <hr class="figure"><div class="figure" 
>
                                                                                         
                                                                                         
<a 
 id="x1-1160033"></a>
                                                                                         
                                                                                         
<!--l. 54--><p class="noindent" >
<br /> <div class="caption" 
><span class="id">Figure&#x00A0;5.3: </span><span  
class="content">Recursively build the file</span></div><!--tex4ht:label?: x1-1160033 -->
                                                                                         
                                                                                         
<!--l. 56--><p class="indent" >    </div><hr class="endfigure">
<!--l. 57--><p class="indent" >    We can try to recursively "index" key file. We will build a search file for our search file. They
will each have key pointer pairs. We can recursively go up until we get one page at the very top.
<br 
class="newline" />We need to maintain the <tspan font-family="ecbx" font-size="1200">key invariant</tspan>:
    <table 
class="equation-star"><tr><td>
    <center class="math-display" >
<img 
src="CS186Main17x.png" alt="Node [...,(KL,  PL),(KR, PR ),...] &#x2192; All tuples in rangeKL  &#x2264; K  &#x003C; KRare  in treePL
" class="math-display" ></center></td></tr></table>
<!--l. 63--><p class="nopar" >
Essentially this is saying that all things that are less than a key are to the left of it and all things
bigger are to the right. <a 
 id="Q1-1-151"></a>
<h4 class="likesubsectionHead"><a 
 id="x1-1170003"></a>Search A high fan-out search tree</h4>
<!--l. 67--><p class="noindent" >We do binary search for each page to know which pointer to follow then we go down to the next
level. We keep going down until we get to the leaf level. The complexity is: <tspan font-family="cmmi" font-size="12">O</tspan><tspan font-family="cmr" font-size="12">(</tspan><tspan font-family="cmmi" font-size="12">log</tspan><sub><tspan font-family="cmmi" font-size="8">F</tspan> </sub><tspan font-family="cmr" font-size="12">(#</tspan><tspan font-family="cmmi" font-size="12">Pages</tspan><tspan font-family="cmr" font-size="12">))</tspan>
where F is the fan-out of the node in the tree. <a 
 id="Q1-1-153"></a>
<h4 class="likesubsectionHead"><a 
 id="x1-1180003"></a>Left Key optimization</h4>
<!--l. 71--><p class="noindent" >We can drop the left most key because everything down the left most pointer is less than the split
key to the right and we don&#8217;t care how much less than so we can drop it to save space and give us
more room on each page for more entries. <a 
 id="Q1-1-155"></a>
<h4 class="likesubsectionHead"><a 
 id="x1-1190003"></a>Build a high fan-out search tree</h4>
<!--l. 75--><p class="noindent" >In the disk, it will be in one single file with the Data pages first, followed by the index pages with
the root first. <br 
class="newline" /><tspan font-family="ecbx" font-size="1200">Data pages </tspan>are the pages that contain the actual data. <br 
class="newline" /><tspan font-family="ecbx" font-size="1200">Index pages</tspan>: the pages that contain the indices. <a 
 id="Q1-1-157"></a>
<h4 class="likesubsectionHead"><a 
 id="x1-1200003"></a>Status check</h4>
<!--l. 80--><p class="noindent" >So far our file has fast sequential scan because our data is all in the beginning of the file so we can
access they quickly with no random I/O. We also have high fan out because we have keys and
pointers and each is very small so we can have a lot of them for each page and therefore
level.
<!--l. 84--><p class="indent" >    The current issue is that it does not really support insertion.
<!--l. 85--><p class="indent" >    ISAM: Indexed Sequential Access Method is the name of this data structure. <a 
 id="Q1-1-159"></a>
<h4 class="likesubsectionHead"><a 
 id="x1-1210003"></a>Insertion</h4>
<!--l. 87--><p class="noindent" >If we insert a value, if it is not the biggest item on that page, then we will have to resort the page
                                                                                         
                                                                                         
so that way that page is sorted. If we insert something and there is n space for it in that page,
then we will allocate <tspan font-family="ecbx" font-size="1200">overflow page</tspan>. We store pointers the overflow pages in the index
pages. Each index page will point to an overflow page and each overflow page can be
linked list of pages. This can cause degradation which would basically just become a
heap.
<a 
 id="x1-121001r109"></a>
<h4 class="subsectionHead"><span class="titlemark">5.3.1   </span> <a 
 id="x1-1220001"></a>recap: ISAM</h4>
      <ul class="itemize1">
      <li class="itemize">Data entries in sorted heap file
      </li>
      <li class="itemize">High fan-out static tree index
      </li>
      <li class="itemize">Fast search and good locality assuming nothing changes.
      </li>
      <li class="itemize">Insert into overflow pages which can cause the search be order of n.</li></ul>
<!--l. 100--><p class="noindent" >We will see that B+ trees are almost always better.
<a 
 id="x1-122001r147"></a>
<h3 class="sectionHead"><span class="titlemark">5.4   </span> <a 
 id="x1-1230004"></a>B+ Trees</h3>
<!--l. 102--><p class="noindent" >We have been looking at ISAM. B+ is similar to ISAM.
      <ul class="itemize1">
      <li class="itemize">It has same interior node structure: &#x003C;Key, page ptr&#x003E; pairs with same key invariant.
      </li>
      <li class="itemize">Same search routine as before but now there will be no overflow pages.</li></ul>
<!--l. 108--><p class="noindent" >This is a <tspan font-family="ecbx" font-size="1200">dynamic tree index </tspan>in which it is always balanced and supports efficient insertion
and deletion. This grows at root not leaves. And for us the data is all stored at the leaves.
There was a B- tree where the data was stored in interior nodes. <hr class="figure"><div class="figure" 
><a 
 id="x1-1230014"></a>
<br /> <div class="caption" 
><span class="id">Figure&#x00A0;5.4: </span><span  
class="content">Example of B+ tree</span></div><!--tex4ht:label?: x1-1230014 -->
<!--l. 115--><p class="indent" >    </div><hr class="endfigure">
<a 
 id="Q1-1-164"></a>
<h4 class="likesubsectionHead"><a 
 id="x1-1240004"></a>Occupancy Invariant</h4>
<!--l. 118--><p class="noindent" >This has an <tspan font-family="ecbx" font-size="1200">occupancy invariant </tspan>in which each interior node is at least half full except for the
root node.
      <ul class="itemize1">
      <li class="itemize">d &#x003C;= # entries &#x003C;= 2d (where 2d is the maximum number of nodes)
      </li>
      <li class="itemize">d is the order of the tree
      </li>
      <li class="itemize"><tspan font-family="ecbx" font-size="1200">max fan-out </tspan>= 2d + 1. The +1 comes from the leftmost pointer on the page.</li></ul>
                                                                                         
                                                                                         
<!--l. 126--><p class="noindent" >The data pages for B+ trees do not need to be stored in logical order. We have previous and next
pointers from each data page to the next.
<!--l. 128--><p class="indent" >    The pages are not in sequential order because we will be inserting values and so they might
not be in order. <a 
 id="Q1-1-166"></a>
<h4 class="likesubsectionHead"><a 
 id="x1-1250004"></a>B+ Trees in Practice</h4>
      <ul class="itemize1">
      <li class="itemize">Typical order is 1600 entries. The typical fill-factor is 67%.
      </li>
      <li class="itemize">Average fan-out 2144.
      </li>
      <li class="itemize">Assuming 128 kb pages at 40 bytes per second.</li></ul>
<a 
 id="x1-125001r161"></a>
<h4 class="subsectionHead"><span class="titlemark">5.4.1   </span> <a 
 id="x1-1260001"></a>Searching the B+ Tree</h4>
<a 
 id="x1-126001r162"></a>
<h3 class="sectionHead"><span class="titlemark">5.5   </span> <a 
 id="x1-1270005"></a>Inserting into B+ tree</h3>
<!--l. 138--><p class="noindent" >Refer to fig <a 
href="#x1-1270015">5.5<!--tex4ht:ref: insertion1 --></a> When you have a value you want to insert where that Data page is already full,
then you want to create a new leaf and redistribute the entries evenly. The convention is that if
there is an odd number of values, add the extra value to the new node. You then fix the
pointers. To fix the pointers, you need to create a new parent pointer for the newly
created node. That node will contain the index to the smallest value in that leaf. Now we
want to put that index entry into the parent of the original node. The problem for
this case is that the parent is full so we need to split the node. (when we split the root
node, we are going to allocate space for a new node in order to maintain having one
root node at all times). When we create a new node, we distribute the d+1 keys to
the new node. We then push up the <tspan font-family="ecbx" font-size="1200">smallest value on the right hand side </tspan>to the
root node. From fig <a 
href="#x1-1270026">5.6<!--tex4ht:ref: insertion2 --></a> We are going to push the rightmost smallest one up to the
root node. Unlike at the root level, we don&#8217;t copy the value up, we instead <tspan font-family="ecbx" font-size="1200">push </tspan>it up.
<hr class="figure"><div class="figure" 
>
                                                                                         
                                                                                         
<a 
 id="x1-1270015"></a>
                                                                                         
                                                                                         
<!--l. 154--><p class="noindent" >
<br /> <div class="caption" 
><span class="id">Figure&#x00A0;5.5: </span><span  
class="content">Create a new parent pointer for the newly created node</span></div><!--tex4ht:label?: x1-1270015 -->
                                                                                         
                                                                                         
<!--l. 157--><p class="indent" >    </div><hr class="endfigure">
<!--l. 158--><p class="indent" >    <hr class="figure"><div class="figure" 
>
                                                                                         
                                                                                         
<a 
 id="x1-1270026"></a>
                                                                                         
                                                                                         
<!--l. 160--><p class="noindent" >
<br /> <div class="caption" 
><span class="id">Figure&#x00A0;5.6: </span><span  
class="content">Create we push the 17 up because that is the smallest value on the rightmost
side</span></div><!--tex4ht:label?: x1-1270026 -->
                                                                                         
                                                                                         
<!--l. 163--><p class="indent" >    </div><hr class="endfigure">
<a 
 id="Q1-1-172"></a>
<h4 class="likesubsectionHead"><a 
 id="x1-1280005"></a>Check invariants</h4>
<!--l. 165--><p class="noindent" ><tspan font-family="ecbx" font-size="1200">Key invariant</tspan>: Everything on the right is bigger and everything left is smaller. <tspan font-family="ecbx" font-size="1200">Occupancy</tspan>
<tspan font-family="ecbx" font-size="1200">invariant</tspan>: Yes that is true because we see that everything has <tspan font-family="cmmi" font-size="12">&#x003E;</tspan><tspan font-family="cmr" font-size="12">= </tspan><tspan font-family="cmmi" font-size="12">d </tspan>and <tspan font-family="cmsy" font-size="10">&#x2264; </tspan><tspan font-family="cmr" font-size="12">2</tspan><tspan font-family="cmmi" font-size="12">d</tspan> <a 
 id="Q1-1-174"></a>
<h4 class="likesubsectionHead"><a 
 id="x1-1290005"></a>Copy up vs Push up</h4>
<!--l. 170--><p class="noindent" >The difference is that when splitting a <tspan font-family="ecbx" font-size="1200">leaf</tspan>, we will <tspan font-family="ecbx" font-size="1200">copy </tspan>the value into the index entry above. For
<tspan font-family="ecbx" font-size="1200">index</tspan>, entries, we instead <tspan font-family="ecbx" font-size="1200">push </tspan>the value up. We copy the value up because we mentioned earlier
that the leaves will always contain all the data.
<a 
 id="x1-129001r168"></a>
<h4 class="subsectionHead"><span class="titlemark">5.5.1   </span> <a 
 id="x1-1300001"></a>B+ Tree insert: Algorithm Sketch</h4>
      <dl class="enumerate"><dt class="enumerate">
   1. </dt><dd 
class="enumerate">Find the correct leaf L.
      </dd><dt class="enumerate">
   2. </dt><dd 
class="enumerate">Put data entry onto L
           <ul class="itemize1">
           <li class="itemize">If L has enough&#8217;s pace, done!
           </li>
           <li class="itemize">Else, must split L (into L and a new node L2)
               <ul class="itemize2">
               <li class="itemize">Redistribute entries evenly, copy up middle key (which is the smallest key on
               the right-hand side. Then insert index entry pointing to L2 into parent of L.</li></ul>
           </li></ul>
      </dd></dl>
<!--l. 188--><p class="noindent" >Step 2 can happen recursively so if the parent is full, we need to split the parent and so on. To split
the index node, instead of copying up, we push up the middle key. Whenever we split, we will
"grow" the tree. A root split will increase the height and increases the height by 1 when we bubble
all the way up and it is full.
<!--l. 192--><p class="indent" >    All paths from root to leaves are equal length <br 
class="newline" />https://www.cs.usfca.edu/&#x00A0;galles/visualization/BPlusTree.html <br 
class="newline" />Good website for B+ trees. They will fix the indices when they remove leftmost value in node but
that is unnecessary.
<a 
 id="x1-130003r169"></a>
<h3 class="sectionHead"><span class="titlemark">5.6   </span> <a 
 id="x1-1310006"></a>Deletion</h3>
<!--l. 197--><p class="noindent" >Most times, people don&#8217;t implement deletion. So <tspan font-family="ecbx" font-size="1200">occupancy invariant </tspan>often not enforced. We
just delete leaf entries and leave space. If the page becomes completely empty, we can delete the
page and the pages then the parent can become underfull but that is also OK. This still
guaranteed <tspan font-family="cmmi" font-size="12">log</tspan><sub><tspan font-family="cmmi" font-size="8">F</tspan> </sub>
<a 
 id="x1-131001r177"></a>
                                                                                         
                                                                                         
<h3 class="sectionHead"><span class="titlemark">5.7   </span> <a 
 id="x1-1320007"></a>Bulk Loading in B+ Tree</h3>
<!--l. 202--><p class="noindent" >Suppose we have a table with lots of records and you want to build a B+ tree on top of it. It would
be highly inefficient to insert each value one by one.
<!--l. 204--><p class="indent" >    We will constantly need to search from root. the leaves and the internal nodes will
usually be mostly half-empty so we wont get good space utilization. Finally, and most
importantly, because we ware inserting values in random order, we will be modifying
random pages and so we get <tspan font-family="ecbx" font-size="1200">poor cache efficiency </tspan>which would result in a lot of
I/O&#8217;s
<a 
 id="x1-132001r176"></a>
<h4 class="subsectionHead"><span class="titlemark">5.7.1   </span> <a 
 id="x1-1330001"></a>Smarter Bulk Loading</h4>
<!--l. 210--><p class="noindent" ><hr class="figure"><div class="figure" 
>
                                                                                         
                                                                                         
                                                                                         
                                                                                         
<!--l. 212--><p class="noindent" >
                                                                                         
                                                                                         
<!--l. 213--><p class="noindent" ></div><hr class="endfigure">
<!--l. 214--><p class="indent" >    <hr class="figure"><div class="figure" 
>
                                                                                         
                                                                                         
                                                                                         
                                                                                         
<!--l. 216--><p class="noindent" >
                                                                                         
                                                                                         
<!--l. 217--><p class="indent" >    </div><hr class="endfigure">
<!--l. 218--><p class="indent" >    <hr class="figure"><div class="figure" 
>
                                                                                         
                                                                                         
<a 
 id="x1-1330017"></a>
                                                                                         
                                                                                         
<!--l. 220--><p class="noindent" >
<br /> <div class="caption" 
><span class="id">Figure&#x00A0;5.7: </span><span  
class="content">We will split</span></div><!--tex4ht:label?: x1-1330017 -->
                                                                                         
                                                                                         
<!--l. 223--><p class="indent" >    </div><hr class="endfigure">
<!--l. 224--><p class="indent" >    The idea is that we <tspan font-family="ecbx" font-size="1200">sort </tspan>the input records by key we then start to create leaf pages and fill
them to whatever fill factor we would like (ie <img 
src="CS186Main18x.png" alt="3
4"  class="frac" align="middle">). When we get to that factor, we create a parent
that points to that leaf. When we finally add to the point that we need to split the current root, we
will split like what we do in fig <a 
href="#x1-1330017">5.7<!--tex4ht:ref: bulk3 --></a>. We maintain the <tspan font-family="ecbx" font-size="1200">occupancy invariant </tspan>in the left side but
we don&#8217;t on the right most side because we are still going to be inserting. The pages
on the left then will never be touched again so they will never be in the buffer pool
again.
<a 
 id="x1-133002r179"></a>
<h4 class="subsectionHead"><span class="titlemark">5.7.2   </span> <a 
 id="x1-1340002"></a>Summary of bulk loadings</h4>
<!--l. 232--><p class="noindent" >Doing multiple inserts is slow and we do not have sequential storage on leaves. With bulk loading,
we have fewer I/O&#8217;s because when we touch the page, it will already be likely on the buffer pool.
The leaves can also be stored sequentially and so the read on the disk will be much faster. Lastly,
we can control the "fill factor"
<a 
 id="x1-134001r178"></a>
<h3 class="sectionHead"><span class="titlemark">5.8   </span> <a 
 id="x1-1350008"></a>Summary</h3>
      <ul class="itemize1">
      <li class="itemize">ISAM is a static tree structure
           <ul class="itemize2">
           <li class="itemize">Only leaf pages modified so we can get overflow pages.
           </li>
           <li class="itemize">Overflow chains degrade performance unless size of data set and data distribution
           stay constant.</li></ul>
      </li>
      <li class="itemize">B+ Tree is dynamic structure
           <ul class="itemize2">
           <li class="itemize">Insert deletes have tree height balanced <tspan font-family="cmmi" font-size="12">log</tspan><sub><tspan font-family="cmmi" font-size="8">F</tspan> </sub><tspan font-family="cmmi" font-size="12">N </tspan>cost. Where F is fan out and N is
           the number records.
           </li>
           <li class="itemize">We have a high fanout so depth is rarely more than 3 or 4.
           </li>
           <li class="itemize">Almost always better than maintaining a sorted file.
           </li>
           <li class="itemize">In practice, after many insert and deletes, B+ trees are usually 67% full.
           </li>
           <li class="itemize">thus they are almost always preferable to ISAM.</li></ul>
      </li></ul>
                                                                                         
                                                                                         
    <h2 class="chapterHead"><span class="titlemark">Chapter&#x00A0;6</span><br /><a 
 id="x1-1360006"></a>Refinements on Indexes and B+ Trees</h2>
<!--l. 257--><p class="noindent" >Issues to consider n any index structure:
      <ul class="itemize1">
      <li class="itemize">Query support: what kind of queries does the index allow
      </li>
      <li class="itemize">Choice of search key: This will affect the queries for which we can use an index
      </li>
      <li class="itemize">Data entry Storage, how we store the actual data that is being indexed. This affects
      performance.
      </li>
      <li class="itemize">Variable length key tricks. This also affects performance.
      </li>
      <li class="itemize">Look at cost model for indexes and compare with sorted and heaps.</li></ul>
<a 
 id="x1-136001r182"></a>
<h3 class="sectionHead"><span class="titlemark">6.1   </span> <a 
 id="x1-1370001"></a>Query Support</h3>
<a 
 id="Q1-1-185"></a>
<h4 class="likesubsectionHead"><a 
 id="x1-1380001"></a>Indexes: basic selection</h4>
<!--l. 268--><p class="noindent" >Usually indexes have <tspan font-family="ecbx" font-size="1200">basic selection</tspan>: &#x003C;key&#x003E; &#x003C;op&#x003E; &#x003C;constant&#x003E;.
<!--l. 269--><p class="indent" >    There are equality (=) selection sand range selections (&#x003C;, &#x003E; , &#x003C;=, &#x003E;=, BETWEEEN) B+
trees support both equality and range selection. <a 
 id="Q1-1-187"></a>
<h4 class="likesubsectionHead"><a 
 id="x1-1390001"></a>Indexes: other selections</h4>
<!--l. 272--><p class="noindent" >There are more exotic selections:
      <ul class="itemize1">
      <li class="itemize">There are ones for 2-d box (map boundaries) or 2-d circle ("within 2 mile of Empire
      State Building").
      </li>
      <li class="itemize">There  is  also  the  <tspan font-family="ecbx" font-size="1200">n-dimensional  indexes  </tspan>that  support  queries  across  multiple
      dimensions.  Examples  are  R-tree  and  KD-tree.  However,  there  is  the  <tspan font-family="ecbx" font-size="1200">curse  of</tspan>
      <tspan font-family="ecbx" font-size="1200">dimensionality </tspan>where as you go up in the number of dimensions, it becomes harder
      to separate out the points.
      </li>
      <li class="itemize">Near-neighbor  queries  (10  restaurants  closest  to  empire  state  building).  These  are
      dependent on data.</li></ul>
<!--l. 283--><p class="noindent" >We are going to focus on traditional 1-d range search.
<a 
 id="x1-139001r184"></a>
<h3 class="sectionHead"><span class="titlemark">6.2   </span> <a 
 id="x1-1400002"></a>Search Key and Ordering</h3>
<!--l. 285--><p class="noindent" >in an ordered index, (e.g B+ tree) we order data in <tspan font-family="ecbx" font-size="1200">lexicographical </tspan>ordering by the search key
columns. The order in which you specify the search key does matter. <div class="newtheorem">
                                                                                         
                                                                                         
<!--l. 287--><p class="noindent" ><span class="head">
<tspan font-family="ecbx" font-size="1200">Definition</tspan><tspan font-family="ecbx" font-size="1200">&#x00A0;6.1</tspan> </span><tspan font-family="ecbi" font-size="1200">Composite Search Key </tspan><tspan font-family="ecti" font-size="1200">on columns </tspan><tspan font-family="cmr" font-size="12">(</tspan><tspan font-family="cmmi" font-size="12">k</tspan><sub><tspan font-family="cmr" font-size="8">1</tspan></sub><tspan font-family="cmmi" font-size="12">,k</tspan><sub><tspan font-family="cmr" font-size="8">2</tspan></sub><tspan font-family="cmmi" font-size="12">,...,k</tspan><sub><tspan font-family="cmmi" font-size="8">n</tspan></sub><tspan font-family="cmr" font-size="12">) </tspan><tspan font-family="ecti" font-size="1200">"matches" a query if:</tspan>
<tspan font-family="ecti" font-size="1200">(1) the query is a conjunction of m &#x003E;= 0 equality clauses of the form:</tspan>
    <center class="math-display" >
<img 
src="CS186Main19x.png" alt="k1 = &#x003C; val1 &#x003E; AN Dk2  = &#x003C; val2 &#x003E; AN  D..AN Dkm   =&#x003C;  valm &#x003E;
" class="math-display" ></center> <tspan font-family="ecti" font-size="1200">and (2) at most 1 additional range clause of the form:</tspan>
    <center class="math-display" >
<img 
src="CS186Main20x.png" alt="AN  Dkm+1op   &#x003C; val &#x003E;,where  op is one of{&#x003C;, &#x003E; }
" class="math-display" ></center>
    </div>
<!--l. 294--><p class="indent" >    This "matches" because the query is looking thing sup and scanning in lexicographic order
and so we do an equality lookup on the firs tm equality predicates to find the start of the range
and then we can do a scan on the things that are tied for the first m predicates on the first m+1st
predicate from lowest ot highest so we scan all the things in the m+1st predicate. If
there is no m+1st predicate, we sca the entire set of matches to the first m conjuncts. <a 
 id="likesection.5"></a><a 
 id="x1-140002"></a><object data="CS186Main-13.svg" width="1.0 " height="2.33333 " type="image/svg+xml"><p>SVG-Viewer needed.</p></object>
<span class="marginpar"><object data="CS186Main-14.svg" width="76.20702 " height="61.19153 " type="image/svg+xml"><p>SVG-Viewer needed.</p></object>
<object data="CS186Main-15.svg" width="1.0 " height="2.33333 " type="image/svg+xml"><p>SVG-Viewer needed.</p></object>
</span>
<a 
 id="x1-140003r189"></a>
<h3 class="sectionHead"><span class="titlemark">6.3   </span> <a 
 id="x1-1410003"></a>Data Entry Staorge</h3>
<!--l. 302--><p class="noindent" >We want to know what the <tspan font-family="ecbx" font-size="1200">representation </tspan>of the data in the index. Is it actual data or
pointer to the data? Also, we want to know how the data is <tspan font-family="ecbx" font-size="1200">stored </tspan>in the data file. Is
it <tspan font-family="ecbx" font-size="1200">clustered </tspan>or <tspan font-family="ecbx" font-size="1200">unclustered </tspan>with respect to the index. Both have a big <tspan font-family="ecbx" font-size="1200">impact </tspan>on
performance.
<a 
 id="x1-141001r181"></a>
                                                                                         
                                                                                         
<h4 class="subsectionHead"><span class="titlemark">6.3.1   </span> <a 
 id="x1-1420001"></a>Three basic alternatives for data entries in any index</h4>
      <dl class="enumerate"><dt class="enumerate">
   1. </dt><dd 
class="enumerate">Alternative 1: by value
      </dd><dt class="enumerate">
   2. </dt><dd 
class="enumerate">Alternative 2: By reference
      </dd><dt class="enumerate">
   3. </dt><dd 
class="enumerate">Alternative 3: BY list of references.</dd></dl>
<!--l. 312--><p class="noindent" >These apply to any index but we will look at it in terms of B trees.
<a 
 id="x1-142004r191"></a>
<h4 class="subsectionHead"><span class="titlemark">6.3.2   </span> <a 
 id="x1-1430002"></a>Alternative 1 Index (B+ Tree)</h4>
<!--l. 314--><p class="noindent" >Record contents are stored in the index file. We do not need to store the data anywhere else
because they are already stored in the leaves.
<a 
 id="x1-143001r192"></a>
<h4 class="subsectionHead"><span class="titlemark">6.3.3   </span> <a 
 id="x1-1440003"></a>Alternative 2 Index</h4>
<!--l. 317--><p class="noindent" >The other option is to use <tspan font-family="ecbx" font-size="1200">by reference</tspan>. &#x003C;K, rid of matching data record&#x003E;
<!--l. 318--><p class="indent" >    We will have a key K, and the record id of the matching data record. The record id is
something like &#x003C;page id, slot id&#x003E;.
<a 
 id="x1-144001r193"></a>
<h4 class="subsectionHead"><span class="titlemark">6.3.4   </span> <a 
 id="x1-1450004"></a>Alternative 3 Index</h4>
<!--l. 321--><p class="noindent" >It is essentially a compressed version of Alternative 2. We are storing: (Key, {list fo record id})
Pairs. This is useful if you have many duplicates per key. The record id list can get pretty long so
you need to come up with a leaf level representation that accounts for the long record
ids.
<a 
 id="x1-145001r194"></a>
<h4 class="subsectionHead"><span class="titlemark">6.3.5   </span> <a 
 id="x1-1460005"></a>Indexing By reference</h4>
<!--l. 326--><p class="noindent" >Both Alt 2 and Alt 3 data by <tspan font-family="ecti" font-size="1200">reference</tspan>. By <tspan font-family="ecti" font-size="1200">reference </tspan>is required to support multiple
indexes per table (ie if you want one index on the salary column and another index on
the name).You need at least one index that is by reference, Otherwise, you would be
replicating the entire tuple which would increase the complexity when doing updates. <a 
 id="likesection.6"></a><a 
 id="x1-146001"></a><object data="CS186Main-16.svg" width="1.0 " height="2.33333 " type="image/svg+xml"><p>SVG-Viewer needed.</p></object>
<span class="marginpar"><object data="CS186Main-17.svg" width="76.20702 " height="101.03871 " type="image/svg+xml"><p>SVG-Viewer needed.</p></object>
<object data="CS186Main-18.svg" width="1.0 " height="2.33333 " type="image/svg+xml"><p>SVG-Viewer needed.</p></object>
</span>
<a 
 id="x1-146002r190"></a>
<h3 class="sectionHead"><span class="titlemark">6.4   </span> <a 
 id="x1-1470004"></a>Clustered vs. Unclustered Index</h3>
<!--l. 333--><p class="noindent" >Only ALt 2 and Alt 3 can be clustered or unclustered. This is a really a property of the heap file
associated with the index. <br 
class="newline" />Clustered index: heap file records are kept mostly ordered according to <tspan font-family="ecbx" font-size="1200">search keys </tspan>in index. The
cost varies greatly depending on whether or not the index is clustered.
<a 
 id="x1-147001r196"></a>
<h3 class="sectionHead"><span class="titlemark">6.5   </span> <a 
 id="x1-1480005"></a>Clustered vs Unclustered index Visualization</h3>
<!--l. 338--><p class="noindent" >To build a clustered index, first sort the heap file and leave some free space on each block for
future inserts. Index entries direct search to take us to data entries in the heap file.
<hr class="figure"><div class="figure" 
>
                                                                                         
                                                                                         
<a 
 id="x1-1480011"></a>
                                                                                         
                                                                                         
<!--l. 343--><p class="noindent" >
<br /> <div class="caption" 
><span class="id">Figure&#x00A0;6.1: </span><span  
class="content">Clustered vs Unclustered</span></div><!--tex4ht:label?: x1-1480011 -->
                                                                                         
                                                                                         
<!--l. 346--><p class="indent" >    </div><hr class="endfigure">
<!--l. 347--><p class="indent" >    From fig <a 
href="#x1-1480011">6.1<!--tex4ht:ref: clustered --></a> the dotted line is the divider between the index and the heap file. The things
below the line are in the heap file. All the pointers for clustered are pointing to things that are
sequential. Thus, it takes more files to satisfy a query on the first two index pages. Clustered index
gives us good bang for buck for each I/O.
<a 
 id="x1-148002r195"></a>
<h4 class="subsectionHead"><span class="titlemark">6.5.1   </span> <a 
 id="x1-1490001"></a>Insertion into Clustered</h4>
<!--l. 352--><p class="noindent" >Remember the index does not have to be perfectly sorted file. When you add a value, it looks
through and finds the pointer to the page, if that page is full, then it will create another page and
then add pointer to that page. Eventually, the clustering will break down. You can recluster by
resorting the heap file in the order of the index and storing it back on disk in sorted
order.
<!--l. 357--><p class="indent" >    So in the beginning, the performance is good with sequential read but as you add more tings
in, the performance degrades.
<a 
 id="x1-149001r199"></a>
<h4 class="subsectionHead"><span class="titlemark">6.5.2   </span> <a 
 id="x1-1500002"></a>Summary</h4>
      <ul class="itemize1">
      <li class="itemize">Clustered index pros
           <ul class="itemize2">
           <li class="itemize">Efficient for range searches. It is when you are looking at mulitple pointers when
           you get the benefit of clustering.
           </li>
           <li class="itemize">Potential locality benefits. The heap file accesses are sequential and so you can
           use prefetching.
           </li>
           <li class="itemize">Alos support certain types of compression.</li></ul>
      </li>
      <li class="itemize">Clustered index cons
           <ul class="itemize2">
           <li class="itemize">More expensive to maintain. Needs periodically update heap file order. A solution
           is to "lazily" sort. So background task just reorder things close by.
           </li>
           <li class="itemize">If you want it to wrok well, keep the heap file around <img 
src="CS186Main21x.png" alt="2
3"  class="frac" align="middle"> packed.</li></ul>
      </li></ul>
<a 
 id="x1-150001r197"></a>
<h3 class="sectionHead"><span class="titlemark">6.6   </span> <a 
 id="x1-1510006"></a>B+ tree refinement: variable-length keys</h3>
<!--l. 379--><p class="noindent" >We have been using integer keys but you might want to use variable length keys. <hr class="figure"><div class="figure" 
>
                                                                                         
                                                                                         
<a 
 id="x1-1510012"></a>
                                                                                         
                                                                                         
<!--l. 382--><p class="noindent" >
<br /> <div class="caption" 
><span class="id">Figure&#x00A0;6.2: </span><span  
class="content">Fixed length keys</span></div><!--tex4ht:label?: x1-1510012 -->
                                                                                         
                                                                                         
<!--l. 384--><p class="indent" >    </div><hr class="endfigure">
<!--l. 385--><p class="indent" >    <hr class="figure"><div class="figure" 
>
                                                                                         
                                                                                         
<a 
 id="x1-1510023"></a>
                                                                                         
                                                                                         
<!--l. 387--><p class="noindent" >
<br /> <div class="caption" 
><span class="id">Figure&#x00A0;6.3: </span><span  
class="content">Variable length keys</span></div><!--tex4ht:label?: x1-1510023 -->
                                                                                         
                                                                                         
<!--l. 389--><p class="indent" >    </div><hr class="endfigure">
<a 
 id="x1-151003r200"></a>
<h4 class="subsectionHead"><span class="titlemark">6.6.1   </span> <a 
 id="x1-1520001"></a>Redefine Occupancy Invariant</h4>
<!--l. 391--><p class="noindent" >Our previous definition of Order(d) makes little sense because the lengths of the keys would affect
how many entries could be stored. <tspan font-family="ecbx" font-size="1200">Index pages </tspan>often hold many <tspan font-family="ecbx" font-size="1200">more entries </tspan>than leaf pages.
This is true even with fixed length fields because of <tspan font-family="ecbx" font-size="1200">Alternative 3</tspan>. In Alt 3, there could be some
keys with longer list of matching ids.
<!--l. 396--><p class="indent" >    We will thus talk about occupancy in terms of <tspan font-family="ecbx" font-size="1200">bytes</tspan>. <a 
 id="Q1-1-205"></a>
<h4 class="likesubsectionHead"><a 
 id="x1-1530001"></a>Prefix Compress keys?</h4>
<!--l. 398--><p class="noindent" >How to get more index entries on a page. The more index entries, the more fan out we could have
lower depth. <hr class="figure"><div class="figure" 
>
                                                                                         
                                                                                         
<a 
 id="x1-1530014"></a>
                                                                                         
                                                                                         
<!--l. 402--><p class="noindent" >
<br /> <div class="caption" 
><span class="id">Figure&#x00A0;6.4: </span><span  
class="content">Precompression</span></div><!--tex4ht:label?: x1-1530014 -->
                                                                                         
                                                                                         
<!--l. 405--><p class="indent" >    </div><hr class="endfigure">
<!--l. 406--><p class="indent" >    <hr class="figure"><div class="figure" 
>
                                                                                         
                                                                                         
<a 
 id="x1-1530025"></a>
                                                                                         
                                                                                         
<!--l. 408--><p class="noindent" >
<br /> <div class="caption" 
><span class="id">Figure&#x00A0;6.5: </span><span  
class="content">After compessing</span></div><!--tex4ht:label?: x1-1530025 -->
                                                                                         
                                                                                         
<!--l. 411--><p class="indent" >    </div><hr class="endfigure">
<!--l. 412--><p class="indent" >    Ex: for David Jones, in fig <a 
href="#x1-1530014">6.4<!--tex4ht:ref: compress --></a>, David JOnes would end up between Davey Jones and Davis
Yu. In the compressed state in fig <a 
href="#x1-1530025">6.5<!--tex4ht:ref: compress1 --></a>, Davis Jones would end up between Davi and Di. But
this does not matter, as long as the B+ tree is correct and has high fan out we don&#8217;t
care.
<a 
 id="x1-153003r204"></a>
<h4 class="subsectionHead"><span class="titlemark">6.6.2   </span> <a 
 id="x1-1540002"></a>Prefix Key compression</h4>
<!--l. 417--><p class="noindent" >We do prefix key compression during page split at the leaf level. <hr class="figure"><div class="figure" 
>
                                                                                         
                                                                                         
<a 
 id="x1-1540016"></a>
                                                                                         
                                                                                         
<!--l. 420--><p class="noindent" >
<br /> <div class="caption" 
><span class="id">Figure&#x00A0;6.6: </span><span  
class="content">Add Sarah lee</span></div><!--tex4ht:label?: x1-1540016 -->
                                                                                         
                                                                                         
<!--l. 422--><p class="indent" >    </div><hr class="endfigure">
<!--l. 423--><p class="indent" >    <hr class="figure"><div class="figure" 
>
                                                                                         
                                                                                         
<a 
 id="x1-1540027"></a>
                                                                                         
                                                                                         
<!--l. 425--><p class="noindent" >
<br /> <div class="caption" 
><span class="id">Figure&#x00A0;6.7: </span><span  
class="content">After adding and splitting</span></div><!--tex4ht:label?: x1-1540027 -->
                                                                                         
                                                                                         
<!--l. 427--><p class="indent" >    </div><hr class="endfigure">
<!--l. 428--><p class="indent" >    We split, then we take Sarah Zhu and see that we can compress to "Sarah Z" so it is still
distinguished from the other two names on the left side.
<a 
 id="x1-154003r209"></a>
<h4 class="subsectionHead"><span class="titlemark">6.6.3   </span> <a 
 id="x1-1550003"></a>Suffice Key Compression</h4>
<!--l. 431--><p class="noindent" >We move common prefix to header and leave only (compressed) suffice next to pointer. During
comparisons, we will then reconstruct the full key by reconstructing the prefix to the
keys.
<!--l. 434--><p class="indent" >    This is especially useful for <tspan font-family="ecbx" font-size="1200">composite keys</tspan>: &#x003C;Zip code, Last Name, First Name&#x003E;. They
have columns where they are all likely the same then you can just compress the one that is all
similar. Like for this example, compress zip code.
                                                                                         
                                                                                         
                                                                                         
                                                                                         
                                                                                         
                                                                                         
    <h2 class="chapterHead"><span class="titlemark">Chapter&#x00A0;7</span><br /><a 
 id="x1-1560007"></a>Module 4</h2>
<!--l. 2--><p class="noindent" ><hr class="figure"><div class="figure" 
>
                                                                                         
                                                                                         
                                                                                         
                                                                                         
<!--l. 4--><p class="noindent" >
                                                                                         
                                                                                         
<!--l. 5--><p class="noindent" ></div><hr class="endfigure">
<!--l. 6--><p class="indent" >    We started with the SQL client then went into the internals starting at the DBMS and
then looked at Files and Index Management. We will not talk abut the middle part
which is the Buffer manager. The Files and Index Management is built to be used by
RAM while the Disk Space Management is made for use by the DISK. The <tspan font-family="ecbx" font-size="1200">buffer</tspan>
<tspan font-family="ecbx" font-size="1200">management </tspan>is the middle ground between the two that provides the abstractions between the
two.
<!--l. 11--><p class="indent" >    <tspan font-family="ecbx" font-size="1200">Buffer Manager </tspan>can be thought of as the thing that manages the <tspan font-family="ecbx" font-size="1200">buffer pool </tspan>inside the
Ram which is a set of page sized extense in memory called <tspan font-family="ecbx" font-size="1200">frames</tspan>. It is the job of the <tspan font-family="ecbx" font-size="1200">buffer</tspan>
<tspan font-family="ecbx" font-size="1200">manager </tspan>to give the illusion that it is addressing and modifying disk pages that exist in ram
but it actually moves pages from the disk in and out of the frame in the buffer pool.
<div class="newtheorem">
<!--l. 16--><p class="noindent" ><span class="head">
<tspan font-family="ecbx" font-size="1200">Definition</tspan><tspan font-family="ecbx" font-size="1200">&#x00A0;7.1</tspan> </span><tspan font-family="ecbi" font-size="1200">frames</tspan><tspan font-family="ecti" font-size="1200">: page sized blocks inside RAM that hold an individual page.</tspan>
    </div>
<div class="newtheorem">
<!--l. 19--><p class="noindent" ><span class="head">
<tspan font-family="ecbx" font-size="1200">Definition</tspan><tspan font-family="ecbx" font-size="1200">&#x00A0;7.2</tspan> </span><tspan font-family="ecbi" font-size="1200">buffer pool</tspan><tspan font-family="ecti" font-size="1200">: thing inside ram that holds </tspan><tspan font-family="ecbi" font-size="1200">frames</tspan>
    </div>
    <div class="newtheorem">
<!--l. 23--><p class="noindent" ><span class="head">
<tspan font-family="ecbx" font-size="1200">Definition</tspan><tspan font-family="ecbx" font-size="1200">&#x00A0;7.3</tspan> </span><tspan font-family="ecbi" font-size="1200">buffer  pool</tspan><tspan font-family="ecti" font-size="1200">:  an  area  of  main  memory  that  has  been  allocated  by  the</tspan>
<tspan font-family="ecti" font-size="1200">database manager for the purpose of caching table an index data as it is read from disk.</tspan>
    </div>
<!--l. 27--><p class="indent" >    An example is that a message request comes into the buffer manager to read a page from the
disk. That page is not in the buffer pool so the buffer manager passes the API request onto the
DISK and then passes that page onto an empty frame. Now the page can be manipulated in the
buffer pool. Now if someone wants to access the same page again, since it is already in RAM, it
does not need to involve the DSM at all and it can just return a pointer to the location of the page
in RAM.
<a 
 id="x1-156004r201"></a>
<h3 class="sectionHead"><span class="titlemark">7.1   </span> <a 
 id="x1-1570001"></a>Dirty Pages</h3>
<!--l. 34--><p class="noindent" >How do we handle <tspan font-family="ecbx" font-size="1200">dirty pages </tspan>in which pages where updates have occurred in ram. Also, how do
we do page replacements when we want to access pages not currently in the buffer pool while the
buffer pool is already full.
<a 
 id="x1-157001r212"></a>
                                                                                         
                                                                                         
<h4 class="subsectionHead"><span class="titlemark">7.1.1   </span> <a 
 id="x1-1580001"></a>Handling Dirty Pages</h4>
<!--l. 38--><p class="noindent" >We need to first figure out how how the buffer manager will find out that the page is dirty. When
you modify a page in buffer pool, we need to tell the Buffer manager that a page has been modified
using a bit associated with each frame that tells which frames are dirty. Once we write, we need to
write back via the disk manager.
<!--l. 42--><p class="indent" >    There are two other issues we need to figure out we wont ask today.
      <ul class="itemize1">
      <li class="itemize">Concurrent operations on a page: use Concurrency Control Module
      </li>
      <li class="itemize">System crash before we write back to the disk: use Recovery module.</li></ul>
<a 
 id="x1-158001r215"></a>
<h4 class="subsectionHead"><span class="titlemark">7.1.2   </span> <a 
 id="x1-1590002"></a>Buffer manager States</h4>
<!--l. 48--><p class="noindent" >When the DB system starts up, it mallocs big range of memory to serve as the buffer pool and
then thinks of the memory as in page size units called frames.
<!--l. 50--><p class="indent" >    There will also be <tspan font-family="ecbx" font-size="1200">metadata </tspan>that is information about the what is currently in the buffer
pool. We malloc this space when it starts. The data structure will be indexed by the PageId so we
can quickly figure out which page is in which frame on RAM. <hr class="figure"><div class="figure" 
>
                                                                                         
                                                                                         
<a 
 id="x1-1590011"></a>
                                                                                         
                                                                                         
<!--l. 56--><p class="noindent" >
<br /> <div class="caption" 
><span class="id">Figure&#x00A0;7.1: </span><span  
class="content">metadata in the ram stored as hash table </span></div><!--tex4ht:label?: x1-1590011 -->
                                                                                         
                                                                                         
<!--l. 58--><p class="indent" >    </div><hr class="endfigure">
<!--l. 59--><p class="indent" >    <hr class="figure"><div class="figure" 
>
                                                                                         
                                                                                         
<a 
 id="x1-1590022"></a>
                                                                                         
                                                                                         
<!--l. 61--><p class="noindent" >
<br /> <div class="caption" 
><span class="id">Figure&#x00A0;7.2: </span><span  
class="content">Illustration of buffer pool</span></div><!--tex4ht:label?: x1-1590022 -->
                                                                                         
                                                                                         
<!--l. 63--><p class="indent" >    </div><hr class="endfigure">
<!--l. 64--><p class="indent" >    In fig&#x00A0;<a 
href="#x1-1590022">7.2<!--tex4ht:ref: bufferpoolillustration --></a> we use the thumbtack to represent the number of pins and then the squiggly line to
represent if it is dirty or not.
<a 
 id="x1-159003r214"></a>
<h3 class="sectionHead"><span class="titlemark">7.2   </span> <a 
 id="x1-1600002"></a>Page Replacement Terminology</h3>
    <div class="newtheorem">
<!--l. 67--><p class="noindent" ><span class="head">
<tspan font-family="ecbx" font-size="1200">Definition</tspan><tspan font-family="ecbx" font-size="1200">&#x00A0;7.4</tspan> </span><tspan font-family="ecbi" font-size="1200">page pin count</tspan><tspan font-family="ecti" font-size="1200">: count that tells the buffer manager how many queries</tspan>
<tspan font-family="ecti" font-size="1200">want to work with the page</tspan>
    </div>
<div class="newtheorem">
<!--l. 71--><p class="noindent" ><span class="head">
<tspan font-family="ecbx" font-size="1200">Definition</tspan><tspan font-family="ecbx" font-size="1200">&#x00A0;7.5</tspan> </span><tspan font-family="ecbi" font-size="1200">page replacement policy</tspan><tspan font-family="ecti" font-size="1200">: if the buffer manager is full, what page should</tspan>
<tspan font-family="ecti" font-size="1200">be replaced?</tspan>
    </div>
<a 
 id="x1-160003r219"></a>
<h3 class="sectionHead"><span class="titlemark">7.3   </span> <a 
 id="x1-1610003"></a>Life cycle of page</h3>
<!--l. 76--><p class="noindent" >When a page is requested, if the page is not in buffer pool:
      <ul class="itemize1">
      <li class="itemize">Choose an <tspan font-family="ecbx" font-size="1200">un-pinned </tspan>(pin_count = 0) frame for replacement
      </li>
      <li class="itemize">If frame "dirty", write current page to disk, mark "clean"
      </li>
      <li class="itemize">Read requested page into frame, overriding the page that was previously page
      </li>
      <li class="itemize">Pin the page so we know the requester is working with the page and then return pointer
      to the requester.</li></ul>
<!--l. 84--><p class="indent" >    If we can predict (eg sequential scans) then we can pre-fetch them and read several pages in at
a time. Each page read in will follow the above rules. <a 
 id="Q1-1-221"></a>
<h5 class="likesubsubsectionHead"><a 
 id="x1-1620003"></a>After Requester Finishes</h5>
<!--l. 87--><p class="noindent" >Requester of page must first set dirty bit if page was modified, then after, the requester must unpin
the page. Preferably sooner so that frame can be used again. If the frames all fill up, then no new
tasks can ensue.
<!--l. 90--><p class="indent" >    Page in pool may be requested many times so we keep a <tspan font-family="ecbx" font-size="1200">pin count</tspan>. A page is a candidate for
replacement iff the pin count == 0.
<!--l. 92--><p class="indent" >    CC &amp; recovery may do additional I/O but more later.
<!--l. 93--><p class="indent" >    Dirty pages will only be written back to the disk manager at replacement time.
                                                                                         
                                                                                         
<a 
 id="x1-162001r220"></a>
<h3 class="sectionHead"><span class="titlemark">7.4   </span> <a 
 id="x1-1630004"></a>Page Replacement Policy</h3>
<!--l. 95--><p class="noindent" >There are a few <tspan font-family="ecbx" font-size="1200">replacement policies</tspan>:
      <ul class="itemize1">
      <li class="itemize">Least-recently-used (LRU), clock
      </li>
      <li class="itemize">Most-recently-used (MRU)</li></ul>
<!--l. 100--><p class="noindent" >Policy can have a big impact on the number of I/O. The best option depends on the <tspan font-family="ecbx" font-size="1200">access pattern</tspan>
(the work that your system supports).
<a 
 id="x1-163001r216"></a>
<h4 class="subsectionHead"><span class="titlemark">7.4.1   </span> <a 
 id="x1-1640001"></a>LRU Replacement Policy</h4>
<!--l. 103--><p class="noindent" >This is very common. Pinned frame is never available to replace. LRU will add one column to the
metadata state, a <tspan font-family="ectt" font-size="1200">Last Used </tspan>column. It tracks the time when the time when each frame was last
used, meaning when it was last unpinned. We will replace the frame (with the lowest number)
which was the least recently used.
<!--l. 107--><p class="indent" >    LRU is used commonly. This is is good for repeated access to popular pages (<tspan font-family="ecbx" font-size="1200">temporal</tspan>
<tspan font-family="ecbx" font-size="1200">locality</tspan>). One of the objections is that this could have high CPU cost. This is because we you
have to scan through the pages, even using binary search it would still take <tspan font-family="cmmi" font-size="12">O</tspan><tspan font-family="cmr" font-size="12">(</tspan><tspan font-family="cmmi" font-size="12">logn</tspan><tspan font-family="cmr" font-size="12">) </tspan>time. We want
constant time. We will look at <tspan font-family="ecbx" font-size="1200">clock </tspan>which is an approximation.
<a 
 id="x1-164001r224"></a>
<h4 class="subsectionHead"><span class="titlemark">7.4.2   </span> <a 
 id="x1-1650002"></a>CLOCK algorithm</h4>
<!--l. 113--><p class="noindent" >Imagine frames in buffer are laid out in a circle with a clock hand that points to the
next page to consider for replacement. The clock will go around frame by frame as the
policy runs. There is on extra piece of metadata (<tspan font-family="ecbx" font-size="1200">reference bits</tspan>) that marks recently
referenced pages so they give a "second chance" to get referenced before being replaced.
<hr class="figure"><div class="figure" 
>
                                                                                         
                                                                                         
<a 
 id="x1-1650013"></a>
                                                                                         
                                                                                         
<!--l. 120--><p class="noindent" >
<br /> <div class="caption" 
><span class="id">Figure&#x00A0;7.3: </span><span  
class="content">Representation of Clock</span></div><!--tex4ht:label?: x1-1650013 -->
                                                                                         
                                                                                         
<!--l. 122--><p class="indent" >    </div><hr class="endfigure">
<!--l. 123--><p class="indent" >    The <tspan font-family="ecbx" font-size="1200">clock hand </tspan>is in our metadata that tells us which frame we are currently pointing to. For
each frame, it has a reference bit telling if it is on or off. <hr class="figure"><div class="figure" 
>
                                                                                         
                                                                                         
                                                                                         
                                                                                         
<!--l. 128--><p class="noindent" >
                                                                                         
                                                                                         
<!--l. 129--><p class="indent" >    </div><hr class="endfigure">
<img 
src="CS186Main22x.png" alt="picture" >
<!--l. 148--><p class="indent" >    <hr class="figure"><div class="figure" 
>
                                                                                         
                                                                                         
<a 
 id="x1-1650024"></a>
                                                                                         
                                                                                         
<!--l. 150--><p class="noindent" >
<br /> <div class="caption" 
><span class="id">Figure&#x00A0;7.4: </span><span  
class="content">Pseudocode for Clock algorithm</span></div><!--tex4ht:label?: x1-1650024 -->
                                                                                         
                                                                                         
<!--l. 152--><p class="indent" >    </div><hr class="endfigure">
<a 
 id="x1-165003r225"></a>
<h4 class="subsectionHead"><span class="titlemark">7.4.3   </span> <a 
 id="x1-1660003"></a>Is LRU/Clock always best?</h4>
<!--l. 154--><p class="noindent" >They are both very common, work well for repeated accesses due to temporal locality. LRU can be
costly but Clock policy is cheap. They are otherwise quite similar. <a 
 id="Q1-1-229"></a>
<h5 class="likesubsubsectionHead"><a 
 id="x1-1670003"></a>When do they perform poorly?</h5>
<!--l. 158--><p class="noindent" >They will perform poorly on repeated scans and large files.
<a 
 id="x1-167001r228"></a>
<h4 class="subsectionHead"><span class="titlemark">7.4.4   </span> <a 
 id="x1-1680004"></a>Repeated Scans (LRU)</h4>
    <div class="newtheorem">
<!--l. 160--><p class="noindent" ><span class="head">
<tspan font-family="ecbx" font-size="1200">Definition</tspan><tspan font-family="ecbx" font-size="1200">&#x00A0;7.6</tspan> </span><tspan font-family="ecbi" font-size="1200">cache hit</tspan><tspan font-family="ecti" font-size="1200">: how often we get a page request and the page is already in the</tspan>
<tspan font-family="ecti" font-size="1200">buffer pool.</tspan>
    </div>
<!--l. 164--><p class="noindent" >Repeated scans could be bad because in worst case, each read it just so happens to have just
evicted the file you wanted to read in. <hr class="figure"><div class="figure" 
>
                                                                                         
                                                                                         
<a 
 id="x1-1680025"></a>
                                                                                         
                                                                                         
<!--l. 168--><p class="noindent" >
<br /> <div class="caption" 
><span class="id">Figure&#x00A0;7.5: </span><span  
class="content">Worst Case LRU repeated scans</span></div><!--tex4ht:label?: x1-1680025 -->
                                                                                         
                                                                                         
<!--l. 170--><p class="indent" >    </div><hr class="endfigure">
    <div class="table">
                                                                                         
                                                                                         
<!--l. 171--><p class="indent" >    <hr class="float"><div class="float" 
>
                                                                                         
                                                                                         
<div class="tabular"> <table id="TBL-9" class="tabular" 
cellspacing="0" cellpadding="0"  
><colgroup id="TBL-9-1g"><col 
id="TBL-9-1"></colgroup><colgroup id="TBL-9-2g"><col 
id="TBL-9-2"></colgroup><colgroup id="TBL-9-3g"><col 
id="TBL-9-3"></colgroup><colgroup id="TBL-9-4g"><col 
id="TBL-9-4"></colgroup><colgroup id="TBL-9-5g"><col 
id="TBL-9-5"></colgroup><colgroup id="TBL-9-6g"><col 
id="TBL-9-6"></colgroup><colgroup id="TBL-9-7g"><col 
id="TBL-9-7"></colgroup><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-9-1-"><td  style="white-space:nowrap; text-align:center;" id="TBL-9-1-1"  
class="td11">page 1</td><td  style="white-space:nowrap; text-align:center;" id="TBL-9-1-2"  
class="td11">page 2</td><td  style="white-space:nowrap; text-align:center;" id="TBL-9-1-3"  
class="td11">page 3</td><td  style="white-space:nowrap; text-align:center;" id="TBL-9-1-4"  
class="td11">page 4</td><td  style="white-space:nowrap; text-align:center;" id="TBL-9-1-5"  
class="td11">page 5</td><td  style="white-space:nowrap; text-align:center;" id="TBL-9-1-6"  
class="td11">page 7</td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-9-2-"><td  style="white-space:nowrap; text-align:center;" id="TBL-9-2-1"  
class="td11">      </td></tr></table>
</div>
                                                                                         
                                                                                         
    </div><hr class="endfloat" />
    </div>
<!--l. 179--><p class="indent" >    In this buffer, with 7 pages it just so happens, each time you want to read a page, the that
page just got removed since it was the "longest unused"
<!--l. 181--><p class="indent" >    This is called <tspan font-family="ecbx" font-size="1200">Sequential flooding </tspan>with 0% hit rate in cache. Clock would not perform any
better. It would be just like LRU.
<a 
 id="x1-168003r231"></a>
<h4 class="subsectionHead"><span class="titlemark">7.4.5   </span> <a 
 id="x1-1690005"></a>Repeated Scans (MRU)</h4>
<!--l. 184--><p class="noindent" >You get (B-1)/N hit rate, which is about as good as you can do.
<a 
 id="x1-169001r223"></a>
<h3 class="sectionHead"><span class="titlemark">7.5   </span> <a 
 id="x1-1700005"></a>Improvement for sequential scan: prefetching</h3>
<!--l. 186--><p class="noindent" >Prefetch: we ask disk space manager for run of sequential pages. This helps because it will amortize
random I/O overhead. It allows computation to happen while I/O continue in the background. So
if you wanted page 1, it would get page 2-5 as well. If page 2-5 take a long time to retrieve, you can
still perform actions on page 1 while it is loading 2-5. Think of this as the Disk and CPU as
"parallel devices" working at the same time.
<a 
 id="x1-170001r234"></a>
<h3 class="sectionHead"><span class="titlemark">7.6   </span> <a 
 id="x1-1710006"></a>We need hybrid between LRU and MRU</h3>
<!--l. 192--><p class="noindent" >We need a hybrid between LRU and MRU. LRU is good for random access and MRU is good for
repeated sequential. o
<!--l. 194--><p class="indent" >    There are two general approaches:
      <ul class="itemize1">
      <li class="itemize">Use DBMS information to hint to buffer manager.
           <ul class="itemize2">
           <li class="itemize">For big queries, we can predict I/O patterns from the handful of query processing
           algorithm we&#8217;ll learn that have specific access patterns so we can tell buffer what
           will happen soon.
           </li>
           <li class="itemize">For simple lookups, we may not have long plan so LRU does well.</li></ul>
      </li></ul>
<!--l. 204--><p class="noindent" >Some systems have special system for index files that are different from heap files. They may use
LRU-w for heap files and then something else for index files.
<a 
 id="x1-171001r235"></a>
<h3 class="sectionHead"><span class="titlemark">7.7   </span> <a 
 id="x1-1720007"></a>DBMS vs OS Buffer Cache</h3>
<!--l. 207--><p class="noindent" >We might as: if the operating system already has its own file cache, why is the database system
implementing that as well. Why can&#8217;t we use the OS buffers and let that do the job.
<br 
class="newline" />A few issues are:
      <ul class="itemize1">
      <li class="itemize">Portability: different FS have different behaviors so you want the database system to
      control the buffer pool policy to get predictable performance
                                                                                         
                                                                                         
      </li>
      <li class="itemize">OS limitations: DBMS requires ability to force pages down to disk. Many OS don&#8217;t
      have API for this so the DBMS never knows if the page has been written or not. This
      can cause big problems.
      </li>
      <li class="itemize">OS  limitations:  DBMS  can  predict  its  own  page  reference  patterns.  It  has  more
      information than it can give the OS or filesystem. It can use those to do more intelligent
      prefetching or page replacement.
      <!--l. 219--><p class="noindent" >Example: A scan of the leaf level of B+ tree for range search. The DBMS knows
      that there is a linked list at the bottom so it can predict which page will be chosen
      next. The OS only knows the physically contiguous pages on the file (page 1 page
      2 etc) so the OS can&#8217;t do prefetching for us. There are similar issues with the page
      replacement. Sometimes we want to use LMU, MRU. The OS does not have access to
      these informations.</li></ul>
<!--l. 226--><p class="indent" >    Thus, the DBMS bypasses OS file cache and they implement their own buffer pools. Difference between
filesystem and OS: https://www.quora.com/What-is-the-difference-between-operating-system-and-file-system
<a 
 id="x1-172001r236"></a>
<h3 class="sectionHead"><span class="titlemark">7.8   </span> <a 
 id="x1-1730008"></a>Summary</h3>
<!--l. 230--><p class="noindent" >The buffer manager provides a level of indirection. It maps disk ids to RAM addresses for the file
manager to provide in higher levels to manipulate values on the page.
<!--l. 232--><p class="indent" >    Another feature of Buffer manager is to ensure that each page requested is "pinned" in RAM.
To be manipulated in-memory. The caller must unpin the caller.
<!--l. 234--><p class="indent" >    It attempts to minimize <tspan font-family="ecbx" font-size="1200">cache misses</tspan>:
      <ul class="itemize1">
      <li class="itemize">By replacing pages unlikely to be referenced.
      </li>
      <li class="itemize">By prefetching pages likely to be referenced.</li></ul>
      <ul class="itemize1">
      <li class="itemize">When do pin counts and dirty bits get set/unset?
      </li>
      <li class="itemize">By what layer of the system are they being set/unset? <a 
 id="likesection.7"></a><a 
 id="x1-173001"></a><object data="CS186Main-20.svg" width="1.0 " height="2.33333 " type="image/svg+xml"><p>SVG-Viewer needed.</p></object>
      <span class="marginpar"><object data="CS186Main-21.svg" width="76.20702 " height="80.5248 " type="image/svg+xml"><p>SVG-Viewer needed.</p></object>
      <object data="CS186Main-22.svg" width="1.0 " height="2.33333 " type="image/svg+xml"><p>SVG-Viewer needed.</p></object>
      </span></li></ul>
                                                                                         
                                                                                         
    <h2 class="chapterHead"><span class="titlemark">Chapter&#x00A0;8</span><br /><a 
 id="x1-1740008"></a>Relational Algebra</h2>
<!--l. 247--><p class="noindent" >We are going to talk about the definitions of the relational operators. <hr class="figure"><div class="figure" 
>
                                                                                         
                                                                                         
                                                                                         
                                                                                         
<!--l. 250--><p class="noindent" >
                                                                                         
                                                                                         
<!--l. 251--><p class="indent" >    </div><hr class="endfigure">
<!--l. 252--><p class="indent" >    <hr class="figure"><div class="figure" 
>
                                                                                         
                                                                                         
<a 
 id="x1-1740011"></a>
                                                                                         
                                                                                         
<!--l. 254--><p class="noindent" >
<br /> <div class="caption" 
><span class="id">Figure&#x00A0;8.1: </span><span  
class="content">Overview of the Query Parsing &amp; Optimization</span></div><!--tex4ht:label?: x1-1740011 -->
                                                                                         
                                                                                         
<!--l. 256--><p class="indent" >    </div><hr class="endfigure">
<!--l. 257--><p class="indent" >    A logical query plan is a strategy for executing the query expressed in terms of the operators.
The <tspan font-family="ecbx" font-size="1200">optimizer </tspan>creates a physical optimized query plan which for every operator in the tree, it will
generate an actual algorithm. Today we focus on the relational algebra and what it
means.
<!--l. 261--><p class="indent" >    SQL is a declarative expression while <tspan font-family="ecbx" font-size="1200">Relational Algebra </tspan>is an <tspan font-family="ecbx" font-size="1200">operational </tspan>description of a
computation. It tells you what order of operations to take. It is operations on entire tables, not on
individual cells or rows in a table.
<!--l. 264--><p class="indent" >    Foundation of formal query languages is on <tspan font-family="ecbx" font-size="1200">Relational Calculus</tspan>
<a 
 id="x1-174002r237"></a>
<h3 class="sectionHead"><span class="titlemark">8.1   </span> <a 
 id="x1-1750001"></a>History: Formal Relational QL&#8217;s </h3>
<!--l. 266--><p class="noindent" ><tspan font-family="ecbx" font-size="1200">Relational Calculus </tspan>(basis for SQL) describes the result of computation and is based on first
order logic.
<!--l. 268--><p class="indent" >    <tspan font-family="ecbx" font-size="1200">Relational Algebra</tspan>: provides operational description of transformation and in what
order.
<!--l. 270--><p class="indent" >    The question is: are these two languages equivalent and can we go from one to the
other.
<!--l. 273--><p class="indent" >    Codd&#8217;s Theorem established equivalence in expressivity between Relational Calculus and
Relational Algebra. He showed that all queries you can say in Relational Calculus you can express
in Relational Algebra and all operations you can compose in Algebra you can express in an
equivalent form in Relational Calculus.
<!--l. 277--><p class="indent" >    This is important because it connects declarative representation of queries with operational
description. It also shows us that we can compile SQL into relational algebra.
<a 
 id="x1-175001r240"></a>
<h3 class="sectionHead"><span class="titlemark">8.2   </span> <a 
 id="x1-1760002"></a>Set Operators</h3>
<a 
 id="x1-176001r233"></a>
<h4 class="subsectionHead"><span class="titlemark">8.2.1   </span> <a 
 id="x1-1770001"></a>Union(<tspan font-family="cmsy" font-size="10">&#x222A;</tspan>)</h4>
<!--l. 282--><p class="noindent" >There is the constraint that the two relations must be <tspan font-family="ecbx" font-size="1200">compatible </tspan>in that they have the <tspan font-family="ecti" font-size="1200">same</tspan>
<tspan font-family="ecti" font-size="1200">number of fields </tspan>and fields in corresponding positions have the same <tspan font-family="ecti" font-size="1200">type</tspan>. (first column of
first table has to have the same type as first column of second table). Don&#8217;t need same
name.
<!--l. 286--><p class="indent" >    In SQL, there is a difference between UNION and UNION ALL. But in relational algebra,
they always remove duplicates.
<a 
 id="x1-177001r242"></a>
<h4 class="subsectionHead"><span class="titlemark">8.2.2   </span> <a 
 id="x1-1780002"></a>Set Difference (-)</h4>
<!--l. 289--><p class="noindent" >Same with <tspan font-family="cmsy" font-size="10">&#x222A;</tspan>; both inputs relations must be compatible.
<!--l. 290--><p class="indent" >    For set difference, there are no duplicates generated and no duplicates in the first place so
there is no duplicate elimination.
<!--l. 292--><p class="indent" >    Set difference is not commutative
<a 
 id="x1-178001r243"></a>
<h4 class="subsectionHead"><span class="titlemark">8.2.3   </span> <a 
 id="x1-1790003"></a>Cross-Product (x)</h4>
<!--l. 294--><p class="noindent" ><tspan font-family="ecbx" font-size="1200">R1 x S1</tspan>: Each row of <tspan font-family="ecbx" font-size="1200">R1 </tspan>paired with each row of <tspan font-family="ecbx" font-size="1200">S1</tspan>.
                                                                                         
                                                                                         
<!--l. 295--><p class="indent" >    The number of rows created is <tspan font-family="cmsy" font-size="10">|</tspan><tspan font-family="cmmi" font-size="12">R</tspan><tspan font-family="cmr" font-size="12">1</tspan><tspan font-family="cmsy" font-size="10">|*|</tspan><tspan font-family="cmmi" font-size="12">R</tspan><tspan font-family="cmr" font-size="12">2</tspan><tspan font-family="cmsy" font-size="10">|</tspan>
<!--l. 296--><p class="indent" >    The schema do not need to be compatible becuase we are concatenating the schemas of the
inputs.
<!--l. 298--><p class="indent" >    There are no duplicated generated.
<a 
 id="x1-179001r244"></a>
<h4 class="subsectionHead"><span class="titlemark">8.2.4   </span> <a 
 id="x1-1800004"></a>Renaming (<tspan font-family="cmmi" font-size="12">&#x03C1; </tspan>= "rho")</h4>
<!--l. 300--><p class="noindent" >operator that works at the schema level. It does not do anything to the data. It just changes the
schema by renaming relations and or attributes. <hr class="figure"><div class="figure" 
>
                                                                                         
                                                                                         
<a 
 id="x1-1800012"></a>
                                                                                         
                                                                                         
<!--l. 304--><p class="noindent" >
<br /> <div class="caption" 
><span class="id">Figure&#x00A0;8.2: </span><span  
class="content">Template for rho renaming</span></div><!--tex4ht:label?: x1-1800012 -->
                                                                                         
                                                                                         
<!--l. 307--><p class="indent" >    </div><hr class="endfigure">
<!--l. 308--><p class="indent" >    There is a <tspan font-family="cmmi" font-size="12">&#x03C1; </tspan>that takes in a n argument of the things that you want to change and then
everything else stays the same.
<a 
 id="x1-180002r241"></a>
<h3 class="sectionHead"><span class="titlemark">8.3   </span> <a 
 id="x1-1810003"></a>Compound Operators</h3>
<!--l. 311--><p class="noindent" ><tspan font-family="ecbx" font-size="1200">Compound operators </tspan>are macros over the operators we&#8217;ve already learned.
<a 
 id="x1-181001r245"></a>
<h4 class="subsectionHead"><span class="titlemark">8.3.1   </span> <a 
 id="x1-1820001"></a>Compound Operator: intersection</h4>
<!--l. 313--><p class="noindent" >Same as with union, both input relations must be compatible. The SQL expression is
INTERSECT.
    <center class="math-display" >
<img 
src="CS186Main23x.png" alt="S1 &#x2229; S2 = S1  - (S1 - S2 )
" class="math-display" ></center>
<!--l. 317--><p class="nopar" >
<a 
 id="x1-182001r248"></a>
<h4 class="subsectionHead"><span class="titlemark">8.3.2   </span> <a 
 id="x1-1830002"></a>Compound Operator: Join</h4>
<!--l. 319--><p class="noindent" >This allows us to put together data from multiple tables.
<!--l. 320--><p class="indent" >    Joins are compound operators like intersections. Joins are defined as:
    <center class="math-display" >
<img 
src="CS186Main24x.png" alt="&#x03C3;&#x03B8;(R * S)
" class="math-display" ></center>
<!--l. 323--><p class="nopar" > Hierarchy of common kinds:
      <ul class="itemize1">
      <li class="itemize"><tspan font-family="ecbx" font-size="1200">Theta Join </tspan>(<img 
src="CS186Main25x.png" alt="&#x22B3;&#x22B2;"  class="bowtie" ><sub><tspan font-family="cmmi" font-size="8">&#x03B8;</tspan></sub>): join on logical expression <tspan font-family="cmmi" font-size="12">&#x03B8;</tspan>
           <ul class="itemize2">
           <li class="itemize"><tspan font-family="ecbx" font-size="1200">Equi-Join </tspan>: theta join with theta being a conjunction of equalities. It is a bunch of
           equals predicates combined with ands.
               <ul class="itemize3">
               <li class="itemize"><tspan font-family="ecbx" font-size="1200">Natural Join </tspan>(<img 
src="CS186Main26x.png" alt="&#x22B3;&#x22B2;"  class="bowtie" >): A special case of <tspan font-family="ecbx" font-size="1200">equi-join </tspan>called Natural join. It is just
               an Equi-join where conjunctions are on predicates that match up columns
               that have the same names across both tables.</li></ul>
           </li></ul>
      </li></ul>
<!--l. 338--><p class="noindent" >For this, we need a good join algorithm that is better than taking a cross-product and then getting a
selection.
<a 
 id="x1-183001r249"></a>
<h4 class="subsectionHead"><span class="titlemark">8.3.3   </span> <a 
 id="x1-1840003"></a>Theta Join Example</h4>
<!--l. 341--><p class="noindent" ><hr class="figure"><div class="figure" 
>
                                                                                         
                                                                                         
<a 
 id="x1-1840013"></a>
                                                                                         
                                                                                         
<!--l. 343--><p class="noindent" >
<br /> <div class="caption" 
><span class="id">Figure&#x00A0;8.3: </span><span  
class="content">Example of Theta Join</span></div><!--tex4ht:label?: x1-1840013 -->
                                                                                         
                                                                                         
<!--l. 345--><p class="noindent" ></div><hr class="endfigure">
<!--l. 346--><p class="indent" >    In this example, we try to do the join: <tspan font-family="cmmi" font-size="12">R</tspan><tspan font-family="cmr" font-size="12">1</tspan><img 
src="CS186Main27x.png" alt="&#x22B3;&#x22B2;"  class="bowtie" ><sub>sid=sid</sub><tspan font-family="cmmi" font-size="12">S</tspan><tspan font-family="cmr" font-size="12">1</tspan>. After the join, there are two columns
with the name <tspan font-family="ecti" font-size="1200">sid </tspan>so we need to change the names to make them unique.
<!--l. 349--><p class="indent" >    Another example is a self join: <tspan font-family="cmmi" font-size="12">S</tspan><tspan font-family="cmr" font-size="12">1</tspan><img 
src="CS186Main28x.png" alt="&#x22B3;&#x22B2;"  class="bowtie" ><sub>age&#x003C;age2</sub><tspan font-family="cmmi" font-size="12">S</tspan><tspan font-family="cmr" font-size="12">1</tspan>. In this case, we will do the cross
product of the two and then cross out all the lines where the condition is not true.
<hr class="figure"><div class="figure" 
>
                                                                                         
                                                                                         
<a 
 id="x1-1840024"></a>
                                                                                         
                                                                                         
<!--l. 354--><p class="noindent" >
<br /> <div class="caption" 
><span class="id">Figure&#x00A0;8.4: </span><span  
class="content">Another Example of Theta Join</span></div><!--tex4ht:label?: x1-1840024 -->
                                                                                         
                                                                                         
<!--l. 356--><p class="indent" >    </div><hr class="endfigure">
<!--l. 357--><p class="indent" >    This self join is the same as the cross product of itself. We have to rename since we are joining
with itself so there will definitely be columns with the same name.
<a 
 id="x1-184003r250"></a>
<h4 class="subsectionHead"><span class="titlemark">8.3.4   </span> <a 
 id="x1-1850004"></a>Natural Join</h4>
<!--l. 360--><p class="noindent" >It is a special case of equi-join in which equalities are specified for all matching fields and duplicate
fields are projected away. (there is an implicit theta)
    <center class="math-display" >
<img 
src="CS186Main29x.png" alt="R &#x22B3;&#x22B2; S = &#x03C0;uniquefld&#x03C3;eq. matching fld(R  * S )
" class="math-display" ></center>
<!--l. 364--><p class="nopar" > At the end of the join, we project away any duplicate fields and keep only one copy of each
distinct column.
      <ul class="itemize1">
      <li class="itemize">We compute the corss product
      </li>
      <li class="itemize">Select the fields where both relations have equal values
      </li>
      <li class="itemize">Project onto the set of all unique fields.</li></ul>
<div class="table">
<!--l. 372--><p class="indent" >    <hr class="float"><div class="float" 
>
                                                                                         
                                                                                         
<div class="tabular"> <table id="TBL-10" class="tabular" 
cellspacing="0" cellpadding="0"  
><colgroup id="TBL-10-1g"><col 
id="TBL-10-1"></colgroup><colgroup id="TBL-10-2g"><col 
id="TBL-10-2"></colgroup><colgroup id="TBL-10-3g"><col 
id="TBL-10-3"></colgroup><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-10-1-"><td colspan="3" style="white-space:nowrap; text-align:center;" id="TBL-10-1-1"  
class="td11">       <div class="multicolumn"  style="white-space:nowrap; text-align:center;">R1</div></td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-10-2-"><td  style="white-space:nowrap; text-align:center;" id="TBL-10-2-1"  
class="td11">sid</td><td  style="white-space:nowrap; text-align:center;" id="TBL-10-2-2"  
class="td11">bid</td><td  style="white-space:nowrap; text-align:center;" id="TBL-10-2-3"  
class="td11">  day    </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-10-3-"><td  style="white-space:nowrap; text-align:center;" id="TBL-10-3-1"  
class="td11">22</td><td  style="white-space:nowrap; text-align:center;" id="TBL-10-3-2"  
class="td11">101</td><td  style="white-space:nowrap; text-align:center;" id="TBL-10-3-3"  
class="td11">10/10/96</td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-10-4-"><td  style="white-space:nowrap; text-align:center;" id="TBL-10-4-1"  
class="td11">58</td><td  style="white-space:nowrap; text-align:center;" id="TBL-10-4-2"  
class="td11">103</td><td  style="white-space:nowrap; text-align:center;" id="TBL-10-4-3"  
class="td11">11/12/96</td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-10-5-"><td  style="white-space:nowrap; text-align:center;" id="TBL-10-5-1"  
class="td11">  </td></tr></table></div>
<div class="tabular"> <table id="TBL-11" class="tabular" 
cellspacing="0" cellpadding="0"  
><colgroup id="TBL-11-1g"><col 
id="TBL-11-1"></colgroup><colgroup id="TBL-11-2g"><col 
id="TBL-11-2"></colgroup><colgroup id="TBL-11-3g"><col 
id="TBL-11-3"></colgroup><colgroup id="TBL-11-4g"><col 
id="TBL-11-4"></colgroup><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-11-1-"><td colspan="3" style="white-space:nowrap; text-align:center;" id="TBL-11-1-1"  
class="td11"></td>          <div class="multicolumn"  style="white-space:nowrap; text-align:center;">S1</div></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-11-2-"><td  style="white-space:nowrap; text-align:center;" id="TBL-11-2-1"  
class="td11">sid</td><td  style="white-space:nowrap; text-align:center;" id="TBL-11-2-2"  
class="td11">sname</td><td  style="white-space:nowrap; text-align:center;" id="TBL-11-2-3"  
class="td11">rating</td><td  style="white-space:nowrap; text-align:center;" id="TBL-11-2-4"  
class="td11">age</td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-11-3-"><td  style="white-space:nowrap; text-align:center;" id="TBL-11-3-1"  
class="td11">22</td><td  style="white-space:nowrap; text-align:center;" id="TBL-11-3-2"  
class="td11">dustin</td><td  style="white-space:nowrap; text-align:center;" id="TBL-11-3-3"  
class="td11">  7   </td><td  style="white-space:nowrap; text-align:center;" id="TBL-11-3-4"  
class="td11">45.0</td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-11-4-"><td  style="white-space:nowrap; text-align:center;" id="TBL-11-4-1"  
class="td11">31</td><td  style="white-space:nowrap; text-align:center;" id="TBL-11-4-2"  
class="td11">lubber</td><td  style="white-space:nowrap; text-align:center;" id="TBL-11-4-3"  
class="td11">  8   </td><td  style="white-space:nowrap; text-align:center;" id="TBL-11-4-4"  
class="td11">55.5</td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-11-5-"><td  style="white-space:nowrap; text-align:center;" id="TBL-11-5-1"  
class="td11">58</td><td  style="white-space:nowrap; text-align:center;" id="TBL-11-5-2"  
class="td11"> rusty </td><td  style="white-space:nowrap; text-align:center;" id="TBL-11-5-3"  
class="td11">  10  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-11-5-4"  
class="td11">35.0</td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-11-6-"><td  style="white-space:nowrap; text-align:center;" id="TBL-11-6-1"  
class="td11">  </td></tr></table></div>
                                                                                         
                                                                                         
    </div><hr class="endfloat" />
</div>
<!--l. 406--><p class="indent" >    <hr class="figure"><div class="figure" 
>
                                                                                         
                                                                                         
                                                                                         
                                                                                         
<!--l. 408--><p class="noindent" >
                                                                                         
                                                                                         
<!--l. 409--><p class="indent" >    </div><hr class="endfigure"><div class="mdframed" id="mdframed-1">
<!--l. 412--><p class="noindent" >Example: from table <a 
href="#x1-1850004">8.3.4<!--tex4ht:ref: naturaljoin2 --></a> we want to do the natural join:
<center class="math-display" >
<img 
src="CS186Main30x.png" alt="R &#x22B3;&#x22B2; S = &#x03C0;unique fld&#x03C3;eq. matching fld(R * S )
" class="math-display" ></center>
<!--l. 415--><p class="nopar" > You look at which column names are shared between the reservations and sailors. So it essentially
just an equi-join on the sid. After we are done, we will project away the second sid field so we only
have one.</div>
<!--l. 420--><p class="indent" >    Natural joins are common with foreign key joins.
<a 
 id="x1-185001r247"></a>
<h3 class="sectionHead"><span class="titlemark">8.4   </span> <a 
 id="x1-1860004"></a>Extended Relational Algebra</h3>
<!--l. 422--><p class="noindent" >It&#8217;s common to extend the relational algebra with syntax for grouping and aggregation using <tspan font-family="cmmi" font-size="12">&#x03B3;</tspan>.
<br 
class="newline" />Example: <tspan font-family="cmmi" font-size="12">&#x03B3;</tspan><sub>age, AVG(rating)</sub><tspan font-family="cmr" font-size="12">(</tspan>sailors<tspan font-family="cmr" font-size="12">) </tspan>The <tspan font-family="ectt" font-size="1200">age </tspan>is both a GROUP BY and an output column. The
<tspan font-family="ectt" font-size="1200">AVG(rating) </tspan>Is an aggregation function over one of the columns. <br 
class="newline" />You can also have (HAVING clause) in the gamma:
    <center class="math-display" >
<img 
src="CS186Main31x.png" alt="&#x03B3;age, AVG (rating)&#x003C; COUNT (*)&#x003E;2(Sailors)
" class="math-display" ></center>
<!--l. 430--><p class="nopar" >
<a 
 id="x1-186001r254"></a>
<h3 class="sectionHead"><span class="titlemark">8.5   </span> <a 
 id="x1-1870005"></a>Summary</h3>
<!--l. 432--><p class="noindent" >We looked at <tspan font-family="ecbx" font-size="1200">relational algebra </tspan>which is a small set of operators mapping relations to relations.
Relational algebra is operational in that you specify an explicit order of operations. It is
more like programming SQL and relational calculus languages since you specify what
order to activate each operation to achieve the output rather than stating what you
want.
<!--l. 437--><p class="indent" >    The set of operators is closed.
<img 
src="CS186Main33x.png" alt="picture" >
                                                                                         
                                                                                         
                                                                                         
                                                                                         
                                                                                         
                                                                                         
    <h2 class="chapterHead"><span class="titlemark">Chapter&#x00A0;9</span><br /><a 
 id="x1-1880009"></a>February 21, 2019</h2>
    <div class="newtheorem">
<!--l. 2--><p class="noindent" ><span class="head">
<tspan font-family="ecbx" font-size="1200">Definition</tspan><tspan font-family="ecbx" font-size="1200">&#x00A0;9.1</tspan> </span><tspan font-family="ecbi" font-size="1200">buffer</tspan><tspan font-family="ecti" font-size="1200">: buffer contains data that is stored for a short amount of time,</tspan>
<tspan font-family="ecti" font-size="1200">typically in the computer&#8217;s RAM.</tspan>
    </div>
<div class="newtheorem">
<!--l. 6--><p class="noindent" ><span class="head">
<tspan font-family="ecbx" font-size="1200">Definition</tspan><tspan font-family="ecbx" font-size="1200">&#x00A0;9.2</tspan> </span><tspan font-family="ecbi" font-size="1200">data  stream</tspan><tspan font-family="ecti" font-size="1200">:  a  sequence  of  digitally  encoded  coherent  signals  used  to</tspan>
<tspan font-family="ecti" font-size="1200">transmit or receive information that is in the process of being transmitted.</tspan>
    </div>
<div class="newtheorem">
<!--l. 9--><p class="noindent" ><span class="head">
<tspan font-family="ecbx" font-size="1200">Definition</tspan><tspan font-family="ecbx" font-size="1200">&#x00A0;9.3</tspan> </span><tspan font-family="ecbi" font-size="1200">Streaming algorithm</tspan><tspan font-family="ecti" font-size="1200">: algorithms for processing data streams in which</tspan>
<tspan font-family="ecti" font-size="1200">the input is presented as a sequence of items and can be examined in only a few passes.</tspan>
    </div>
<!--l. 14--><p class="noindent" >We will start with sort. We use sorting for:
      <ul class="itemize1">
      <li class="itemize">Rendezvous. Get the tuples that need to be processed all congregated together.
      <!--l. 17--><p class="noindent" >This way you can eliminate duplicates. This is like SQL (DISTINCT) clause. This is
      also used for summarization like the (GROUP BY) Clause. Join algorithms like sort
      and join need to round together two different tables to concatenate them together.
      </li>
      <li class="itemize">Ordering. Ordering is also useful because the user might ask for it so the output might
      have to be ordered. Furthermore, by sorting, you can enable bulk-loading for trees such
      as B+ trees.</li></ul>
<!--l. 25--><p class="indent" >    Problem: how do we sort 100Gb of data with just 1GB of ram? You can&#8217;t just bring to the file
to ram. Virtual memory does not work for sorting because it does not understand the algorithm
that we are doing. It does not understand we need to sort so virtual memory will translate the
references to ram into random disk I/O&#8217;s.
<!--l. 29--><p class="indent" >    We want to do something that understands the algorithm for sorting.
<a 
 id="x1-188004r255"></a>
<h3 class="sectionHead"><span class="titlemark">9.1   </span> <a 
 id="x1-1890001"></a>Out-of-core Algorithms</h3>
<!--l. 31--><p class="noindent" >These algorithms are called <tspan font-family="ecbx" font-size="1200">Out-of-Core Algorithms</tspan>. It is called out-of-core because ram used
to be called out-of-core. Algorithms that work on data that is bigger than ram is typically called
<tspan font-family="ecbx" font-size="1200">out-of-core algorithms</tspan>.
<!--l. 34--><p class="indent" >    There are two themes we are going to look at:
                                                                                         
                                                                                         
      <ul class="itemize1">
      <li class="itemize">Single-pass streaming data through RAM
      </li>
      <li class="itemize">Divide (into RAM-sized chunks) and Conquer.</li></ul>
<a 
 id="x1-189001r253"></a>
<h4 class="subsectionHead"><span class="titlemark">9.1.1   </span> <a 
 id="x1-1900001"></a>Single-pass Streaming</h4>
<!--l. 40--><p class="noindent" >We will look at the simplest case: "Map".
      <ul class="itemize1">
      <li class="itemize">Goal: is to compute <tspan font-family="cmmi" font-size="12">f</tspan><tspan font-family="cmr" font-size="12">(</tspan><tspan font-family="cmmi" font-size="12">x</tspan><tspan font-family="cmr" font-size="12">) </tspan>for each record and write out the result.
      </li>
      <li class="itemize">Challenge: minimize RAM, and to do as few I/O as possible.</li></ul>
<!--l. 45--><p class="noindent" >Approach:
      <ul class="itemize1">
      <li class="itemize">Reach a chunk from INPUT to an input Buffer
      </li>
      <li class="itemize">For each item in the Input buffer, Write <tspan font-family="cmmi" font-size="12">f</tspan><tspan font-family="cmr" font-size="12">(</tspan><tspan font-family="cmmi" font-size="12">x</tspan><tspan font-family="cmr" font-size="12">) </tspan>to an Output Buffer
      </li>
      <li class="itemize">When Input Buffer is consumed, read another chunk
      </li>
      <li class="itemize">When Output Buffer fills, write it to OUTPUT.</li></ul>
<!--l. 52--><p class="noindent" ><hr class="figure"><div class="figure" 
><a 
 id="x1-1900011"></a>
<br /> <div class="caption" 
><span class="id">Figure&#x00A0;9.1: </span><span  
class="content">Single Pass Streaming</span></div><!--tex4ht:label?: x1-1900011 -->
<!--l. 56--><p class="indent" >    </div><hr class="endfigure">
<!--l. 57--><p class="indent" >    <hr class="figure"><div class="figure" 
>
                                                                                         
                                                                                         
<a 
 id="x1-1900022"></a>
                                                                                         
                                                                                         
<!--l. 59--><p class="noindent" >
<br /> <div class="caption" 
><span class="id">Figure&#x00A0;9.2: </span><span  
class="content">The function can compress or decompress the input</span></div><!--tex4ht:label?: x1-1900022 -->
                                                                                         
                                                                                         
<!--l. 61--><p class="indent" >    </div><hr class="endfigure">
<!--l. 62--><p class="indent" >    We keep reading from the input buffer until the Output buffer is full. When the Output buffer
is full, we then finally write it to the output.
<!--l. 64--><p class="indent" >    The problem is that the input and output are not synchronized. We may do many inputs per
each output or many outputs for each input.
<!--l. 66--><p class="indent" >    Data streams through memory and never takes up more than two buffers, one for input and
one for output and it only uses one thread.
<a 
 id="x1-190003r258"></a>
<h4 class="subsectionHead"><span class="titlemark">9.1.2   </span> <a 
 id="x1-1910002"></a>Better: Double Buffering</h4>
<!--l. 69--><p class="noindent" >The idea is to have two threads:
      <ul class="itemize1">
      <li class="itemize"><tspan font-family="ecbx" font-size="1200">main thread </tspan>which takes the data in an input buffer and calls <tspan font-family="cmmi" font-size="12">f</tspan><tspan font-family="cmr" font-size="12">(</tspan><tspan font-family="cmmi" font-size="12">x</tspan><tspan font-family="cmr" font-size="12">) </tspan>for every one
      of those objects and makes sure that the data gets into an output buffer. This is the
      compute thread in the foreground.
      </li>
      <li class="itemize">The <tspan font-family="ecbx" font-size="1200">second </tspan>thread is in charge of I/O. It drains the output buffers when they are full
      and write them to disk. It then fills the input buffers when they are empty and read
      them from disk.</li></ul>
<!--l. 78--><p class="indent" >    The goal is to have the two threads in parallel so the I/O and the compute are overlapping.
We can achieve this even when the computer is a single core because the Disk Drive
itself is a parallel itself. When the I/O thread makes a request from the disk, we can
continue to compute in the foreground while we wait for a response from the disk in the
background.
<!--l. 83--><p class="indent" >    This is the general idea. We want the I/O to be handled by a dedicated thread so compute can
happen while the I/O thread is idle.
<!--l. 85--><p class="indent" >    We can further make this better by allowing the two threads to hand off. So the I/O thread is
able to work on the buffers that the compute thread finished and the compute thread can work on
the buffers that the I/O thread filled up.
<!--l. 88--><p class="indent" >    <tspan font-family="ecbx" font-size="1200">Double buffering </tspan>applies to all streams. For simplicity, we will not account for double
buffering but it is a useful optimization that we can use as it allows us to read ahead while we are
still doing our I/O.
<a 
 id="x1-191001r257"></a>
<h3 class="sectionHead"><span class="titlemark">9.2   </span> <a 
 id="x1-1920002"></a>Sorting &amp; hashing: Formal Specs</h3>
<!--l. 92--><p class="noindent" ><tspan font-family="ecbx" font-size="1200">Given:</tspan>
      <ul class="itemize1">
      <li class="itemize">A file F: containing a multiset of records R and consuming N blocks of storage.
      </li>
      <li class="itemize">Two "scratch" disks: Each with &#x003E; N blocks of free storage.
      </li>
      <li class="itemize">A fixed amount of space in RAM: with memory capacity equivalent to B blocks on
      disk (B &#x003C; N)</li></ul>
                                                                                         
                                                                                         
<div class="newtheorem">
<!--l. 99--><p class="noindent" ><span class="head">
<tspan font-family="ecbx" font-size="1200">Definition</tspan><tspan font-family="ecbx" font-size="1200">&#x00A0;9.4</tspan> </span><tspan font-family="ecbi" font-size="1200">block</tspan><tspan font-family="ecti" font-size="1200">: a contiguous set of bits or bytes that forms an identifiable unit of</tspan>
<tspan font-family="ecti" font-size="1200">data.</tspan>
    </div>
<!--l. 104--><p class="indent" >    <tspan font-family="ecbx" font-size="1200">Our Goal:</tspan>
      <ul class="itemize1">
      <li class="itemize">Our goal in sorting is to produce an output file <tspan font-family="cmmi" font-size="12">F</tspan><sub><tspan font-family="cmmi" font-size="8">s</tspan></sub> with contents R stored in order by
      a given sorting criterion.
      </li>
      <li class="itemize">For hashing: our goal is to produce an output file <tspan font-family="cmmi" font-size="12">F</tspan><sub><tspan font-family="cmmi" font-size="8">H</tspan></sub> with contents R, arranged on
      disk so that matching records, ones with the same hash values, are always stored
      consecutively in <tspan font-family="cmmi" font-size="12">F</tspan><sub><tspan font-family="cmmi" font-size="8">H</tspan></sub>. <tspan font-family="cmmi" font-size="12">F</tspan><sub><tspan font-family="cmmi" font-size="8">H</tspan></sub> can be in no particular order but all of the matching values
      are all stored consecutively for any value.</li></ul>
<a 
 id="x1-192002r261"></a>
<h4 class="subsectionHead"><span class="titlemark">9.2.1   </span> <a 
 id="x1-1930001"></a>Sorting: 2-Way (a strawman)</h4>
<!--l. 114--><p class="noindent" >We will use this example to give us more insight in our goal.
<!--l. 115--><p class="indent" >    In the <tspan font-family="ecbx" font-size="1200">first pass </tspan>(pass 0), we will conquer a batch of input tuples that are one page
big. We are going to read into I/O buffer, sort it in place, then write that block to the
disk.
<!--l. 118--><p class="indent" >    This only uses one buffer page in memory and we are going to do this on every single block;
sorting them then writing them to disk.
<!--l. 120--><p class="indent" >    In every subsequent pass, (pass 1,2,3...) we are going to merge blocks together where
each block is already sorted. In each pass, we merge two blocks from the input buffer
together into one output buffer. We use 2 of the buffers for inputs and 1 for the output.
<hr class="figure"><div class="figure" 
>
                                                                                         
                                                                                         
<a 
 id="x1-1930013"></a>
                                                                                         
                                                                                         
<!--l. 126--><p class="noindent" >
<br /> <div class="caption" 
><span class="id">Figure&#x00A0;9.3: </span><span  
class="content">Pass 1,2,3... </span></div><!--tex4ht:label?: x1-1930013 -->
                                                                                         
                                                                                         
<!--l. 128--><p class="indent" >    </div><hr class="endfigure">
<!--l. 129--><p class="indent" >    We continuously take the outputs from the previous pass and merge the files. The result is
that after <tspan font-family="ecbx" font-size="1200">pass one</tspan>, the runs are two blocks long. Then the next pass through, we get runs that
are 4 blocks long. <a 
 id="likesection.8"></a><a 
 id="x1-193002"></a><object data="CS186Main-24.svg" width="1.0 " height="2.33333 " type="image/svg+xml"><p>SVG-Viewer needed.</p></object>
<span class="marginpar"><object data="CS186Main-25.svg" width="76.20702 " height="43.03894 " type="image/svg+xml"><p>SVG-Viewer needed.</p></object>
<object data="CS186Main-26.svg" width="1.0 " height="2.33333 " type="image/svg+xml"><p>SVG-Viewer needed.</p></object>
</span>
<a 
 id="x1-193003r262"></a>
<h3 class="sectionHead"><span class="titlemark">9.3   </span> <a 
 id="x1-1940003"></a>General External Merge Sort</h3>
<!--l. 134--><p class="noindent" >When working with more than 3 buffer pages, we are going to use the same technique as the
previous section but now at a larger scale.
      <ul class="itemize1">
      <li class="itemize">At pass 0, we will work on much larger batches
      </li>
      <li class="itemize">At passes after, we will merge more streams together at the same time.</li></ul>
<!--l. 140--><p class="noindent" >To sort a file with N pages using B buffer pages: <hr class="figure"><div class="figure" 
><a 
 id="x1-1940014"></a>
<br /> <div class="caption" 
><span class="id">Figure&#x00A0;9.4: </span><span  
class="content">Merge sort for general case</span></div><!--tex4ht:label?: x1-1940014 -->
<!--l. 145--><p class="indent" >    </div><hr class="endfigure">
      <ul class="itemize1">
      <li class="itemize">Pass 0: Use B buffer pages by reading in B pages in from the input, run quicksort on
      that buffer in memory to generate a run that you can write to the output that will be
      B blocks long. It will produce <tspan font-family="cmsy" font-size="10">&#x2308;</tspan><img 
src="CS186Main34x.png" alt="N-
B"  class="frac" align="middle"><tspan font-family="cmsy" font-size="10">&#x2309; </tspan>sorted runs each of which is B pages long. The last
      page may be a little shorter.
      </li>
      <li class="itemize">Pass 1-N, we will merge B&#8211;1 runs at once, using B-1 buffers for input and 1 buffer for
      output. The idea is that we load the first page of B-1 runs into memory, each
      memory buffer is associated with a different run. we take the lowest value of any
      of the buffer pages and move it to an output buffer. We keep doing that until
      either:
           <ul class="itemize2">
           <li class="itemize">The output buffer is full
           </li>
           <li class="itemize">One of the input buffers is empty, then we read another page from its constituent
           runs.</li></ul>
      </li></ul>
<!--l. 162--><p class="noindent" >After pass 1, the sorted runs will be of length <tspan font-family="cmmi" font-size="12">B</tspan><tspan font-family="cmr" font-size="12">(</tspan><tspan font-family="cmmi" font-size="12">B </tspan><tspan font-family="cmsy" font-size="10">- </tspan><tspan font-family="cmr" font-size="12">1) </tspan>because we are merging <tspan font-family="cmmi" font-size="12">B </tspan><tspan font-family="cmsy" font-size="10">- </tspan><tspan font-family="cmr" font-size="12">1 </tspan>together.
<a 
 id="x1-194002r263"></a>
<h4 class="subsectionHead"><span class="titlemark">9.3.1   </span> <a 
 id="x1-1950001"></a>cost of external merge sort</h4>
<!--l. 165--><p class="noindent" >Number of passes: <tspan font-family="cmr" font-size="12">1 + </tspan><tspan font-family="cmsy" font-size="10">&#x2308;</tspan><tspan font-family="cmr" font-size="12">log</tspan> <sub><tspan font-family="cmmi" font-size="8">B</tspan><tspan font-family="cmsy" font-size="8">-</tspan><tspan font-family="cmr" font-size="8">1</tspan></sub><tspan font-family="cmsy" font-size="10">&#x2308;</tspan><img 
src="CS186Main35x.png" alt="N-
B"  class="frac" align="middle"><tspan font-family="cmsy" font-size="10">&#x2309;&#x2309;</tspan>. The <tspan font-family="cmr" font-size="12">log</tspan> <sub><tspan font-family="cmmi" font-size="8">B</tspan><tspan font-family="cmsy" font-size="8">-</tspan><tspan font-family="cmr" font-size="8">1</tspan></sub> is from our fan in we get form our merge.
                                                                                         
                                                                                         
The <tspan font-family="cmsy" font-size="10">&#x2308;</tspan><img 
src="CS186Main36x.png" alt="NB-"  class="frac" align="middle"><tspan font-family="cmsy" font-size="10">&#x2309; </tspan>is the number of runs we start with in pass 1. We take the ceiling of that log
becuase we might not have <tspan font-family="cmmi" font-size="12">x</tspan><sup><tspan font-family="cmmi" font-size="8">B</tspan><tspan font-family="cmsy" font-size="8">-</tspan><tspan font-family="cmr" font-size="8">1</tspan></sup> number of blocks in our file. The 1 is from pass 0.
<br 
class="newline" />Cost: <tspan font-family="cmr" font-size="12">2</tspan><tspan font-family="cmmi" font-size="12">N </tspan><tspan font-family="cmsy" font-size="10">*</tspan> (# of passes). It is <tspan font-family="cmr" font-size="12">2</tspan><tspan font-family="cmmi" font-size="12">N </tspan>because you read the file, and you write the file for each
pass.<div class="mdframed" id="mdframed-2">
<!--l. 172--><p class="noindent" >5 buffer pages to sort 108 page file:
      <ul class="itemize1">
      <li class="itemize">Pass 0: Takes 108 page file and writes out <tspan font-family="cmsy" font-size="10">&#x2308;</tspan><img 
src="CS186Main37x.png" alt="108
 5"  class="frac" align="middle"><tspan font-family="cmsy" font-size="10">&#x2309; </tspan><tspan font-family="cmr" font-size="12">= 22 </tspan>sorte runs of 5 pages each. The
      last runw ill only have 3 pages because we don&#8217;t have a multiple of 5 pages.
      </li>
      <li class="itemize">Pass 1: Take the 22 sorted runs and merge 4 of them at a time to create <tspan font-family="cmsy" font-size="10">&#x2308;</tspan><img 
src="CS186Main38x.png" alt="242"  class="frac" align="middle"><tspan font-family="cmsy" font-size="10">&#x2309; </tspan><tspan font-family="cmr" font-size="12">= 6</tspan>
      sorted runs creating runs of each 20 pages long. Again, the last run will only have 8
      pages because we had left overs.
      </li>
      <li class="itemize">Pass 2: 2 sorted runs, 80 pages and 28 pages.
      </li>
      <li class="itemize">Pass 4: We are done and have one sorted file of 108 pages.</li></ul>
<!--l. 183--><p class="noindent" >Using the formula, we would have:
<table 
class="equation-star"><tr><td>
<center class="math-display" >
<img 
src="CS186Main39x.png" alt="1 + &#x2308;log 22&#x2309; = 1 + 3 &#x2192;  4passes
        4
" class="math-display" ></center></td></tr></table>
<!--l. 186--><p class="nopar" >
<!--l. 187--><p class="noindent" ><tspan font-family="ecbx" font-size="1200">Example</tspan>
<!--l. 187--><p class="noindent" >____
________
    </div>
<!--l. 188--><p class="indent" >    <hr class="figure"><div class="figure" 
>
                                                                                         
                                                                                         
<a 
 id="x1-1950015"></a>
                                                                                         
                                                                                         
<!--l. 190--><p class="noindent" >
<br /> <div class="caption" 
><span class="id">Figure&#x00A0;9.5: </span><span  
class="content">This is the number of passes for different sizes of N and buffer</span></div><!--tex4ht:label?: x1-1950015 -->
                                                                                         
                                                                                         
<!--l. 192--><p class="indent" >    </div><hr class="endfigure">
<a 
 id="x1-195002r267"></a>
<h4 class="subsectionHead"><span class="titlemark">9.3.2   </span> <a 
 id="x1-1960002"></a>Memory requirement for external sorting</h4>
<!--l. 194--><p class="noindent" >How bit fo a table can we sort in two passes? Each "sorted run" after Phase 0 is of size B and you
can merge up to B-1 sorted runs in Phase 1. <br 
class="newline" />Answer: <tspan font-family="cmmi" font-size="12">B</tspan><tspan font-family="cmr" font-size="12">(</tspan><tspan font-family="cmmi" font-size="12">B </tspan><tspan font-family="cmsy" font-size="10">- </tspan><tspan font-family="cmr" font-size="12">1) </tspan>As a rule of thumb
<img 
src="CS186Main41x.png" alt="picture" >
<a 
 id="x1-196001r265"></a>
<h3 class="sectionHead"><span class="titlemark">9.4   </span> <a 
 id="x1-1970004"></a>Alternative: Hashing</h3>
<!--l. 202--><p class="noindent" >The alternative to sorting is <tspan font-family="ecbx" font-size="1200">hashing</tspan>. This is because many times we don&#8217;t require
the order, we just want the values that are the same to be together. So frequently we
are just rendezvousing matches but are not concerned with the order that they come
out.
<!--l. 205--><p class="indent" >    Traditionally, hashing is done with hash tables in RAM.
<a 
 id="x1-197001r269"></a>
<h4 class="subsectionHead"><span class="titlemark">9.4.1   </span> <a 
 id="x1-1980001"></a>Main Idea</h4>
<!--l. 207--><p class="noindent" >It is typically done using the divide and conquer approach. <a 
 id="Q1-1-272"></a>
<h5 class="likesubsubsectionHead"><a 
 id="x1-1990001"></a>Divide</h5>
<!--l. 209--><p class="noindent" >Stream partiion using hash function <tspan font-family="cmmi" font-size="12">h</tspan><sub><tspan font-family="cmmi" font-size="8">p</tspan></sub> to stream records into disk partitions. All the matches of a
single value will end up in the same partition. A single partition will have multiple different values
but any two values that are the same will be in the same partition.
<!--l. 213--><p class="indent" >    The streaming alg will then create partitions on disk by "spilling" partitions to disk via
output buffers. <a 
 id="Q1-1-274"></a>
<h5 class="likesubsubsectionHead"><a 
 id="x1-2000001"></a>Conquer</h5>
<!--l. 216--><p class="noindent" >In this part we <tspan font-family="ecbx" font-size="1200">rehash </tspan>the partitions that we divided up. We will reach each partition into RAM
based hash table one partition at a time, using has function <tspan font-family="cmmi" font-size="12">h</tspan><sub><tspan font-family="cmmi" font-size="8">r</tspan></sub> that is independent form <tspan font-family="cmmi" font-size="12">h</tspan><sub><tspan font-family="cmmi" font-size="8">p</tspan></sub>. We
will then us that function to build a traditionally hash table with as few number of distinct
numbers as possible in each bucket.
<!--l. 221--><p class="indent" >    After the hash table has been built and sitting in memory, we go through bucket by bucket,
reading out the values in each bucket, making sure that duplicate values are contiguous within
each bucket.
<!--l. 224--><p class="indent" >    Because the hash function ensures that values that are the same will be in the same bucket,
values that should go together will be contiguous on the disk.
<a 
 id="x1-200001r270"></a>
<h3 class="sectionHead"><span class="titlemark">9.5   </span> <a 
 id="x1-2010005"></a>Schematic of Divide and Conquer</h3>
<!--l. 227--><p class="noindent" ><hr class="figure"><div class="figure" 
>
                                                                                         
                                                                                         
<a 
 id="x1-2010016"></a>
                                                                                         
                                                                                         
<!--l. 229--><p class="noindent" >
<br /> <div class="caption" 
><span class="id">Figure&#x00A0;9.6: </span><span  
class="content">First Phase: Divide</span></div><!--tex4ht:label?: x1-2010016 -->
                                                                                         
                                                                                         
<!--l. 232--><p class="noindent" ></div><hr class="endfigure">
<!--l. 233--><p class="indent" >    From fig <a 
href="#x1-2010016">9.6<!--tex4ht:ref: hashpartition --></a> we will see how it uses buffers in memory to achieve the phases.
<!--l. 235--><p class="indent" >    From the original relation, we read off, one page at a time and use a single input
buffer in memory to hold one page of the input file at a time. We use <tspan font-family="cmmi" font-size="12">B </tspan><tspan font-family="cmsy" font-size="10">- </tspan><tspan font-family="cmr" font-size="12">1 </tspan>buffers in
memory to hold the output buffers that will generate <tspan font-family="cmmi" font-size="12">B </tspan><tspan font-family="cmsy" font-size="10">- </tspan><tspan font-family="cmr" font-size="12">1 </tspan>partitions on a scratch disk.
<br 
class="newline" />Procedure:
      <ul class="itemize1">
      <li class="itemize">For each record on the input page, we use <tspan font-family="cmmi" font-size="12">h</tspan><sub><tspan font-family="cmmi" font-size="8">p</tspan></sub> to determine which output buffer to put
      the record into. <tspan font-family="cmmi" font-size="12">h</tspan><sub><tspan font-family="cmmi" font-size="8">p</tspan></sub> is <tspan font-family="cmmi" font-size="12">B</tspan><tspan font-family="cmr" font-size="12">%</tspan><tspan font-family="cmmi" font-size="12">B </tspan><tspan font-family="cmsy" font-size="10">- </tspan><tspan font-family="cmr" font-size="12">1</tspan>. All records with the same value will go to the same
      output partition.
      </li>
      <li class="itemize">As an output buffer fills, we write it to the disk. As the input buffer empties we read a
      new page from the disk. So the output buffers spill into the output partitions that are
      sequentially on the disk.</li></ul>
<!--l. 248--><p class="noindent" ><hr class="figure"><div class="figure" 
><a 
 id="x1-2010027"></a>
<br /> <div class="caption" 
><span class="id">Figure&#x00A0;9.7: </span><span  
class="content">Second phase: partition</span></div><!--tex4ht:label?: x1-2010027 -->
<!--l. 253--><p class="indent" >    </div><hr class="endfigure">
<!--l. 254--><p class="indent" >    In the <tspan font-family="ecbx" font-size="1200">conquer </tspan>phase, (figure <a 
href="#x1-2010027">9.7<!--tex4ht:ref: hashpartitionconquer --></a>). We read in one partition at a time into memory
,forming a RAM based hash table. As we&#8217;re reading in the pages of the partition, we&#8217;re
running a hash function on each tuple and filling in this in memory hash table which we
assume for the moment is no bigger than B pages. (if it is bigger we need to do smth
special).
<!--l. 259--><p class="indent" >    After generating the hash table, we look at the table bucket by bucket, reading out the
contents of bucket and writing the to disk, making suer that the same values are all contiguous on
disk.
<!--l. 262--><p class="indent" >    In the first phase we ensured all values that are the same are in the same partition. In this
second phase, we can guarantee that all values that are the same are in the same <tspan font-family="ecbx" font-size="1200">bucket</tspan>. As we
write each bucket out, each bucket is sufficient to guarantee all the same values are <tspan font-family="ecbx" font-size="1200">contiguous on</tspan>
<tspan font-family="ecbx" font-size="1200">disk</tspan>.
<a 
 id="x1-201003r276"></a>
<h3 class="sectionHead"><span class="titlemark">9.6   </span> <a 
 id="x1-2020006"></a>Cost of External Hashing</h3>
<!--l. 267--><p class="noindent" ><tspan font-family="ecbx" font-size="1200">Cost</tspan>
    <table 
class="equation-star"><tr><td>
    <center class="math-display" >
<img 
src="CS186Main42x.png" alt="cost = 2 * N (#passes ) = 4 * N IO &#8217;s(includes initial read, final write)
" class="math-display" ></center></td></tr></table>
<!--l. 271--><p class="nopar" >
<hr class="figure"><div class="figure" 
>
                                                                                         
                                                                                         
<a 
 id="x1-2020018"></a>
                                                                                         
                                                                                         
<!--l. 274--><p class="noindent" >
<br /> <div class="caption" 
><span class="id">Figure&#x00A0;9.8: </span><span  
class="content">Putting the two phases together</span></div><!--tex4ht:label?: x1-2020018 -->
                                                                                         
                                                                                         
<!--l. 276--><p class="indent" >    </div><hr class="endfigure">
<a 
 id="x1-202002r271"></a>
<h4 class="subsectionHead"><span class="titlemark">9.6.1   </span> <a 
 id="x1-2030001"></a>Memory requirement</h4>
<!--l. 278--><p class="noindent" >How big of a table can we hash in two passes?
      <ul class="itemize1">
      <li class="itemize">In the first phase we generate B-1 "partitions"
      </li>
      <li class="itemize">Each should be no more than B pages in size.
      </li>
      <li class="itemize"><tspan font-family="ecbx" font-size="1200">Answer</tspan>: <tspan font-family="cmmi" font-size="12">B</tspan><tspan font-family="cmr" font-size="12">(</tspan><tspan font-family="cmmi" font-size="12">B </tspan><tspan font-family="cmsy" font-size="10">- </tspan><tspan font-family="cmr" font-size="12">1)</tspan>. We can hash a table of size N pages in about <tspan font-family="cmmi" font-size="12">B </tspan><tspan font-family="cmr" font-size="12">=</tspan> <img 
src="CS186Main43x.png" alt="&#x221A;N---"  class="sqrt" > space. <br 
class="newline" />Note: this assumes that the hash function distributes records evenly.</li></ul>
<!--l. 286--><p class="indent" >    If one of our partitions is too large because our one of our has func does not distribute records
evenly, we will need to <tspan font-family="ecbx" font-size="1200">recursively partition</tspan>.
<a 
 id="x1-203001r279"></a>
<h3 class="sectionHead"><span class="titlemark">9.7   </span> <a 
 id="x1-2040007"></a>Recursive Partitioning</h3>
    <div class="newtheorem">
<!--l. 289--><p class="noindent" ><span class="head">
<tspan font-family="ecbx" font-size="1200">Definition</tspan><tspan font-family="ecbx" font-size="1200">&#x00A0;9.5</tspan> </span><tspan font-family="ecti" font-size="1200">Partition: a section of a storage device, such as a hard disk drive or solid</tspan>
<tspan font-family="ecti" font-size="1200">state drive. It is treated by the operating system as a separate logical volume, which makes it</tspan>
<tspan font-family="ecti" font-size="1200">function similar to a separate physical device</tspan>
    </div>
<!--l. 294--><p class="noindent" >We can detect the need for recursive partitioning when we generate a partition that is <tspan font-family="cmmi" font-size="12">&#x003E; </tspan><tspan font-family="cmr" font-size="12">(</tspan><tspan font-family="cmmi" font-size="12">B </tspan><tspan font-family="cmsy" font-size="10">- </tspan><tspan font-family="cmr" font-size="12">1) </tspan>big in
phase 1, but we deal with it in phase 2.
<!--l. 296--><p class="indent" >    We do two things in phase 2 to fix this issue. (1)One is <tspan font-family="ecbx" font-size="1200">recursively sub partition it </tspan>into its
own partitions. You do this with a new independent hash function <img 
src="CS186Main44x.png" alt="hhhppp111"  class="mathpalette" > otherwise we would just get
the same partition again. (2) We then do the conquer phase to generate output partitions that are
contiguous on equal values.
<!--l. 300--><p class="indent" >    When we are done with that recursive phase and pop out, we have essentially hashed the first
of our partition into one big output partition that is contiguous for all equal values. We can then
move on to the next partition from the outer part of phase 2. <hr class="figure"><div class="figure" 
>
                                                                                         
                                                                                         
<a 
 id="x1-2040029"></a>
                                                                                         
                                                                                         
<!--l. 305--><p class="noindent" >
<br /> <div class="caption" 
><span class="id">Figure&#x00A0;9.9: </span><span  
class="content">Recursive Partition</span></div><!--tex4ht:label?: x1-2040029 -->
                                                                                         
                                                                                         
<!--l. 307--><p class="indent" >    </div><hr class="endfigure">
<a 
 id="x1-204003r282"></a>
<h3 class="sectionHead"><span class="titlemark">9.8   </span> <a 
 id="x1-2050008"></a>Deal with duplicates</h3>
<!--l. 309--><p class="noindent" >Consider a dataset with a very frequent key, (consider a big table with a gender column of male,
female and other).
<!--l. 311--><p class="indent" >    During recursive partitioning, we only get 3 buckets that are nonempty. In such a case where
we have to recursively partition, no matter how deep we go in the recursion, we will
always end up with one bucket that has all the m&#8217;s as they will always hash to the same
bucket.
<!--l. 315--><p class="indent" >    We need a case that will catch this case so that the algorithm will stop the recursive partition
and just add it to the output.
<a 
 id="x1-205001r284"></a>
<h3 class="sectionHead"><span class="titlemark">9.9   </span> <a 
 id="x1-2060009"></a>Performance of external hashing and external sorting</h3>
<a 
 id="x1-206001r281"></a>
<h4 class="subsectionHead"><span class="titlemark">9.9.1   </span> <a 
 id="x1-2070001"></a>Cost of External Hashing</h4>
<!--l. 319--><p class="noindent" ><hr class="figure"><div class="figure" 
>
                                                                                         
                                                                                         
<a 
 id="x1-20700110"></a>
                                                                                         
                                                                                         
<!--l. 321--><p class="noindent" >
<br /> <div class="caption" 
><span class="id">Figure&#x00A0;9.10: </span><span  
class="content">Schematic of External Hashing</span></div><!--tex4ht:label?: x1-20700110 -->
                                                                                         
                                                                                         
<!--l. 323--><p class="noindent" ></div><hr class="endfigure">
<!--l. 324--><p class="indent" >    Process:
      <ul class="itemize1">
      <li class="itemize">Read in the input
      </li>
      <li class="itemize">Partition it
      </li>
      <li class="itemize">write that ouput
      </li>
      <li class="itemize">Read in each partition
      </li>
      <li class="itemize">Conquer it by building a second hash table
      </li>
      <li class="itemize">Write to output</li></ul>
<img 
src="CS186Main46x.png" alt="picture" >
<a 
 id="x1-207002r286"></a>
<h4 class="subsectionHead"><span class="titlemark">9.9.2   </span> <a 
 id="x1-2080002"></a>Cost of External Sorting</h4>
<!--l. 339--><p class="noindent" ><hr class="figure"><div class="figure" 
>
                                                                                         
                                                                                         
<a 
 id="x1-20800111"></a>
                                                                                         
                                                                                         
<!--l. 341--><p class="noindent" >
<br /> <div class="caption" 
><span class="id">Figure&#x00A0;9.11: </span><span  
class="content">Schematic for external sorting. Notice that it is basically the hashing flipped
around</span></div><!--tex4ht:label?: x1-20800111 -->
                                                                                         
                                                                                         
<!--l. 344--><p class="noindent" ></div><hr class="endfigure">
<!--l. 345--><p class="indent" >    Process:
      <ul class="itemize1">
      <li class="itemize">In phase 1:
           <ul class="itemize2">
           <li class="itemize">We read in B blocks
           </li>
           <li class="itemize">Conquer it by sorting it
           </li>
           <li class="itemize">write out the run
           </li>
           <li class="itemize">Do it again</li></ul>
      </li>
      <li class="itemize">In the merge phase:
           <ul class="itemize2">
           <li class="itemize">Do opposite of divide
           </li>
           <li class="itemize">put the runs together through merge to generate sorted output</li></ul>
      </li></ul>
<!--l. 360--><p class="noindent" >Read in input nd write out the output in pass 0. Then read the results and merge them when we write
them in the output. This is approximately 4N in size.
<img 
src="CS186Main48x.png" alt="picture" >
<a 
 id="x1-208002r288"></a>
                                                                                         
                                                                                         
<h4 class="subsectionHead"><span class="titlemark">9.9.3   </span> <a 
 id="x1-2090003"></a>Compare</h4>
<!--l. 368--><p class="noindent" >Hashing and sorting are very similar in terms of their I/O behavior. They even do the
same number of random I/O and same number of sequential I/O&#8217;s, just in different
phases.
<a 
 id="x1-209001r285"></a>
<h3 class="sectionHead"><span class="titlemark">9.10   </span> <a 
 id="x1-21000010"></a>Parallelize me! Hashing Phase 1</h3>
<!--l. 372--><p class="noindent" >What we do in a parallel system is very similar to how we use memory in our divide and conquer
techniques as well as our out of core algorithms. <hr class="figure"><div class="figure" 
>
                                                                                         
                                                                                         
<a 
 id="x1-21000112"></a>
                                                                                         
                                                                                         
<!--l. 376--><p class="noindent" >
<br /> <div class="caption" 
><span class="id">Figure&#x00A0;9.12: </span><span  
class="content">Represent multiple computers connected by a high speed network.</span></div><!--tex4ht:label?: x1-21000112 -->
                                                                                         
                                                                                         
<!--l. 379--><p class="indent" >    </div><hr class="endfigure">
<!--l. 380--><p class="indent" >    From figure <a 
href="#x1-21000112">9.12<!--tex4ht:ref: parallelizehashing --></a> we are representing each row as a computer where the rectangle is the
rectangle is the memory and the disk is the disk. Because they are connected, we can send data
from the disk of one computer to the memory of another.
<!--l. 383--><p class="indent" >    We introduce a new hash function <tspan font-family="cmr" font-size="12">(</tspan><tspan font-family="cmmi" font-size="12">h</tspan><sub><tspan font-family="cmmi" font-size="8">n</tspan></sub><tspan font-family="cmr" font-size="12">) </tspan>which is mod # of computers in then network. So the
function will produce the index of one of the computers. This hash function partitions the data
across the machines. When we are done with this phase, if two records are the same, then
the hash values are the same and they are on the same machine after the first hashing
phase.
<!--l. 388--><p class="indent" >    The rest of the <hr class="figure"><div class="figure" 
>
                                                                                         
                                                                                         
<a 
 id="x1-21000213"></a>
                                                                                         
                                                                                         
<!--l. 391--><p class="noindent" >
<br /> <div class="caption" 
><span class="id">Figure&#x00A0;9.13: </span><span  
class="content">Phase 2</span></div><!--tex4ht:label?: x1-21000213 -->
                                                                                         
                                                                                         
<!--l. 393--><p class="indent" >    </div><hr class="endfigure">
<!--l. 394--><p class="indent" >    The rest is the same as the hashing we have learned: You take the data as it streams in
Partition it using <tspan font-family="cmmi" font-size="12">h</tspan><sub><tspan font-family="cmmi" font-size="8">p</tspan></sub> into partitions Store it on disk. In the conquer phase, we pick up each
partition, put it in the main memory hash table, and send to output.
<!--l. 397--><p class="indent" >    We only do one scan of the entire dataset in parallel across all the machines. In the middle,
we do one pass of the data to write it across all the machines in parallel to create the
partitions using <tspan font-family="cmmi" font-size="12">h</tspan><sub><tspan font-family="cmmi" font-size="8">p</tspan></sub>. We then read from all the machines in parallel to do the local reads
into the hash tables and then write across all the machines to write out the hashed
runs.
<!--l. 402--><p class="indent" >    Cost: We are still doing the same <tspan font-family="cmr" font-size="12">4 </tspan><tspan font-family="cmsy" font-size="10">* </tspan><tspan font-family="cmmi" font-size="12">N</tspan>I/O&#8217;s, 2 for the first phase, and 2 for the second.
ALthough the I/O is the same, we are parallelizing it across N computers so we are doing it N
times faster.
<a 
 id="x1-210003r291"></a>
<h3 class="sectionHead"><span class="titlemark">9.11   </span> <a 
 id="x1-21100011"></a>Parallelize me! Sorting</h3>
<!--l. 406--><p class="noindent" >Parallelizing sorting is similar to parallelizing sorting. We shuffle data across the network so each
machine can get data to sort without further coordination with other machines.
<!--l. 409--><p class="indent" >    The difference between this and hashing is how we partition the data. In pass 0, we figure out
which machine to send the data to and the machine will put it into its buffer. The rest is the same
as before, we sort it in memory, write it to disk and then request another b blocks of data from the
inputs.
<!--l. 413--><p class="indent" >    The problem with this that we do not in hashing is figuring how the ranges we chose for each
machine is approximately the same. The answer is to get the distribution of the values to figure out
where to split.
<a 
 id="x1-211001r294"></a>
<h3 class="sectionHead"><span class="titlemark">9.12   </span> <a 
 id="x1-21200012"></a>So which is better?</h3>
<!--l. 417--><p class="noindent" >They have the same memory requirement for 2 passes and have same I/O costs. <div class="table">
                                                                                         
                                                                                         
<!--l. 418--><p class="indent" >    <hr class="float"><div class="float" 
>
                                                                                         
                                                                                         
<div class="tabular"> <table id="TBL-13" class="tabular" 
cellspacing="0" cellpadding="0"  
><colgroup id="TBL-13-1g"><col 
id="TBL-13-1"></colgroup><colgroup id="TBL-13-2g"><col 
id="TBL-13-2"></colgroup><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-13-1-"><td  style="white-space:wrap; text-align:left;" id="TBL-13-1-1"  
class="td11"><!--l. 422--><p class="noindent" >Hashing pros:                                          </td><td  style="white-space:wrap; text-align:left;" id="TBL-13-1-2"  
class="td11"><!--l. 422--><p class="noindent" >Sorting pros                                            </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-13-2-"><td  style="white-space:wrap; text-align:left;" id="TBL-13-2-1"  
class="td11"><!--l. 425--><p class="noindent" >For  duplicate  elimination,  scales  with  the
number of distinct values, not with the number
of rows in the data. In the first phase, if we
see a value more than once, we don&#8217;t add it
to the bucket again so in the second phase, all
the duplicates are removed.                         </td><td  style="white-space:wrap; text-align:left;" id="TBL-13-2-2"  
class="td11"><!--l. 428--><p class="noindent" >Great if we need output to be sorted anyways.
Sorting scales with the number of records.     </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-13-3-"><td  style="white-space:wrap; text-align:left;" id="TBL-13-3-1"  
class="td11"><!--l. 431--><p class="noindent" >Easy to shuffle equally in parallel case           </td><td  style="white-space:wrap; text-align:left;" id="TBL-13-3-2"  
class="td11"><!--l. 431--><p class="noindent" >Not  sensitive  to  duplicates  or  "bad"  hash
functions.  We  don&#8217;t  need  a  special  case  to
handle duplicate values. We just sort them.   </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-13-4-"><td  style="white-space:wrap; text-align:left;" id="TBL-13-4-1"  
class="td11">                                       </td></tr></table></div>
                                                                                         
                                                                                         
    </div><hr class="endfloat" />
    </div>
<a 
 id="x1-212001r295"></a>
<h3 class="sectionHead"><span class="titlemark">9.13   </span> <a 
 id="x1-21300013"></a>Summary</h3>
<!--l. 437--><p class="noindent" >The most important thing to note is the <tspan font-family="ecbx" font-size="1200">duality of sorting and hahsing</tspan>.
      <ul class="itemize1">
      <li class="itemize">Hashing: Divide &amp; Conquer
      </li>
      <li class="itemize">Sorting: Conquer &amp; Merge</li></ul>
<!--l. 442--><p class="indent" >    Sorting is overkill for rendezvous like if we just wanted to group the same values together but
if we need to sort through all the values anyways, it will be good.
<!--l. 444--><p class="indent" >    Any streaming phase in the algorithm can benefit from double buffering by hiding the latency
of I/O behind CPU work.
                                                                                         
                                                                                         
                                                                                         
                                                                                         
                                                                                         
                                                                                         
    <h2 class="chapterHead"><span class="titlemark">Chapter&#x00A0;10</span><br /><a 
 id="x1-21400010"></a>Module 6</h2>
<!--l. 2--><p class="noindent" >Implementation that can be run is an iterator.
<!--l. 3--><p class="indent" >    The way to think about it is that every input to a relational operator is a relation and every
output of a relational operator is a relation. <hr class="figure"><div class="figure" 
>
                                                                                         
                                                                                         
                                                                                         
                                                                                         
<!--l. 7--><p class="noindent" >
                                                                                         
                                                                                         
<!--l. 8--><p class="indent" >    </div><hr class="endfigure">
<a 
 id="x1-214001r296"></a>
<h3 class="sectionHead"><span class="titlemark">10.1   </span> <a 
 id="x1-2150001"></a>Query Executor instantiates Operators</h3>
<!--l. 10--><p class="noindent" >Query optimizer selects operators to run and the executor executes the operators. <br 
class="newline" />Each operator instance:
      <ul class="itemize1">
      <li class="itemize">Implements <tspan font-family="ecbx" font-size="1200">iterator interface</tspan>
      </li>
      <li class="itemize">efficiently executes operator logic forwarding tuples to next operator</li></ul>
<!--l. 16--><p class="noindent" >From the graph, each operator instances, implements the iterator interface.
<a 
 id="x1-215001r298"></a>
<h3 class="sectionHead"><span class="titlemark">10.2   </span> <a 
 id="x1-2160002"></a>Iterator interface</h3>
<!--l. 18--><p class="noindent" >The relational operators implemented as subclasses of the class iterator: <!--l. 19-->
<div class="lstlisting" id="listing-42"><span class="label"><a 
 id="x1-216001r1"></a><tspan font-family="ecrm" font-size="0600">1</tspan></span><tspan font-family="ecrm" font-size="1000">abstract</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">class</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">iterator</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">{</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-216002r2"></a><tspan font-family="ecrm" font-size="0600">2</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">void</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">setup</tspan><tspan font-family="ecrm" font-size="1000">(</tspan><tspan font-family="ecrm" font-size="1000">List</tspan><tspan font-family="ecrm" font-size="1000">&#x003C;</tspan><tspan font-family="ecrm" font-size="1000">iterator</tspan><tspan font-family="ecrm" font-size="1000">&#x003E;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">inputs</tspan><tspan font-family="ecrm" font-size="1000">)</tspan><tspan font-family="ecrm" font-size="1000">;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-216003r3"></a><tspan font-family="ecrm" font-size="0600">3</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">void</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">init</tspan><tspan font-family="ecrm" font-size="1000">(</tspan><tspan font-family="ecrm" font-size="1000">args</tspan><tspan font-family="ecrm" font-size="1000">)</tspan><tspan font-family="ecrm" font-size="1000">;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-216004r4"></a><tspan font-family="ecrm" font-size="0600">4</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">tuple</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">next</tspan><tspan font-family="ecrm" font-size="1000">()</tspan><tspan font-family="ecrm" font-size="1000">;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-216005r5"></a><tspan font-family="ecrm" font-size="0600">5</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">void</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">close</tspan><tspan font-family="ecrm" font-size="1000">()</tspan><tspan font-family="ecrm" font-size="1000">;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-216006r6"></a><tspan font-family="ecrm" font-size="0600">6</tspan></span><tspan font-family="ecrm" font-size="1000">}</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-216007r7"></a><tspan font-family="ecrm" font-size="0600">7</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan>
    </div>
      <ul class="itemize1">
      <li class="itemize"><tspan font-family="ecbx" font-size="1200">Setup</tspan>: constructs data flow graph. Tells iterator who its children are. The next three
      are the ones that define the implementation of the graph and they are specific for each
      operator that we are going to initialize.
      </li>
      <li class="itemize"><tspan font-family="ecbx" font-size="1200">Init</tspan>: Sets up any state we will need while running iterator
      </li>
      <li class="itemize"><tspan font-family="ecbx" font-size="1200">next</tspan>: returns a single tuple from the iterator.
      </li>
      <li class="itemize"><tspan font-family="ecbx" font-size="1200">Close</tspan>: closes the iterator</li></ul>
<!--l. 35--><p class="noindent" ><tspan font-family="ecbx" font-size="1200">Notes</tspan>: This is a <tspan font-family="ecbx" font-size="1200">pull-based </tspan>computation model. If there is a client, it can call <tspan font-family="ecbx" font-size="1200">init </tspan>on the root on one
of the iterator trees and it will recursively pass the call on the children. It then returns to the
parent (console) which will then call next at the top of the tree to ask for a tuple. If there is none
ready, it will then recursively call children. When the root is ready, it will return to the caller. This
happens in a single thread.
<!--l. 41--><p class="indent" >    Init/next can result in either streaming ("on-the-fly") or blocking ("batch") algorithm:
      <ul class="itemize1">
      <li class="itemize">streaming: small, constant amount of work per call. For every call to next or init, a
      small constant work is done. So there is a constant flow of data.
      </li>
      <li class="itemize">blocking: does not produce output until it consumes its entire input. If you call next, it
      will itself call next on its child over and over until it gets all the data from its children.
      And then returns the first row of outputs.</li></ul>
                                                                                         
                                                                                         
<!--l. 50--><p class="indent" >    Iterators are <tspan font-family="ecbx" font-size="1200">encapsulated</tspan>. The methods do not need to know what subclass of iterators or
relational operators are being implemented. This allow sus to mix and match relational operators
however we like.
<!--l. 53--><p class="indent" >    Iterators may also contain substantial "internal" <tspan font-family="ecbx" font-size="1200">states</tspan>. They don&#8217;t share with other
iterators. Example states are partitions for sorting. SO they could be big or small.<div class="mdframed" id="mdframed-3">
<!--l. 57-->
<div class="lstlisting" id="listing-43"><span class="label"><a 
 id="x1-216008r1"></a><tspan font-family="ecrm" font-size="0600">1</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">init</tspan><tspan font-family="ecrm" font-size="1000">(</tspan><tspan font-family="ecrm" font-size="1000">relation</tspan><tspan font-family="ecrm" font-size="1000">)</tspan><tspan font-family="ecrm" font-size="1000">:</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-216009r2"></a><tspan font-family="ecrm" font-size="0600">2</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">heap</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">=</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">open</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">heap</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">file</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">for</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">this</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">relation</tspan><tspan font-family="ecrm" font-size="1000">;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-216010r3"></a><tspan font-family="ecrm" font-size="0600">3</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">cur_page</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">=</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">heap</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">first_page</tspan><tspan font-family="ecrm" font-size="1000">()</tspan><tspan font-family="ecrm" font-size="1000">;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">//</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">first</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">page</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-216011r4"></a><tspan font-family="ecrm" font-size="0600">4</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">cur_slot</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">=</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">cur_page</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">first_slot</tspan><tspan font-family="ecrm" font-size="1000">()</tspan><tspan font-family="ecrm" font-size="1000">;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">//</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">first</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">slot</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">on</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">that</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">page</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-216012r5"></a><tspan font-family="ecrm" font-size="0600">5</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">next</tspan><tspan font-family="ecrm" font-size="1000">()</tspan><tspan font-family="ecrm" font-size="1000">:</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-216013r6"></a><tspan font-family="ecrm" font-size="0600">6</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">if</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">(</tspan><tspan font-family="ecrm" font-size="1000">cur_page</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">==</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">NULL</tspan><tspan font-family="ecrm" font-size="1000">)</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">return</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">EOF</tspan><tspan font-family="ecrm" font-size="1000">;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">//</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">End</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">Of</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">Fun</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-216014r7"></a><tspan font-family="ecrm" font-size="0600">7</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">current</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">=</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">[</tspan><tspan font-family="ecrm" font-size="1000">cur_page</tspan><tspan font-family="ecrm" font-size="1000">,</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">cur_slot</tspan><tspan font-family="ecrm" font-size="1000">];</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">//</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">we</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">will</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">return</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">this</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">recordId</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-216015r8"></a><tspan font-family="ecrm" font-size="0600">8</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">//</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">advance</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">the</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">slot</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-216016r9"></a><tspan font-family="ecrm" font-size="0600">9</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">cur_slot</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">=</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">cur_slot</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">next</tspan><tspan font-family="ecrm" font-size="1000">()</tspan><tspan font-family="ecrm" font-size="1000">;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-216017r10"></a><tspan font-family="ecrm" font-size="0600">10</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">if</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">(</tspan><tspan font-family="ecrm" font-size="1000">cur_slot</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">==</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">NULL</tspan><tspan font-family="ecrm" font-size="1000">)</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">{</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-216018r11"></a><tspan font-family="ecrm" font-size="0600">11</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">//</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">advance</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">to</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">next</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">page</tspan><tspan font-family="ecrm" font-size="1000">,</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">first</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">slot</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-216019r12"></a><tspan font-family="ecrm" font-size="0600">12</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">cur_page</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">=</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">cur_page</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">next</tspan><tspan font-family="ecrm" font-size="1000">()</tspan><tspan font-family="ecrm" font-size="1000">;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-216020r13"></a><tspan font-family="ecrm" font-size="0600">13</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">if</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">(</tspan><tspan font-family="ecrm" font-size="1000">cur_page</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">!=</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">NULL</tspan><tspan font-family="ecrm" font-size="1000">)</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-216021r14"></a><tspan font-family="ecrm" font-size="0600">14</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">cur_slot</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">=</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">cur_page</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">first_slot</tspan><tspan font-family="ecrm" font-size="1000">()</tspan><tspan font-family="ecrm" font-size="1000">;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-216022r15"></a><tspan font-family="ecrm" font-size="0600">15</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">}</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-216023r16"></a><tspan font-family="ecrm" font-size="0600">16</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">return</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">current</tspan><tspan font-family="ecrm" font-size="1000">;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-216024r17"></a><tspan font-family="ecrm" font-size="0600">17</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">close</tspan><tspan font-family="ecrm" font-size="1000">()</tspan><tspan font-family="ecrm" font-size="1000">:</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-216025r18"></a><tspan font-family="ecrm" font-size="0600">18</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">heap</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">close</tspan><tspan font-family="ecrm" font-size="1000">()</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-216026r19"></a><tspan font-family="ecrm" font-size="0600">19</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan>
</div>
<!--l. 77--><p class="noindent" ><tspan font-family="ecbx" font-size="1200">Example:Heap Scan</tspan>
<!--l. 77--><p class="noindent" >____
________
    </div><div class="mdframed" id="mdframed-4">
<!--l. 79-->
<div class="lstlisting" id="listing-44"><span class="label"><a 
 id="x1-216027r1"></a><tspan font-family="ecrm" font-size="0600">1</tspan></span><tspan font-family="ecrm" font-size="1000">init</tspan><tspan font-family="ecrm" font-size="1000">(</tspan><tspan font-family="ecrm" font-size="1000">keys</tspan><tspan font-family="ecrm" font-size="1000">)</tspan><tspan font-family="ecrm" font-size="1000">:</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">//</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">all</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">of</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">pass</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">0</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">in</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">init</tspan><tspan font-family="ecrm" font-size="1000">,</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">a</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">blocking</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">call</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-216028r2"></a><tspan font-family="ecrm" font-size="0600">2</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">child</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">init</tspan><tspan font-family="ecrm" font-size="1000">()</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-216029r3"></a><tspan font-family="ecrm" font-size="0600">3</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">repeatedly</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">call</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">child</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">next</tspan><tspan font-family="ecrm" font-size="1000">()</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">and</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">generate</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">the</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">sorted</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">runs</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">on</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">disk</tspan><tspan font-family="ecrm" font-size="1000">,</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">until</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">child</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">gives</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">EOF</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-216030r4"></a><tspan font-family="ecrm" font-size="0600">4</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">//</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">set</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">up</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">for</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">pass</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">1,</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">assumes</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">enough</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">buffers</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">to</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">merge</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-216031r5"></a><tspan font-family="ecrm" font-size="0600">5</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">open</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">each</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">sorted</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">run</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">file</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">and</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">load</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">into</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">input</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">buffer</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">for</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">pass</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">1</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-216032r6"></a><tspan font-family="ecrm" font-size="0600">6</tspan></span><tspan font-family="ecrm" font-size="1000">next</tspan><tspan font-family="ecrm" font-size="1000">()</tspan><tspan font-family="ecrm" font-size="1000">:</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">//</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">pass</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">1</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">(</tspan><tspan font-family="ecrm" font-size="1000">assumes</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">enough</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">buffers</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">to</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">merge</tspan><tspan font-family="ecrm" font-size="1000">)</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-216033r7"></a><tspan font-family="ecrm" font-size="0600">7</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">output</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">=</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">min</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">tuple</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">across</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">all</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">buffers</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-216034r8"></a><tspan font-family="ecrm" font-size="0600">8</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">if</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">min</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">tuple</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">was</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">last</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">one</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">in</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">its</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">buffer</tspan><tspan font-family="ecrm" font-size="1000">,</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">fetch</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">next</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">page</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">from</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">that</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">run</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">into</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">buffer</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-216035r9"></a><tspan font-family="ecrm" font-size="0600">9</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">return</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">output</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">(</tspan><tspan font-family="ecrm" font-size="1000">or</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">EOF</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="cmsy" font-size="10">--</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">"</tspan><tspan font-family="ecrm" font-size="1000">End</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">of</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">Fun</tspan><tspan font-family="ecrm" font-size="1000">"</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="cmsy" font-size="10">--</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">if</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">no</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">tuples</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">remain</tspan><tspan font-family="ecrm" font-size="1000">)</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-216036r10"></a><tspan font-family="ecrm" font-size="0600">10</tspan></span><tspan font-family="ecrm" font-size="1000">close</tspan><tspan font-family="ecrm" font-size="1000">()</tspan><tspan font-family="ecrm" font-size="1000">:</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-216037r11"></a><tspan font-family="ecrm" font-size="0600">11</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">deallocate</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">the</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">runs</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">files</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-216038r12"></a><tspan font-family="ecrm" font-size="0600">12</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">child</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">close</tspan><tspan font-family="ecrm" font-size="1000">()</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-216039r13"></a><tspan font-family="ecrm" font-size="0600">13</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan>
</div>
<!--l. 93--><p class="noindent" >It setups for pass 1 by reading one page from each sorted run file that it generated and loading it
into an input buffer. At the end of the init call, pass 1 is already in memeory and is
ready to be sent to the output. The <tspan font-family="ecbx" font-size="1200">next </tspan>call, will pull tuples through the merge (pass
1).
<!--l. 97--><p class="noindent" ><tspan font-family="ecbx" font-size="1200">Example:Sort (2-pass)</tspan>
<!--l. 97--><p class="noindent" >____
________
    </div><div class="mdframed" id="mdframed-5">
<!--l. 99--><p class="noindent" >This example is an implementation of group by that assumes sorted input. It requires that the
optimizer to make sure the input is sorted. <!--l. 101-->
<div class="lstlisting" id="listing-45"><span class="label"><a 
 id="x1-216040r1"></a><tspan font-family="ecrm" font-size="0600">1</tspan></span><tspan font-family="ecrm" font-size="1000">init</tspan><tspan font-family="ecrm" font-size="1000">(</tspan><tspan font-family="ecrm" font-size="1000">group_keys</tspan><tspan font-family="ecrm" font-size="1000">,</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">aggs</tspan><tspan font-family="ecrm" font-size="1000">)</tspan><tspan font-family="ecrm" font-size="1000">:</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-216041r2"></a><tspan font-family="ecrm" font-size="0600">2</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">child</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">init</tspan><tspan font-family="ecrm" font-size="1000">()</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-216042r3"></a><tspan font-family="ecrm" font-size="0600">3</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">cur_group</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">=</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">NULL</tspan><tspan font-family="ecrm" font-size="1000">;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-216043r4"></a><tspan font-family="ecrm" font-size="0600">4</tspan></span><tspan font-family="ecrm" font-size="1000">next</tspan><tspan font-family="ecrm" font-size="1000">()</tspan><tspan font-family="ecrm" font-size="1000">:</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-216044r5"></a><tspan font-family="ecrm" font-size="0600">5</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">result</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">=</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">NULL</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-216045r6"></a><tspan font-family="ecrm" font-size="0600">6</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">do</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">{</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-216046r7"></a><tspan font-family="ecrm" font-size="0600">7</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">tup</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">=</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">child</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">next</tspan><tspan font-family="ecrm" font-size="1000">()</tspan><tspan font-family="ecrm" font-size="1000">;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-216047r8"></a><tspan font-family="ecrm" font-size="0600">8</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">if</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">(</tspan><tspan font-family="ecrm" font-size="1000">group</tspan><tspan font-family="ecrm" font-size="1000">(</tspan><tspan font-family="ecrm" font-size="1000">tup</tspan><tspan font-family="ecrm" font-size="1000">)</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">!=</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">cur_group</tspan><tspan font-family="ecrm" font-size="1000">)</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">{</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">//</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">New</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">group</tspan><tspan font-family="ecrm" font-size="1000">!</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-216048r9"></a><tspan font-family="ecrm" font-size="0600">9</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">if</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">(</tspan><tspan font-family="ecrm" font-size="1000">cur_group</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">!=</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">NULL</tspan><tspan font-family="ecrm" font-size="1000">)</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">//</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">Form</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">a</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">result</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">for</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">current</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">group</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-216049r10"></a><tspan font-family="ecrm" font-size="0600">10</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">result</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">=</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">[</tspan><tspan font-family="ecrm" font-size="1000">cur_group</tspan><tspan font-family="ecrm" font-size="1000">,</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">final</tspan><tspan font-family="ecrm" font-size="1000">()</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">of</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">all</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">aggs</tspan><tspan font-family="ecrm" font-size="1000">]</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">//</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">ready</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">to</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">form</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">because</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">we</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">have</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">seen</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-216050r11"></a><tspan font-family="ecrm" font-size="0600">11</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">tuple</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">that</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">is</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">different</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">form</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">the</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">current</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">group</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">Use</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">the</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">final</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">method</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">on</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">all</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">the</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-216051r12"></a><tspan font-family="ecrm" font-size="0600">12</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">aggregation</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">functions</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">in</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">our</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">select</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">list</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-216052r13"></a><tspan font-family="ecrm" font-size="0600">13</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">cur_group</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">=</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">group</tspan><tspan font-family="ecrm" font-size="1000">(</tspan><tspan font-family="ecrm" font-size="1000">tup</tspan><tspan font-family="ecrm" font-size="1000">)</tspan><tspan font-family="ecrm" font-size="1000">;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-216053r14"></a><tspan font-family="ecrm" font-size="0600">14</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">call</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">init</tspan><tspan font-family="ecrm" font-size="1000">()</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">on</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">all</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">the</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">aggs</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-216054r15"></a><tspan font-family="ecrm" font-size="0600">15</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">}</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-216055r16"></a><tspan font-family="ecrm" font-size="0600">16</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">call</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">merge</tspan><tspan font-family="ecrm" font-size="1000">(</tspan><tspan font-family="ecrm" font-size="1000">tup</tspan><tspan font-family="ecrm" font-size="1000">)</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">on</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">all</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">the</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">aggs</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-216056r17"></a><tspan font-family="ecrm" font-size="0600">17</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">}</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">while</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">(!</tspan><tspan font-family="ecrm" font-size="1000">result</tspan><tspan font-family="ecrm" font-size="1000">)</tspan><tspan font-family="ecrm" font-size="1000">;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-216057r18"></a><tspan font-family="ecrm" font-size="0600">18</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">return</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">result</tspan><tspan font-family="ecrm" font-size="1000">;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-216058r19"></a><tspan font-family="ecrm" font-size="0600">19</tspan></span><tspan font-family="ecrm" font-size="1000">close</tspan><tspan font-family="ecrm" font-size="1000">()</tspan><tspan font-family="ecrm" font-size="1000">:</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-216059r20"></a><tspan font-family="ecrm" font-size="0600">20</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">child</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">close</tspan><tspan font-family="ecrm" font-size="1000">()</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-216060r21"></a><tspan font-family="ecrm" font-size="0600">21</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan>
</div>
      <ul class="itemize1">
      <li class="itemize"><tspan font-family="ecbx" font-size="1200">Init</tspan>: takes grouping keys from GROUP BY clause and a list of aggregation functions
      for select list. Recursively calls child.init() and sets the cur_group to null.
      </li>
      <li class="itemize"><tspan font-family="ecbx" font-size="1200">next</tspan>: Fetch enough tuples from the child so that it gets all the tuples with the same
      group by value and then summarize them and send to output. We need to realize there
      are different aggregation functions with different states that they need to maintain.
      <!--l. 131--><p class="noindent" >The loop repeatedly calls <tspan font-family="ectt" font-size="1200">child.next()</tspan>, fetching tuples from the current group until
      it sees one tuple from the next group. At that point it will aggregate the tuples in the
      current group with the final function and then return the result. After,
                                                                                         
                                                                                         
      </li>
      <li class="itemize"><tspan font-family="ecbx" font-size="1200">close</tspan>: Closes the child recursively.</li></ul>
<!--l. 137--><p class="noindent" >This group by algorithm keeps only one tuple in memory at a time and it merges the values from
the tuples into the aggregate function and then fetches another tuple. This is very memory
efficient.
<!--l. 140--><p class="noindent" ><tspan font-family="ecbx" font-size="1200">Example: Group By on Sorted input</tspan>
<!--l. 140--><p class="noindent" >____
________
    </div>
<a 
 id="x1-216061r299"></a>
<h3 class="sectionHead"><span class="titlemark">10.3   </span> <a 
 id="x1-2170003"></a>Full Query Plan</h3>
<!--l. 142--><p class="noindent" >A Query plan is <tspan font-family="ecbx" font-size="1200">Single-threaded </tspan>so there is a thread at the top that calls <tspan font-family="ectt" font-size="1200">init()</tspan>
on the root GroupBy. Then it will repeatedly call <tspan font-family="ectt" font-size="1200">next() </tspan>on the root until it hits the
end of file. Everything that happens below that is happenign below the threat through
recursive calls of <tspan font-family="ectt" font-size="1200">init </tspan>and <tspan font-family="ecbx" font-size="1200">GroupBy</tspan>. Understand how the <tspan font-family="ecbx" font-size="1200">init() </tspan>recurse down the chain
and return. Also, understand how the <tspan font-family="ectt" font-size="1200">next() </tspan>recurse down the chain and return a
tuple.
<!--l. 148--><p class="indent" >    <tspan font-family="ecbx" font-size="1200">Note </tspan>how we don&#8217;t store tuples on disk at the output of every iterator. Rather, the tuples are
passed back through the call stack. Tuples get passed from one iterator to the next from the return
value of <tspan font-family="ectt" font-size="1200">next()</tspan>. For example, <tspan font-family="ecbx" font-size="1200">sort </tspan>will use the disk internally for the runs but the arrows in the
query plans don&#8217;t represent any storage data. They just represent the return of the next call.
<hr class="figure"><div class="figure" 
>
                                                                                         
                                                                                         
<a 
 id="x1-2170011"></a>
                                                                                         
                                                                                         
<!--l. 155--><p class="noindent" >
<br /> <div class="caption" 
><span class="id">Figure&#x00A0;10.1: </span><span  
class="content">Example Query Plan</span></div><!--tex4ht:label?: x1-2170011 -->
                                                                                         
                                                                                         
<!--l. 157--><p class="indent" >    </div><hr class="endfigure">
<a 
 id="x1-217002r300"></a>
<h3 class="sectionHead"><span class="titlemark">10.4   </span> <a 
 id="x1-2180004"></a>Join Operators</h3>
<!--l. 159--><p class="noindent" >In our examples, our schema will have the following notation:
      <ul class="itemize1">
      <li class="itemize"> [R]: the number of pages to store R
      </li>
      <li class="itemize"><tspan font-family="cmmi" font-size="12">p</tspan><sub><tspan font-family="cmmi" font-size="8">R</tspan></sub>: the number of records per page of R
      </li>
      <li class="itemize">|R|: the cardinality (number of records) of R. <tspan font-family="cmsy" font-size="10">|</tspan><tspan font-family="cmmi" font-size="12">R</tspan><tspan font-family="cmsy" font-size="10">| </tspan><tspan font-family="cmr" font-size="12">= </tspan><tspan font-family="cmmi" font-size="12">p</tspan><sub><tspan font-family="cmmi" font-size="8">R</tspan></sub> <tspan font-family="cmsy" font-size="10">* </tspan><tspan font-family="cmr" font-size="12">[</tspan><tspan font-family="cmmi" font-size="12">R</tspan><tspan font-family="cmr" font-size="12">]</tspan></li></ul>
<a 
 id="x1-218001r290"></a>
<h4 class="subsectionHead"><span class="titlemark">10.4.1   </span> <a 
 id="x1-2190001"></a>Simple Nested Loops Join</h4>
<!--l. 166--><p class="noindent" >Note: We do not present iterator implementations for the join algorithms. We for now show them
as stand alone algorithms and assume the data streams out of them. <br 
class="newline" />Process: <!--l. 169-->
<div class="lstlisting" id="listing-46"><span class="label"><a 
 id="x1-219001r1"></a><tspan font-family="ecrm" font-size="0600">1</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">foreach</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">record</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">r</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">in</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">R</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">do</tspan><tspan font-family="ecrm" font-size="1000">:</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-219002r2"></a><tspan font-family="ecrm" font-size="0600">2</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">foreach</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">record</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">s</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">in</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">S</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">do</tspan><tspan font-family="ecrm" font-size="1000">:</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-219003r3"></a><tspan font-family="ecrm" font-size="0600">3</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">if</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="cmmi" font-size="10">&#x03B8;</tspan><tspan font-family="cmr" font-size="10">(</tspan><tspan font-family="cmmi" font-size="10">ri,sj</tspan><tspan font-family="cmr" font-size="10">)</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">then</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">add</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x003C;</tspan><tspan font-family="ecrm" font-size="1000">r</tspan><tspan font-family="ecrm" font-size="1000">,</tspan><tspan font-family="ecrm" font-size="1000">s</tspan><tspan font-family="ecrm" font-size="1000">&#x003E;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">to</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">result</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">buffer</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-219004r4"></a><tspan font-family="ecrm" font-size="0600">4</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan>
    </div>
<!--l. 174--><p class="indent" >    For each value, if the theta predicate <tspan font-family="cmmi" font-size="12">&#x03B8; </tspan>holds, then we &#x003C;r,s&#x003E; to the output. <br 
class="newline" />Cost:
<div class="center" 
>
<!--l. 177--><p class="noindent" >
<table 
class="equation-star"><tr><td>
<center class="math-display" >
<img 
src="CS186Main49x.png" alt="[R ] + |R|[S] = 4,000,001, 000
" class="math-display" ></center></td></tr></table>
<!--l. 180--><p class="nopar" >
</div>
<!--l. 182--><p class="indent" >    You can swap the order in which you loop through: <!--l. 183-->
<div class="lstlisting" id="listing-47"><span class="label"><a 
 id="x1-219005r1"></a><tspan font-family="ecrm" font-size="0600">1</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">foreach</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">record</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">s</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">in</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">S</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">do</tspan><tspan font-family="ecrm" font-size="1000">:</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-219006r2"></a><tspan font-family="ecrm" font-size="0600">2</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">foreach</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">record</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">r</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">in</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">R</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">do</tspan><tspan font-family="ecrm" font-size="1000">:</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-219007r3"></a><tspan font-family="ecrm" font-size="0600">3</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">if</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="cmmi" font-size="10">&#x03B8;</tspan><tspan font-family="cmr" font-size="10">(</tspan><tspan font-family="cmmi" font-size="10">ri,sj</tspan><tspan font-family="cmr" font-size="10">)</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">then</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">add</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x003C;</tspan><tspan font-family="ecrm" font-size="1000">r</tspan><tspan font-family="ecrm" font-size="1000">,</tspan><tspan font-family="ecrm" font-size="1000">s</tspan><tspan font-family="ecrm" font-size="1000">&#x003E;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">to</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">result</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">buffer</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-219008r4"></a><tspan font-family="ecrm" font-size="0600">4</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan>
                                                                                         
                                                                                         
    </div>
<!--l. 188--><p class="indent" >    In this case, the cost will be different:
<div class="center" 
>
<!--l. 189--><p class="noindent" >
<table 
class="equation-star"><tr><td>
<center class="math-display" >
<img 
src="CS186Main50x.png" alt="[S] + |S |[R ] = 50, 000,500
" class="math-display" ></center></td></tr></table>
<!--l. 192--><p class="nopar" >
</div>
<!--l. 194--><p class="indent" >    From this, we learn that the order of join algorithms make a drastic difference.
<a 
 id="x1-219009r303"></a>
<h4 class="subsectionHead"><span class="titlemark">10.4.2   </span> <a 
 id="x1-2200002"></a>Page nested loop join</h4>
    <!--l. 196-->
<div class="lstlisting" id="listing-48"><span class="label"><a 
 id="x1-220001r1"></a><tspan font-family="ecrm" font-size="0600">1</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">for</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">each</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">rpage</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">in</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">R</tspan><tspan font-family="ecrm" font-size="1000">:</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-220002r2"></a><tspan font-family="ecrm" font-size="0600">2</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">for</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">each</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">spage</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">in</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">S</tspan><tspan font-family="ecrm" font-size="1000">:</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-220003r3"></a><tspan font-family="ecrm" font-size="0600">3</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">for</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">each</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">rtuple</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">in</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">rpage</tspan><tspan font-family="ecrm" font-size="1000">:</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-220004r4"></a><tspan font-family="ecrm" font-size="0600">4</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">for</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">each</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">stuple</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">in</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">spage</tspan><tspan font-family="ecrm" font-size="1000">:</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-220005r5"></a><tspan font-family="ecrm" font-size="0600">5</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">if</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">join_condition</tspan><tspan font-family="ecrm" font-size="1000">(</tspan><tspan font-family="ecrm" font-size="1000">rtuple</tspan><tspan font-family="ecrm" font-size="1000">,</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">stuple</tspan><tspan font-family="ecrm" font-size="1000">)</tspan><tspan font-family="ecrm" font-size="1000">:</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-220006r6"></a><tspan font-family="ecrm" font-size="0600">6</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">add</tspan><tspan font-family="ecrm" font-size="1000">&#x003C;</tspan><tspan font-family="ecrm" font-size="1000">rtuple</tspan><tspan font-family="ecrm" font-size="1000">,</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">stuple</tspan><tspan font-family="ecrm" font-size="1000">&#x003E;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">to</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">result</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">buffer</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-220007r7"></a><tspan font-family="ecrm" font-size="0600">7</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan>
    </div>
<!--l. 204--><p class="indent" >    Cost = <tspan font-family="cmr" font-size="12">[</tspan><tspan font-family="cmmi" font-size="12">R</tspan><tspan font-family="cmr" font-size="12">] = ([</tspan><tspan font-family="cmmi" font-size="12">R</tspan><tspan font-family="cmr" font-size="12">] </tspan><tspan font-family="cmsy" font-size="10">* </tspan><tspan font-family="cmr" font-size="12">[</tspan><tspan font-family="cmmi" font-size="12">S</tspan><tspan font-family="cmr" font-size="12">])</tspan>. This is a lot better than the two options before because this is one
page at a time.
<a 
 id="x1-220008r304"></a>
<h4 class="subsectionHead"><span class="titlemark">10.4.3   </span> <a 
 id="x1-2210003"></a>Chunk nested loop join</h4>
<!--l. 207--><p class="noindent" >We can join on many pages at a time: <!--l. 208-->
<div class="lstlisting" id="listing-49"><span class="label"><a 
 id="x1-221001r1"></a><tspan font-family="ecrm" font-size="0600">1</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">for</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">each</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">rchunk</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">of</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">B</tspan><tspan font-family="cmsy" font-size="10">-</tspan><tspan font-family="ecrm" font-size="1000">2</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">pages</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">of</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">R</tspan><tspan font-family="ecrm" font-size="1000">:</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-221002r2"></a><tspan font-family="ecrm" font-size="0600">2</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">for</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">each</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">spage</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">of</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">S</tspan><tspan font-family="ecrm" font-size="1000">:</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-221003r3"></a><tspan font-family="ecrm" font-size="0600">3</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">for</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">all</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">matching</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">tuples</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">in</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">spage</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">and</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">rchunk</tspan><tspan font-family="ecrm" font-size="1000">:</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-221004r4"></a><tspan font-family="ecrm" font-size="0600">4</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">add</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x003C;</tspan><tspan font-family="ecrm" font-size="1000">rtuple</tspan><tspan font-family="ecrm" font-size="1000">,</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">stuple</tspan><tspan font-family="ecrm" font-size="1000">&#x003E;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">to</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">result</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">buffer</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-221005r5"></a><tspan font-family="ecrm" font-size="0600">5</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan>
    </div>
<!--l. 214--><p class="indent" >    We are traversing the plans one chunk at a time across S instead of just one page at a time.
The cost now is:
                                                                                         
                                                                                         
<table 
class="align-star">
                   <tr><td 
class="align-odd">Cost</td>                   <td 
class="align-even"> <tspan font-family="cmr" font-size="12">= [</tspan><tspan font-family="cmmi" font-size="12">R</tspan><tspan font-family="cmr" font-size="12">] + </tspan><tspan font-family="cmsy" font-size="10">&#x2308;</tspan><img 
src="CS186Main51x.png" alt="  [R]
--------
(B - 2)"  class="frac" align="middle"><tspan font-family="cmsy" font-size="10">&#x2309;* </tspan><tspan font-family="cmr" font-size="12">[</tspan><tspan font-family="cmmi" font-size="12">S</tspan><tspan font-family="cmr" font-size="12">]</tspan></td>                                           <td 
class="align-label"></td>                   <td 
class="align-label">
                   </td></tr><tr><td 
class="align-odd"></td>                        <td 
class="align-even"> <tspan font-family="cmr" font-size="12">= 100 + </tspan><tspan font-family="cmsy" font-size="10">&#x2308;</tspan><img 
src="CS186Main52x.png" alt="--1000--
(B -  2)"  class="frac" align="middle"><tspan font-family="cmsy" font-size="10">&#x2309;* </tspan><tspan font-family="cmr" font-size="12">500</tspan></td>                                          <td 
class="align-label"></td>                   <td 
class="align-label">
                   </td></tr><tr><td 
class="align-odd"></td>                        <td 
class="align-even"> <tspan font-family="cmr" font-size="12">= 6000</tspan>for<tspan font-family="cmmi" font-size="12">B </tspan><tspan font-family="cmr" font-size="12">= 102</tspan>(&#x00A0;100x better than page NL!)</td>                   <td 
class="align-label"></td>                   <td 
class="align-label"></td></tr></table>
<a 
 id="x1-221006r305"></a>
<h4 class="subsectionHead"><span class="titlemark">10.4.4   </span> <a 
 id="x1-2220004"></a>Index Nested Loops Join</h4>
<!--l. 222--><p class="noindent" >The idea is that you take the inner loop of nested loops join and replace it with an index lookup:
<!--l. 224-->
<div class="lstlisting" id="listing-50"><span class="label"><a 
 id="x1-222001r1"></a><tspan font-family="ecrm" font-size="0600">1</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">for</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">tuple</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">r</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">in</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">R</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">do</tspan><tspan font-family="ecrm" font-size="1000">:</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-222002r2"></a><tspan font-family="ecrm" font-size="0600">2</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">for</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">each</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">tuple</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">s</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">in</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">S</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">where</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">ri</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">==</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">sj</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">do</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-222003r3"></a><tspan font-family="ecrm" font-size="0600">3</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">add</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x003C;</tspan><tspan font-family="ecrm" font-size="1000">r</tspan><tspan font-family="ecrm" font-size="1000">,</tspan><tspan font-family="ecrm" font-size="1000">s</tspan><tspan font-family="ecrm" font-size="1000">&#x003E;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">to</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">result</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">buffer</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-222004r4"></a><tspan font-family="ecrm" font-size="0600">4</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan>
    </div>
<!--l. 229--><p class="indent" >    We only look at tuples of s that match. We use <tspan font-family="cmmi" font-size="12">lookup</tspan><tspan font-family="cmr" font-size="12">(</tspan><tspan font-family="cmmi" font-size="12">r</tspan><sub><tspan font-family="cmmi" font-size="8">i</tspan></sub> to find the tuple <tspan font-family="cmmi" font-size="12">s</tspan><sub><tspan font-family="cmmi" font-size="8">j</tspan></sub> to find the data
entries.
<h5 class="subsubsectionHead"><a 
 id="x1-2230004"></a>Cost</h5>
<!--l. 232--><p class="noindent" >Cost = [R] + |R| * cost to find matching S tuples
<!--l. 233--><p class="indent" >    If using Alternative 1, the cost to traverse the tree from root to leaf is usually 2-3 I/Os .
<br 
class="newline" />For Alternative 2 and 3:
      <ul class="itemize1">
      <li class="itemize">Cost to lookup RID(s) is typically 2-3 IOs fro B+ Tree.
      </li>
      <li class="itemize">Cost to retrieve records from RID(s)
           <ul class="itemize2">
           <li class="itemize">Clustered index: 1 IO per page of matching S tuple
           <table 
class="equation-star"><tr><td>
           <center class="math-display" >
           <img 
src="CS186Main53x.png" alt="Cost (R,S ) = [R ] + |R | * Search + distinct_vals (R) * HeapAccess
           " class="math-display" ></center></td></tr></table>
           <!--l. 243--><p class="nopar" >
           <!--l. 244--><p class="noindent" >For every distinct value, we are going to do a heap access. We only do one heap access
           per distinct value under the assumption that the values will probably be on the same
           page or somewhere close by.
           </li>
           <li class="itemize">Unclustered: up to 1 IO per matching S tuple
           <table 
class="equation-star"><tr><td>
           <center class="math-display" >
           <img 
src="CS186Main54x.png" alt="Cost (R, S) = [R] + |R | * Search + HeapAccess
           " class="math-display" ></center></td></tr></table>
           <!--l. 250--><p class="nopar" >
           </li></ul>
      </li></ul>
<a 
 id="x1-223001r306"></a>
<h4 class="subsectionHead"><span class="titlemark">10.4.5   </span> <a 
 id="x1-2240005"></a>Sort-merge join</h4>
<!--l. 254--><p class="noindent" >This join algorithm only applies to equi-joins and Natural joins, where there is an equality
predicate in the <tspan font-family="cmmi" font-size="12">&#x03B8;</tspan>. There are two stages: <a 
 id="Q1-1-309"></a>
<h4 class="likesubsectionHead"><a 
 id="x1-2250005"></a>Stage 1</h4>
      <ul class="itemize1">
      <li class="itemize">Sort tuples in R and S by join key
           <ul class="itemize2">
           <li class="itemize">Get aall tuples in each relation with same key in consecutive order.
           </li>
           <li class="itemize">Input might already be sorted because something before already sorted it.</li></ul>
      </li></ul>
<a 
 id="Q1-1-311"></a>
<h4 class="likesubsectionHead"><a 
 id="x1-2260005"></a>Stage 2</h4>
<!--l. 267--><p class="noindent" >Join pass: scan the two relations to be merged which are already sorted on disk and merge them
together to output tuples that match.
                                                                                         
                                                                                         
<div class="mdframed" id="mdframed-6">
<!--l. 270-->
<div class="lstlisting" id="listing-51"><span class="label"><a 
 id="x1-226001r1"></a><tspan font-family="ecrm" font-size="0600">1</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">do</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">{</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-226002r2"></a><tspan font-family="ecrm" font-size="0600">2</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">if</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">(!</tspan><tspan font-family="ecrm" font-size="1000">mark</tspan><tspan font-family="ecrm" font-size="1000">)</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">{</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-226003r3"></a><tspan font-family="ecrm" font-size="0600">3</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">while</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">(</tspan><tspan font-family="ecrm" font-size="1000">r</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x003C;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">s</tspan><tspan font-family="ecrm" font-size="1000">)</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">{</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">advance</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">r</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">}</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-226004r4"></a><tspan font-family="ecrm" font-size="0600">4</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">while</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">(</tspan><tspan font-family="ecrm" font-size="1000">r</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x003E;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">s</tspan><tspan font-family="ecrm" font-size="1000">)</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">{</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">advance</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">s</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">}</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-226005r5"></a><tspan font-family="ecrm" font-size="0600">5</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">//</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">mark</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">start</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">of</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">"</tspan><tspan font-family="ecrm" font-size="1000">block</tspan><tspan font-family="ecrm" font-size="1000">"</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">of</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">S</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-226006r6"></a><tspan font-family="ecrm" font-size="0600">6</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">mark</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">=</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">s</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-226007r7"></a><tspan font-family="ecrm" font-size="0600">7</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">}</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-226008r8"></a><tspan font-family="ecrm" font-size="0600">8</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">if</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">(</tspan><tspan font-family="ecrm" font-size="1000">r</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">==</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">s</tspan><tspan font-family="ecrm" font-size="1000">)</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">{</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-226009r9"></a><tspan font-family="ecrm" font-size="0600">9</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">result</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">=</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x003C;</tspan><tspan font-family="ecrm" font-size="1000">r</tspan><tspan font-family="ecrm" font-size="1000">,</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">s</tspan><tspan font-family="ecrm" font-size="1000">&#x003E;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-226010r10"></a><tspan font-family="ecrm" font-size="0600">10</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">advance</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">s</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-226011r11"></a><tspan font-family="ecrm" font-size="0600">11</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">return</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">result</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-226012r12"></a><tspan font-family="ecrm" font-size="0600">12</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">}</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-226013r13"></a><tspan font-family="ecrm" font-size="0600">13</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">else</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">{</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-226014r14"></a><tspan font-family="ecrm" font-size="0600">14</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">reset</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">s</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">to</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">mark</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-226015r15"></a><tspan font-family="ecrm" font-size="0600">15</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">advance</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">r</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-226016r16"></a><tspan font-family="ecrm" font-size="0600">16</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">mark</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">=</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">NULL</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-226017r17"></a><tspan font-family="ecrm" font-size="0600">17</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">}</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-226018r18"></a><tspan font-family="ecrm" font-size="0600">18</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">}</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-226019r19"></a><tspan font-family="ecrm" font-size="0600">19</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan>
</div>
<!--l. 290--><p class="noindent" >We start by checking to see if there is a mark variable. If there is none, we advance r
until it is as big or bigger than s, then we set a mark on where s is. If they are equal,
we start to have matches and set the result variable to be the current values of the R
and S pointers on the right. We advance s for future call and then return the result as
output.
<!--l. 295--><p class="noindent" >When we get called again to do next, we check to see if mark is set, if it is, then we check to see if
we have another pair of matching tuples. Since we do, we again set the result to be the pair,
advance s, then return the result.
<!--l. 298--><p class="noindent" >On the third call, we still have our internal state of r and s. We check to see if <tspan font-family="cmmi" font-size="12">r </tspan><tspan font-family="cmr" font-size="12">== </tspan><tspan font-family="cmmi" font-size="12">s</tspan>. Because
they don&#8217;t, we rewind the s cursor in <tspan font-family="ectt" font-size="1200">reset s to mark</tspan>. The mark was there so that we know
where to restart s when we get a new tuple. We then advance r to the next tuple, set the mark to
null, and then go back to the top of the loop.
<!--l. 303--><p class="noindent" ><tspan font-family="ecbx" font-size="1200">Example: Sort-Merge Join</tspan>
<!--l. 303--><p class="noindent" >____
________
    </div>
<a 
 id="x1-226020r302"></a>
<h3 class="sectionHead"><span class="titlemark">10.5   </span> <a 
 id="x1-2270005"></a>Cost of sort-merge join</h3>
<div class="center" 
>
<!--l. 305--><p class="noindent" >
<!--l. 306--><p class="noindent" >Cost: Sort R + Sort S ([R] + [S])</div>
<!--l. 308--><p class="noindent" >In the worst case, all the join values for r and s are the same. In that case, the output is the cross
product of all the tuples in R and S because all of the tuples match.
<!--l. 310--><p class="indent" >    Question: How big does the buffer have to bet o sort both R and S in two passes each?
<br 
class="newline" />Suppose buffer <tspan font-family="cmmi" font-size="12">B &#x003E;</tspan> <img 
src="CS186Main55x.png" alt="&#x2218;  --------------
   (max  [R],[S])"  class="sqrt" >
<!--l. 312--><p class="indent" >    In general, figuring out the cost of the sort of the output of the join is tricky because we don&#8217;t
know how big the output will be.
<a 
 id="x1-227001r313"></a>
<h3 class="sectionHead"><span class="titlemark">10.6   </span> <a 
 id="x1-2280006"></a>Sort-merge refinement</h3>
<!--l. 315--><p class="noindent" >We are going to take the joining pass (second phase) and combine it into the last pass of
merging during the sorting algorithm. The sorting will now have a joining portion in the
last pass. To do this we need to have enough memory so we can sort s and r at the
same time. While we are merging, we know the minimum of each so we can do the
<tspan font-family="ectt" font-size="1200">next </tspan>calls on those runs as they are being merged. Whenever it says next, imagine
doing those next on the merges of the final merge of r and s in each of their search
                                                                                         
                                                                                         
algorithms. This allows us to avoid writing out the final pass of R and final pass of S in
sorting.
<a 
 id="x1-228001r314"></a>
<h3 class="sectionHead"><span class="titlemark">10.7   </span> <a 
 id="x1-2290007"></a>Naive in memory hash join</h3>
<!--l. 323--><p class="noindent" >For now, we are assuming that: R is smaller relation and that R is able to fit in memory. We have a
naive simple hash join algorithm:
      <ul class="itemize1">
      <li class="itemize">Load all R into hash table
      </li>
      <li class="itemize">Scan S and probe R
      </li>
      <li class="itemize">When you have a match, load it into output</li></ul>
<!--l. 330--><p class="noindent" >Memory requirements: <tspan font-family="cmmi" font-size="12">R &#x003C; </tspan><tspan font-family="cmr" font-size="12">(</tspan><tspan font-family="cmmi" font-size="12">B </tspan><tspan font-family="cmsy" font-size="10">- </tspan><tspan font-family="cmr" font-size="12">2) </tspan><tspan font-family="cmsy" font-size="10">*</tspan> hash_fill
<a 
 id="x1-229001r315"></a>
<h3 class="sectionHead"><span class="titlemark">10.8   </span> <a 
 id="x1-2300008"></a>Grace Hash Join</h3>
<!--l. 332--><p class="noindent" >It requires equality predicate: Equi-joins and Natural Joins. It has two stages:
      <ul class="itemize1">
      <li class="itemize"><tspan font-family="ecbx" font-size="1200">Partition </tspan>tuples from R and S by join key and store on scratch disk. All the tuples
      for a given eky will be in the same partition.
      </li>
      <li class="itemize"><tspan font-family="ecbx" font-size="1200">Build and probe </tspan>a separate hash table for each partition like in naive hash. We
      assume <tspan font-family="ecbx" font-size="1200">partition </tspan>of smaller relation fits in memory and then recurse if necessary.</li></ul>
<!--l. 340--><p class="indent" >    For Grace hash join, we will build on top of the previous external hash we had.
<hr class="figure"><div class="figure" 
>
                                                                                         
                                                                                         
<a 
 id="x1-2300012"></a>
                                                                                         
                                                                                         
<!--l. 343--><p class="noindent" >
<br /> <div class="caption" 
><span class="id">Figure&#x00A0;10.2: </span><span  
class="content">Grace hash Join</span></div><!--tex4ht:label?: x1-2300012 -->
                                                                                         
                                                                                         
<!--l. 345--><p class="indent" >    </div><hr class="endfigure">
<!--l. 346--><p class="indent" >    We add a probing relation that works on the has tables as we go. The probing relation will be
partitioned using the same hash function
<!--l. 348--><p class="indent" >    The probing partitions can be very big so all we care about is whether or not R can be done
without recursive partitioning. <br 
class="newline" />Pseudocode: <!--l. 351-->
<div class="lstlisting" id="listing-52"><span class="label"><a 
 id="x1-230002r1"></a><tspan font-family="ecrm" font-size="0600">1</tspan></span><tspan font-family="ecrm" font-size="1000">For</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">Cur</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">in</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">{</tspan><tspan font-family="ecrm" font-size="1000">R</tspan><tspan font-family="ecrm" font-size="1000">,</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">S</tspan><tspan font-family="ecrm" font-size="1000">}</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-230003r2"></a><tspan font-family="ecrm" font-size="0600">2</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">For</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">page</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">in</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">Cur</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-230004r3"></a><tspan font-family="ecrm" font-size="0600">3</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">Read</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">page</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">into</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">input</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">buffer</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-230005r4"></a><tspan font-family="ecrm" font-size="0600">4</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">For</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">tup</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">on</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">page</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-230006r5"></a><tspan font-family="ecrm" font-size="0600">5</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">Place</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">tup</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">in</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">output</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">buf</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">hashp</tspan><tspan font-family="ecrm" font-size="1000">(</tspan><tspan font-family="ecrm" font-size="1000">tup</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">joinkey</tspan><tspan font-family="ecrm" font-size="1000">)</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-230007r6"></a><tspan font-family="ecrm" font-size="0600">6</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">If</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">output</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">buf</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">full</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">then</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">flush</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">to</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">disk</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">partition</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-230008r7"></a><tspan font-family="ecrm" font-size="0600">7</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">Flush</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">output</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">bufs</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">to</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">disk</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">partitions</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-230009r8"></a><tspan font-family="ecrm" font-size="0600">8</tspan></span><tspan font-family="ecrm" font-size="1000">For</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">i</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">in</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">[0..(</tspan><tspan font-family="ecrm" font-size="1000">B</tspan><tspan font-family="cmsy" font-size="10">-</tspan><tspan font-family="ecrm" font-size="1000">1)</tspan><tspan font-family="ecrm" font-size="1000">)</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-230010r9"></a><tspan font-family="ecrm" font-size="0600">9</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">For</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">page</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">in</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">Ri</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-230011r10"></a><tspan font-family="ecrm" font-size="0600">10</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">For</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">tup</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">on</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">page</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-230012r11"></a><tspan font-family="ecrm" font-size="0600">11</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">Build</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">tup</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">into</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">memory</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">hashr</tspan><tspan font-family="ecrm" font-size="1000">(</tspan><tspan font-family="ecrm" font-size="1000">tup</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">joinkey</tspan><tspan font-family="ecrm" font-size="1000">)</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-230013r12"></a><tspan font-family="ecrm" font-size="0600">12</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">For</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">page</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">in</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">Si</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-230014r13"></a><tspan font-family="ecrm" font-size="0600">13</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">Read</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">page</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">into</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">input</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">buffer</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-230015r14"></a><tspan font-family="ecrm" font-size="0600">14</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">For</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">tup</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">on</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">page</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-230016r15"></a><tspan font-family="ecrm" font-size="0600">15</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">Probe</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">memory</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">hashr</tspan><tspan font-family="ecrm" font-size="1000">(</tspan><tspan font-family="ecrm" font-size="1000">tup</tspan><tspan font-family="ecrm" font-size="1000">.</tspan><tspan font-family="ecrm" font-size="1000">joinkey</tspan><tspan font-family="ecrm" font-size="1000">)</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">for</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">matches</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-230017r16"></a><tspan font-family="ecrm" font-size="0600">16</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">Send</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">all</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">matches</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">to</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">output</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">buffer</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-230018r17"></a><tspan font-family="ecrm" font-size="0600">17</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">Flush</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">output</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">buffer</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">if</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">full</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><br /><span class="label"><a 
 id="x1-230019r18"></a><tspan font-family="ecrm" font-size="0600">18</tspan></span><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan><tspan font-family="ecrm" font-size="1000">&#x00A0;</tspan>
    </div>
<!--l. 370--><p class="indent" >    For each tuple on the page, we insert it into the main memory hash table.
                                                                                         
                                                                                         
     
</body></html> 

                                                                                         
                                                                                         
                                                                                         


